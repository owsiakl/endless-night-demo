/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{add:()=>C,angle:()=>ct,bezier:()=>tt,ceil:()=>F,clone:()=>x,copy:()=>R,create:()=>O,cross:()=>Q,dist:()=>vt,distance:()=>q,div:()=>bt,divide:()=>I,dot:()=>K,equals:()=>ht,exactEquals:()=>ft,floor:()=>B,forEach:()=>wt,fromValues:()=>M,hermite:()=>$,inverse:()=>Y,len:()=>_t,length:()=>k,lerp:()=>Z,max:()=>D,min:()=>N,mul:()=>mt,multiply:()=>U,negate:()=>W,normalize:()=>J,random:()=>et,rotateX:()=>it,rotateY:()=>at,rotateZ:()=>ut,round:()=>X,scale:()=>G,scaleAndAdd:()=>V,set:()=>A,sqrDist:()=>dt,sqrLen:()=>gt,squaredDistance:()=>z,squaredLength:()=>H,str:()=>lt,sub:()=>pt,subtract:()=>L,transformMat3:()=>nt,transformMat4:()=>rt,transformQuat:()=>ot,zero:()=>st});var r={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o.key),"symbol"===n(i)?i:String(i)),o)}var i}t.r(r),t.d(r,{add:()=>$t,calculateW:()=>Rt,clone:()=>Jt,conjugate:()=>Bt,copy:()=>Qt,create:()=>St,dot:()=>re,equals:()=>le,exactEquals:()=>se,exp:()=>At,fromEuler:()=>Dt,fromMat3:()=>Nt,fromValues:()=>Kt,getAngle:()=>jt,getAxisAngle:()=>Pt,identity:()=>Et,invert:()=>Ft,len:()=>ie,length:()=>oe,lerp:()=>ne,ln:()=>Ct,mul:()=>te,multiply:()=>Ot,normalize:()=>ce,pow:()=>Lt,random:()=>It,rotateX:()=>xt,rotateY:()=>kt,rotateZ:()=>Mt,rotationTo:()=>fe,scale:()=>ee,set:()=>Zt,setAxes:()=>ye,setAxisAngle:()=>Tt,slerp:()=>Ut,sqlerp:()=>he,sqrLen:()=>ue,squaredLength:()=>ae,str:()=>Xt});var i=function(){function t(e,r,n,o,i,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bufferView=e,this.buffer=r,this.byteOffset=n,this.componentType=o,this.count=i,this.type=a}var e,r,n;return e=t,n=[{key:"fromJson",value:function(t,e,r){var n,o=e[t.bufferView];return new this(o,r[o.buffer],null!==(n=t.byteOffset)&&void 0!==n?n:0,t.componentType,t.count,t.type)}}],(r=[{key:"data",get:function(){var t=this.bufferView,e=this.buffer,r=this.typedArray;if(t.isInterleaved){for(var n=new r(e.arrayBuffer(),t.byteOffset+this.byteOffset),o=new r(this.length),i=t.byteStride/r.BYTES_PER_ELEMENT,a=0;a<this.count;a++){var u=i*a,c=u+this.typeSize;o.set(n.slice(u,c),a*this.typeSize)}return new r(o,t.byteOffset+this.byteOffset)}return new r(e.arrayBuffer(),t.byteOffset+this.byteOffset,this.count*this.typeSize)}},{key:"typeSize",get:function(){switch(this.type){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Can't get typed size based on \"".concat(this.type,'" type'))}}},{key:"typedArray",get:function(){switch(this.componentType){case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("Can't get typed array based on \"".concat(this.componentType,'" type'))}}},{key:"length",get:function(){return this.count*this.typeSize}}])&&o(e.prototype,r),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==a(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===a(o)?o:String(o)),n)}var o}var c=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.buffer=e,this.byteOffset=r,this.byteLength=n,this.byteStride=o,this.target=i}var e,r,n;return e=t,n=[{key:"fromJson",value:function(t){var e,r,n;return new this(t.buffer,null!==(e=t.byteOffset)&&void 0!==e?e:0,t.byteLength,null!==(r=t.byteStride)&&void 0!==r?r:0,null!==(n=t.target)&&void 0!==n?n:null)}}],(r=[{key:"isInterleaved",get:function(){return this.byteStride>0}}])&&u(e.prototype,r),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(){l=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var i=e&&e.prototype instanceof _?e:_,a=Object.create(i.prototype),u=new A(n||[]);return o(a,"_invoke",{value:x(t,r,u)}),a}function y(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var p="suspendedStart",m="suspendedYield",b="executing",v="completed",d={};function _(){}function g(){}function w(){}var S={};f(S,a,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(C([])));T&&T!==r&&n.call(T,a)&&(S=T);var P=w.prototype=_.prototype=Object.create(S);function j(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=y(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==s(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function x(e,r,n){var o=p;return function(i,a){if(o===b)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=b;var s=y(e,r,n);if("normal"===s.type){if(o=n.done?v:m,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=y(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(s(e)+" is not iterable")}return g.prototype=w,o(P,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=f(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,f(t,c,"GeneratorFunction")),t.prototype=Object.create(P),t},e.awrap=function(t){return{__await:t}},j(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},j(P),f(P,c,"Generator"),f(P,a,(function(){return this})),f(P,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),R(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function f(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==s(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===s(o)?o:String(o)),n)}var o}var p=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._uri=e,this._byteLength=r,this._arrayBufferCache=null}var e,r,n,o,i;return e=t,r=[{key:"arrayBuffer",value:function(){if(null!==this._arrayBufferCache)return this._arrayBufferCache;if(!this._uri.startsWith("data:"))throw new Error("GLTF buffer URIs other than data are not implemented.");var t=this._uri.indexOf(","),e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this._uri.substring(5,t).split(";"),2),r=e[0],n=e[1];if(!["application/octet-stream","application/gltf-buffer"].includes(r))throw new Error('GLTF buffer data URIs "'.concat(r,'" mime type is not supported.'));if(!["base64"].includes(n))throw new Error('GLTF buffer data URIs "'.concat(n,'" encoding is not supported.'));for(var o=this._uri.substring(t+1),i=atob(o),a=new ArrayBuffer(i.length),u=new Uint8Array(a),c=0;c<i.length;c++)u[c]=i.charCodeAt(c);return a}}],n=[{key:"fromJson",value:(o=l().mark((function t(e){var r,n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new this(e.uri,e.byteLength),void 0===e.binary){t.next=5;break}r._arrayBufferCache=e.binary,t.next=12;break;case 5:if(r._uri.startsWith("data:")){t.next=12;break}return t.next=8,fetch("/model/"+r._uri);case 8:return n=t.sent,t.next=11,n.arrayBuffer();case 11:r._arrayBufferCache=t.sent;case 12:return t.abrupt("return",r);case 13:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){f(i,r,n,a,u,"next",t)}function u(t){f(i,r,n,a,u,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})}],r&&y(e.prototype,r),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),m=1e-6,b="undefined"!=typeof Float32Array?Float32Array:Array,v=Math.random;function d(){var t=new b(16);return b!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function g(t,e,r){var n=e[0],o=e[1],i=e[2],a=e[3],u=e[4],c=e[5],s=e[6],l=e[7],f=e[8],h=e[9],y=e[10],p=e[11],m=e[12],b=e[13],v=e[14],d=e[15],_=r[0],g=r[1],w=r[2],S=r[3];return t[0]=_*n+g*u+w*f+S*m,t[1]=_*o+g*c+w*h+S*b,t[2]=_*i+g*s+w*y+S*v,t[3]=_*a+g*l+w*p+S*d,_=r[4],g=r[5],w=r[6],S=r[7],t[4]=_*n+g*u+w*f+S*m,t[5]=_*o+g*c+w*h+S*b,t[6]=_*i+g*s+w*y+S*v,t[7]=_*a+g*l+w*p+S*d,_=r[8],g=r[9],w=r[10],S=r[11],t[8]=_*n+g*u+w*f+S*m,t[9]=_*o+g*c+w*h+S*b,t[10]=_*i+g*s+w*y+S*v,t[11]=_*a+g*l+w*p+S*d,_=r[12],g=r[13],w=r[14],S=r[15],t[12]=_*n+g*u+w*f+S*m,t[13]=_*o+g*c+w*h+S*b,t[14]=_*i+g*s+w*y+S*v,t[15]=_*a+g*l+w*p+S*d,t}function w(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function S(t,e){var r=e[0],n=e[1],o=e[2],i=e[4],a=e[5],u=e[6],c=e[8],s=e[9],l=e[10];return t[0]=Math.hypot(r,n,o),t[1]=Math.hypot(i,a,u),t[2]=Math.hypot(c,s,l),t}function E(t,e){var r=new b(3);S(r,e);var n=1/r[0],o=1/r[1],i=1/r[2],a=e[0]*n,u=e[1]*o,c=e[2]*i,s=e[4]*n,l=e[5]*o,f=e[6]*i,h=e[8]*n,y=e[9]*o,p=e[10]*i,m=a+l+p,v=0;return m>0?(v=2*Math.sqrt(m+1),t[3]=.25*v,t[0]=(f-y)/v,t[1]=(h-c)/v,t[2]=(u-s)/v):a>l&&a>p?(v=2*Math.sqrt(1+a-l-p),t[3]=(f-y)/v,t[0]=.25*v,t[1]=(u+s)/v,t[2]=(h+c)/v):l>p?(v=2*Math.sqrt(1+l-a-p),t[3]=(h-c)/v,t[0]=(u+s)/v,t[1]=.25*v,t[2]=(f+y)/v):(v=2*Math.sqrt(1+p-a-l),t[3]=(u-s)/v,t[0]=(h+c)/v,t[1]=(f+y)/v,t[2]=.25*v),t}function T(t,e,r,n){var o=e[0],i=e[1],a=e[2],u=e[3],c=o+o,s=i+i,l=a+a,f=o*c,h=o*s,y=o*l,p=i*s,m=i*l,b=a*l,v=u*c,d=u*s,_=u*l,g=n[0],w=n[1],S=n[2];return t[0]=(1-(p+b))*g,t[1]=(h+_)*g,t[2]=(y-d)*g,t[3]=0,t[4]=(h-_)*w,t[5]=(1-(f+b))*w,t[6]=(m+v)*w,t[7]=0,t[8]=(y+d)*S,t[9]=(m-v)*S,t[10]=(1-(f+p))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var P=function(t,e,r,n,o){var i,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(i=1/(n-o),t[10]=(o+n)*i,t[14]=2*o*n*i):(t[10]=-1,t[14]=-2*n),t};function j(t,e,r,n){var o,i,a,u,c,s,l,f,h,y,p=e[0],b=e[1],v=e[2],d=n[0],_=n[1],g=n[2],w=r[0],S=r[1],E=r[2];return Math.abs(p-w)<m&&Math.abs(b-S)<m&&Math.abs(v-E)<m?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(l=p-w,f=b-S,h=v-E,o=_*(h*=y=1/Math.hypot(l,f,h))-g*(f*=y),i=g*(l*=y)-d*h,a=d*f-_*l,(y=Math.hypot(o,i,a))?(o*=y=1/y,i*=y,a*=y):(o=0,i=0,a=0),u=f*a-h*i,c=h*o-l*a,s=l*i-f*o,(y=Math.hypot(u,c,s))?(u*=y=1/y,c*=y,s*=y):(u=0,c=0,s=0),t[0]=o,t[1]=u,t[2]=l,t[3]=0,t[4]=i,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=s,t[10]=h,t[11]=0,t[12]=-(o*p+i*b+a*v),t[13]=-(u*p+c*b+s*v),t[14]=-(l*p+f*b+h*v),t[15]=1,t)}function O(){var t=new b(3);return b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function x(t){var e=new b(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function k(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function M(t,e,r){var n=new b(3);return n[0]=t,n[1]=e,n[2]=r,n}function R(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function A(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function C(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function L(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function U(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function I(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function F(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function B(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function N(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function D(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function X(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function G(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function V(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function q(t,e){var r=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return Math.hypot(r,n,o)}function z(t,e){var r=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return r*r+n*n+o*o}function H(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function W(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Y(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function J(t,e){var r=e[0],n=e[1],o=e[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function K(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Q(t,e,r){var n=e[0],o=e[1],i=e[2],a=r[0],u=r[1],c=r[2];return t[0]=o*c-i*u,t[1]=i*a-n*c,t[2]=n*u-o*a,t}function Z(t,e,r,n){var o=e[0],i=e[1],a=e[2];return t[0]=o+n*(r[0]-o),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t}function $(t,e,r,n,o,i){var a=i*i,u=a*(2*i-3)+1,c=a*(i-2)+i,s=a*(i-1),l=a*(3-2*i);return t[0]=e[0]*u+r[0]*c+n[0]*s+o[0]*l,t[1]=e[1]*u+r[1]*c+n[1]*s+o[1]*l,t[2]=e[2]*u+r[2]*c+n[2]*s+o[2]*l,t}function tt(t,e,r,n,o,i){var a=1-i,u=a*a,c=i*i,s=u*a,l=3*i*u,f=3*c*a,h=c*i;return t[0]=e[0]*s+r[0]*l+n[0]*f+o[0]*h,t[1]=e[1]*s+r[1]*l+n[1]*f+o[1]*h,t[2]=e[2]*s+r[2]*l+n[2]*f+o[2]*h,t}function et(t,e){e=e||1;var r=2*v()*Math.PI,n=2*v()-1,o=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*o,t[1]=Math.sin(r)*o,t[2]=n*e,t}function rt(t,e,r){var n=e[0],o=e[1],i=e[2],a=r[3]*n+r[7]*o+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*o+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*o+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*o+r[10]*i+r[14])/a,t}function nt(t,e,r){var n=e[0],o=e[1],i=e[2];return t[0]=n*r[0]+o*r[3]+i*r[6],t[1]=n*r[1]+o*r[4]+i*r[7],t[2]=n*r[2]+o*r[5]+i*r[8],t}function ot(t,e,r){var n=r[0],o=r[1],i=r[2],a=r[3],u=e[0],c=e[1],s=e[2],l=o*s-i*c,f=i*u-n*s,h=n*c-o*u,y=o*h-i*f,p=i*l-n*h,m=n*f-o*l,b=2*a;return l*=b,f*=b,h*=b,y*=2,p*=2,m*=2,t[0]=u+l+y,t[1]=c+f+p,t[2]=s+h+m,t}function it(t,e,r,n){var o=[],i=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function at(t,e,r,n){var o=[],i=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function ut(t,e,r,n){var o=[],i=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function ct(t,e){var r=t[0],n=t[1],o=t[2],i=e[0],a=e[1],u=e[2],c=Math.sqrt(r*r+n*n+o*o)*Math.sqrt(i*i+a*a+u*u),s=c&&K(t,e)/c;return Math.acos(Math.min(Math.max(s,-1),1))}function st(t){return t[0]=0,t[1]=0,t[2]=0,t}function lt(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ht(t,e){var r=t[0],n=t[1],o=t[2],i=e[0],a=e[1],u=e[2];return Math.abs(r-i)<=m*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=m*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-u)<=m*Math.max(1,Math.abs(o),Math.abs(u))}var yt,pt=L,mt=U,bt=I,vt=q,dt=z,_t=k,gt=H,wt=(yt=O(),function(t,e,r,n,o,i){var a,u;for(e||(e=3),r||(r=0),u=n?Math.min(n*e+r,t.length):t.length,a=r;a<u;a+=e)yt[0]=t[a],yt[1]=t[a+1],yt[2]=t[a+2],o(yt,yt,i),t[a]=yt[0],t[a+1]=yt[1],t[a+2]=yt[2];return t});function St(){var t=new b(4);return b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Et(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Tt(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Pt(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>m?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function jt(t,e){var r=re(t,e);return Math.acos(2*r*r-1)}function Ot(t,e,r){var n=e[0],o=e[1],i=e[2],a=e[3],u=r[0],c=r[1],s=r[2],l=r[3];return t[0]=n*l+a*u+o*s-i*c,t[1]=o*l+a*c+i*u-n*s,t[2]=i*l+a*s+n*c-o*u,t[3]=a*l-n*u-o*c-i*s,t}function xt(t,e,r){r*=.5;var n=e[0],o=e[1],i=e[2],a=e[3],u=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*u,t[1]=o*c+i*u,t[2]=i*c-o*u,t[3]=a*c-n*u,t}function kt(t,e,r){r*=.5;var n=e[0],o=e[1],i=e[2],a=e[3],u=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*u,t[1]=o*c+a*u,t[2]=i*c+n*u,t[3]=a*c-o*u,t}function Mt(t,e,r){r*=.5;var n=e[0],o=e[1],i=e[2],a=e[3],u=Math.sin(r),c=Math.cos(r);return t[0]=n*c+o*u,t[1]=o*c-n*u,t[2]=i*c+a*u,t[3]=a*c-i*u,t}function Rt(t,e){var r=e[0],n=e[1],o=e[2];return t[0]=r,t[1]=n,t[2]=o,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-o*o)),t}function At(t,e){var r=e[0],n=e[1],o=e[2],i=e[3],a=Math.sqrt(r*r+n*n+o*o),u=Math.exp(i),c=a>0?u*Math.sin(a)/a:0;return t[0]=r*c,t[1]=n*c,t[2]=o*c,t[3]=u*Math.cos(a),t}function Ct(t,e){var r=e[0],n=e[1],o=e[2],i=e[3],a=Math.sqrt(r*r+n*n+o*o),u=a>0?Math.atan2(a,i)/a:0;return t[0]=r*u,t[1]=n*u,t[2]=o*u,t[3]=.5*Math.log(r*r+n*n+o*o+i*i),t}function Lt(t,e,r){return Ct(t,e),ee(t,t,r),At(t,t),t}function Ut(t,e,r,n){var o,i,a,u,c,s=e[0],l=e[1],f=e[2],h=e[3],y=r[0],p=r[1],b=r[2],v=r[3];return(i=s*y+l*p+f*b+h*v)<0&&(i=-i,y=-y,p=-p,b=-b,v=-v),1-i>m?(o=Math.acos(i),a=Math.sin(o),u=Math.sin((1-n)*o)/a,c=Math.sin(n*o)/a):(u=1-n,c=n),t[0]=u*s+c*y,t[1]=u*l+c*p,t[2]=u*f+c*b,t[3]=u*h+c*v,t}function It(t){var e=v(),r=v(),n=v(),o=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=o*Math.sin(2*Math.PI*r),t[1]=o*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function Ft(t,e){var r=e[0],n=e[1],o=e[2],i=e[3],a=r*r+n*n+o*o+i*i,u=a?1/a:0;return t[0]=-r*u,t[1]=-n*u,t[2]=-o*u,t[3]=i*u,t}function Bt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Nt(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var i=(o+1)%3,a=(o+2)%3;r=Math.sqrt(e[3*o+o]-e[3*i+i]-e[3*a+a]+1),t[o]=.5*r,r=.5/r,t[3]=(e[3*i+a]-e[3*a+i])*r,t[i]=(e[3*i+o]+e[3*o+i])*r,t[a]=(e[3*a+o]+e[3*o+a])*r}return t}function Dt(t,e,r,n){var o=.5*Math.PI/180;e*=o,r*=o,n*=o;var i=Math.sin(e),a=Math.cos(e),u=Math.sin(r),c=Math.cos(r),s=Math.sin(n),l=Math.cos(n);return t[0]=i*c*l-a*u*s,t[1]=a*u*l+i*c*s,t[2]=a*c*s-i*u*l,t[3]=a*c*l+i*u*s,t}function Xt(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}!function(){var t;t=new b(4),b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Gt,Vt,qt,zt,Ht,Wt,Yt,Jt=function(t){var e=new b(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Kt=function(t,e,r,n){var o=new b(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=n,o},Qt=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Zt=function(t,e,r,n,o){return t[0]=e,t[1]=r,t[2]=n,t[3]=o,t},$t=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},te=Ot,ee=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},re=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ne=function(t,e,r,n){var o=e[0],i=e[1],a=e[2],u=e[3];return t[0]=o+n*(r[0]-o),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t[3]=u+n*(r[3]-u),t},oe=function(t){var e=t[0],r=t[1],n=t[2],o=t[3];return Math.hypot(e,r,n,o)},ie=oe,ae=function(t){var e=t[0],r=t[1],n=t[2],o=t[3];return e*e+r*r+n*n+o*o},ue=ae,ce=function(t,e){var r=e[0],n=e[1],o=e[2],i=e[3],a=r*r+n*n+o*o+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=o*a,t[3]=i*a,t},se=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},le=function(t,e){var r=t[0],n=t[1],o=t[2],i=t[3],a=e[0],u=e[1],c=e[2],s=e[3];return Math.abs(r-a)<=m*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-c)<=m*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(i-s)<=m*Math.max(1,Math.abs(i),Math.abs(s))},fe=(Gt=O(),Vt=M(1,0,0),qt=M(0,1,0),function(t,e,r){var n=K(e,r);return n<-.999999?(Q(Gt,Vt,e),_t(Gt)<1e-6&&Q(Gt,qt,e),J(Gt,Gt),Tt(t,Gt,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Q(Gt,e,r),t[0]=Gt[0],t[1]=Gt[1],t[2]=Gt[2],t[3]=1+n,ce(t,t))}),he=(zt=St(),Ht=St(),function(t,e,r,n,o,i){return Ut(zt,e,o,i),Ut(Ht,r,n,i),Ut(t,zt,Ht,2*i*(1-i)),t}),ye=(Wt=new b(9),b!=Float32Array&&(Wt[1]=0,Wt[2]=0,Wt[3]=0,Wt[5]=0,Wt[6]=0,Wt[7]=0),Wt[0]=1,Wt[4]=1,Wt[8]=1,Yt=Wt,function(t,e,r,n){return Yt[0]=r[0],Yt[3]=r[1],Yt[6]=r[2],Yt[1]=n[0],Yt[4]=n[1],Yt[7]=n[2],Yt[2]=-e[0],Yt[5]=-e[1],Yt[8]=-e[2],ce(t,Nt(t,Yt))});function pe(t){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(t)}function me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,be(n.key),n)}}function be(t){var e=function(t,e){if("object"!==pe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===pe(e)?e:String(e)}var ve=function(){function t(e,r,n){var o,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(i=be(i="_calculateMatrix"))in o?Object.defineProperty(o,i,{value:false,enumerable:!0,configurable:!0,writable:!0}):o[i]=false,this._translation=e,this._rotation=r,this._scale=n,this._matrix=T(d(),r,e,n)}var e,r,n;return e=t,n=[{key:"init",value:function(){return new this(M(0,0,0),Kt(0,0,0,1),M(1,1,1))}},{key:"fromMatrix",value:function(t){return new this(w(O(),t),E(St(),t),S(O(),t))}}],(r=[{key:"copy",value:function(){return new t(M(this._translation[0],this._translation[1],this._translation[2]),Kt(this._rotation[0],this._rotation[1],this._rotation[2],this._rotation[3]),M(this._scale[0],this._scale[1],this._scale[2]))}},{key:"translation",get:function(){return this._translation},set:function(t){this._translation=t,this._calculateMatrix=!0}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this._calculateMatrix=!0}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this._calculateMatrix=!0}},{key:"matrix",get:function(){return this._calculateMatrix&&(this._matrix=T(d(),this._rotation,this._translation,this._scale),this._calculateMatrix=!1),this._matrix}}])&&me(e.prototype,r),n&&me(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function de(t){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(t)}function _e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,we(n.key),n)}}function ge(t,e,r){return(e=we(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function we(t){var e=function(t,e){if("object"!==de(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===de(e)?e:String(e)}var Se=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ge(this,"_worldTransform",d()),ge(this,"_localTransform",ve.init()),ge(this,"_parent",null),ge(this,"_children",[])}var e,r;return e=t,(r=[{key:"translation",get:function(){return this._localTransform.translation},set:function(t){this._localTransform.translation=t}},{key:"worldTranslation",get:function(){return w(O(),this._worldTransform)}},{key:"rotation",get:function(){return this._localTransform.rotation},set:function(t){this._localTransform.rotation=t}},{key:"scale",get:function(){return this._localTransform.scale},set:function(t){this._localTransform.scale=t}},{key:"localTransform",get:function(){return this._localTransform}},{key:"worldTransform",get:function(){return this._worldTransform}},{key:"setChild",value:function(t){t._parent=this,this._children.push(t)}},{key:"traverse",value:function(t){t(this);for(var e=0,r=this._children.length;e<r;e++)this._children[e].traverse(t)}},{key:"updateMatrixWorld",value:function(){this.traverse((function(t){return t.calculateTransforms()}))}},{key:"calculateTransforms",value:function(){null===this._parent?_(this._worldTransform,this._localTransform.matrix):this._worldTransform=g(d(),this._parent.worldTransform,this._localTransform.matrix)}}])&&_e(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ee(t){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ee(t)}function Te(t,e){return Te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Te(t,e)}function Pe(t){return Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pe(t)}var je=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Te(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pe(r);if(n){var o=Pe(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ee(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this)).geometry=t,r.material=e,r}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(Se);function Oe(t){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oe(t)}function xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Oe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Oe(o)?o:String(o)),n)}var o}function ke(t,e){return ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ke(t,e)}function Me(t){return Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Me(t)}var Re=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ke(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Me(n);if(o){var r=Me(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Oe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,t,e)).geometry=t,r.material=e,r._skeleton=null,r}return e=a,(r=[{key:"skeleton",get:function(){if(null===this._skeleton)throw new Error("Skeleton for a mesh wasn't assigned yet.");return this._skeleton},set:function(t){this._skeleton=t}}])&&xe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(je);function Ae(t){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae(t)}function Ce(){Ce=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new M(n||[]);return o(a,"_invoke",{value:j(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",y="suspendedYield",p="executing",m="completed",b={};function v(){}function d(){}function _(){}var g={};s(g,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(g=S);var E=_.prototype=v.prototype=Object.create(g);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Ae(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=h;return function(i,a){if(o===p)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=O(u,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?m:y,s.arg===b)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,b;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ae(e)+" is not iterable")}return d.prototype=_,o(E,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:d,configurable:!0}),d.displayName=s(_,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,s(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},T(P.prototype),s(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new P(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(E),s(E,c,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},e}function Le(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ae(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ae(o)?o:String(o)),n)}var o}var Ie=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n,o;return e=t,null,r=[{key:"fromJson",value:(n=Ce().mark((function t(e,r,n){var o,i,a,u,c;return Ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=null,void 0!==e.bufferView&&(i=r[e.bufferView],a=n[i.buffer],u=new Uint8Array(a.arrayBuffer(),i.byteOffset,i.byteLength/Uint8Array.BYTES_PER_ELEMENT),c=new Blob([u],{type:e.mimeType}),o=URL.createObjectURL(c)),void 0!==e.uri&&e.uri.startsWith("data:")&&(o=e.uri),void 0===e.uri||e.uri.startsWith("data:")||(o="/image/".concat(e.uri)),null!==o){t.next=6;break}throw new Error("Cannot decode gltf image uri.");case 6:return t.next=8,this.resolveImage(o);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){Le(i,r,o,a,u,"next",t)}function u(t){Le(i,r,o,a,u,"throw",t)}a(void 0)}))},function(t,e,r){return o.apply(this,arguments)})},{key:"resolveImage",value:function(t){return new Promise((function(e,r){var n=new globalThis.Image;n.onload=function(){return e(n)},n.onerror=function(){return r(new Error("Cannot fetch image from file."))},n.src=t}))}}],r&&Ue(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Fe(t){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(t)}function Be(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Fe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Fe(o)?o:String(o)),n)}var o}var Ne=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.image=null,this.imageRepeat=!1,this.normal=null,this.normalRepeat=!1,this.color=null,this.vertexColors=!1,this.castShadow=!0,this.blending=!1}var e,r;return e=t,r=[{key:"setImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.image=t,this.imageRepeat=e,this}},{key:"setNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.normal=t,this.normalRepeat=e,this}},{key:"setColor",value:function(t){return this.color=t,this}},{key:"disableShadows",value:function(){return this.castShadow=!1,this}},{key:"useVertexColors",value:function(){return this.vertexColors=!0,this}},{key:"useBlending",value:function(){return this.blending=!0,this}}],r&&Be(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function De(t){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De(t)}function Xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==De(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===De(o)?o:String(o)),n)}var o}var Ge=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromJson",value:function(t,e){var r;if(void 0===t)return(new Ne).setColor(M(.4,.4,.4));var n=null===(r=t.pbrMetallicRoughness)||void 0===r||null===(r=r.baseColorTexture)||void 0===r?void 0:r.index;if(void 0===n)throw new Error("Only textured material is supported now.");return(new Ne).setImage(e[n])}}],null&&Xe(e.prototype,null),r&&Xe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ve(t){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ve(t)}function qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ve(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ve(o)?o:String(o)),n)}var o}function ze(t,e,r){return e&&qe(t.prototype,e),r&&qe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var He=ze((function t(e,r,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.data=r,this.itemSize=n,this.normalized=o}));function We(t){return We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We(t)}function Ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ke(n.key),n)}}function Je(t,e,r){return(e=Ke(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ke(t){var e=function(t,e){if("object"!==We(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==We(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===We(e)?e:String(e)}var Qe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Je(this,"attributes",[]),Je(this,"updateBuffers",!1),Je(this,"count",0),Je(this,"index",null),this.id=t.count++}var e,r;return e=t,r=[{key:"setAttribute",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.attributes.push(new He(t,e,r,n)),this.updateBuffers=!0}},{key:"setEmptyAttribute",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.attributes.push(new He(t,new Float32Array(e),r,n)),this.updateBuffers=!0}},{key:"indexed",get:function(){return null!==this.index}},{key:"attributesLength",get:function(){for(var t=0,e=0;e<this.attributes.length;e++)t+=this.attributes[e].itemSize;return t}}],r&&Ye(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();Je(Qe,"count",0);var Ze={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",TEXCOORD_3:"uv4",TEXCOORD_4:"uv5",TEXCOORD_5:"uv6",TEXCOORD_6:"uv7",COLOR_0:"color",WEIGHTS_0:"weights",JOINTS_0:"joints"},$e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tr(t){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tr(t)}function er(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function rr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==tr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===tr(o)?o:String(o)),n)}var o}var nr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromJson",value:function(t,e,r){if(t.primitives.length>1)throw new Error("Mesh with multi-primitives are not supported.");var n,o,i=t.primitives[0].indices,a=t.primitives[0].attributes,u=t.primitives[0].material,c=new Qe;void 0!==i&&(c.index=e[i].data,c.count=c.index.length);for(var s=0,l=Object.entries(a);s<l.length;s++){var f=(n=l[s],o=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(n,o)||function(t,e){if(t){if("string"==typeof t)return er(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?er(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),h=f[0],y=f[1],p=Ze[h],m=e[y];if(void 0===p||void 0===m)throw new Error('Cannot create geometry attribute from name "'.concat(h,'".'));"position"===p&&void 0===i&&(c.count=m.length/$e[m.type]),c.setAttribute("a_"+p,e[y].data,$e[m.type])}return new je(c,r[u])}}],null&&rr(e.prototype,null),r&&rr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function ir(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==or(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===or(o)?o:String(o)),n)}var o}var ar=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.tracks=[],this.startTime=1/0,this.endTime=0,this.duration=0}var e,r;return e=t,(r=[{key:"sample",value:function(t,e){for(var r=t.copy,n=0;n<this.tracks.length;n++){var o=this.tracks[n].id,i=r.getLocalTransform(o),a=this.tracks[n].sample(i,e);r.setLocalTransform(o,a)}return r}},{key:"recalculateDuration",value:function(){for(var t=0;t<this.tracks.length;t++)this.startTime=Math.min(this.startTime,this.tracks[t].startTime),this.endTime=Math.max(this.endTime,this.tracks[t].endTime);this.duration=this.endTime-this.startTime}}])&&ir(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),ur=function(t){return t.LINEAR="LINEAR",t.STEP="STEP",t.CUBICSPLINE="CUBICSPLINE",t}({});function cr(t){return cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cr(t)}function sr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,fr(n.key),n)}}function lr(t,e,r){return(e=fr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fr(t){var e=function(t,e){if("object"!==cr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==cr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===cr(e)?e:String(e)}var hr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),lr(this,"translation",null),lr(this,"rotation",null),lr(this,"scale",null),this.id=e}var e,r;return e=t,(r=[{key:"sample",value:function(t,e){return null!==this.translation&&(t.translation=this.translation.sample(e)),null!==this.rotation&&(t.rotation=this.rotation.sample(e)),null!==this.scale&&(t.scale=this.scale.sample(e)),t}},{key:"startTime",get:function(){var t=1/0;if(null!==this.translation&&(t=Math.min(t,this.translation.startTime)),null!==this.rotation&&(t=Math.min(t,this.rotation.startTime)),null!==this.scale&&(t=Math.min(t,this.scale.startTime)),t===1/0)throw new Error("Cannot calculate start time: no available tracks.");return t}},{key:"endTime",get:function(){var t=0;if(null!==this.translation&&(t=Math.max(t,this.translation.endTime)),null!==this.rotation&&(t=Math.max(t,this.rotation.endTime)),null!==this.scale&&(t=Math.max(t,this.scale.endTime)),0===t)throw new Error("Cannot calculate end time: no available tracks.");return t}}])&&sr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function yr(t){return yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yr(t)}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==yr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===yr(o)?o:String(o)),n)}var o}var mr=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.time=e,this.value=r}var e,r;return e=t,(r=[{key:"interpolate",value:function(t,e,r){if(r===ur.STEP)return this.value;if(r===ur.LINEAR)return Z(O(),this.value,t.value,e);if(r===ur.CUBICSPLINE)throw new Error("Cubic spline vector interpolation is not implemented.");throw new Error('Unrecognized vector interpolation: "'.concat(r,'".'))}}])&&pr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function br(t){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},br(t)}function vr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==br(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===br(o)?o:String(o)),n)}var o}var dr=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ur.LINEAR;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._frames=e,this._interpolation=r}var e,r;return e=t,(r=[{key:"sample",value:function(t){var e=this.getFrameIndexAt(t),r=this._frames[e],n=this._frames[e+1];if(void 0===n)throw new Error("Can't sample track: next frame doesn't exists.");var o=(t-r.time)/(n.time-r.time);return r.interpolate(n,o,this._interpolation)}},{key:"startTime",get:function(){return this._frames.reduce((function(t,e){return Math.min(t,e.time)}),1/0)}},{key:"endTime",get:function(){return this._frames.reduce((function(t,e){return Math.max(t,e.time)}),0)}},{key:"getFrameIndexAt",value:function(t){for(var e=0;e<this._frames.length;e++)if(this._frames[e].time>=t)return Math.max(1,e)-1;throw new Error("Can't get current frame index at time \"".concat(t,'": time is out of bounds.'))}}])&&vr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function _r(t){return _r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_r(t)}function gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==_r(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==_r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===_r(o)?o:String(o)),n)}var o}var wr=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.time=e,this.value=r}var e,r;return e=t,(r=[{key:"interpolate",value:function(t,e,r){if(r===ur.STEP)return this.value;if(r===ur.LINEAR)return Ut(St(),this.value,t.value,e);if(r===ur.CUBICSPLINE)throw new Error("Cubic spline quaternion interpolation is not implemented.");throw new Error('Unrecognized quaternion interpolation: "'.concat(r,'".'))}}])&&gr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Sr(t){return Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sr(t)}function Er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Sr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Sr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Sr(o)?o:String(o)),n)}var o}var Tr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromJson",value:function(t,e,r){for(var n,o=null!==(n=t.name)&&void 0!==n?n:"animation_".concat(e),i=new ar(o),a=0;a<t.channels.length;a++){var u=t.channels[a],c=u.target.node,s=u.target.path,l=t.samplers[u.sampler],f=r[l.input].data,h=r[l.output].data;if(void 0!==c){var y=ur.LINEAR;if("STEP"===l.interpolation&&(y=ur.STEP),"CUBICSPLINE"===l.interpolation)throw new Error("GLTF: cubic spline interpolation is not implemented.");var p=new hr(c),m=h.length/f.length;if("translation"===s){for(var b=[],v=0;v<f.length;v++)b.push(new mr(f[v],h.slice(v*m,v*m+m)));p.translation=new dr(b,y)}if("rotation"===s){for(var d=[],_=0;_<f.length;_++)d.push(new wr(f[_],h.slice(_*m,_*m+m)));p.rotation=new dr(d,y)}if("scale"===s){for(var g=[],w=0;w<f.length;w++)g.push(new mr(f[w],h.slice(w*m,w*m+m)));p.scale=new dr(g,y)}i.tracks.push(p)}}return i.recalculateDuration(),i}}],null&&Er(e.prototype,null),r&&Er(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Pr(t){return Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pr(t)}function jr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rr(n.key),n)}}function Or(){return Or="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Mr(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Or.apply(this,arguments)}function xr(t,e){return xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xr(t,e)}function kr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mr(t){return Mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mr(t)}function Rr(t){var e=function(t,e){if("object"!==Pr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Pr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Pr(e)?e:String(e)}var Ar=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xr(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mr(n);if(o){var r=Mr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Pr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return kr(t)}(this,t)});function a(){var t,e,r,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e=kr(t=i.call(this)),r="_boneTransform",n=d(),(r=Rr(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,t._boneTransform=d(),t}return e=a,(r=[{key:"calculateTransforms",value:function(){Or(Mr(a.prototype),"calculateTransforms",this).call(this),this._parent instanceof a?this._boneTransform=g(d(),this._parent._boneTransform,this._localTransform.matrix):_(this._boneTransform,this._localTransform.matrix)}},{key:"boneTransform",get:function(){return this._boneTransform}}])&&jr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Se);function Cr(t){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cr(t)}function Lr(t){return function(t){if(Array.isArray(t))return Ur(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ur(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ur(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ur(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ir(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Cr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Cr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Cr(o)?o:String(o)),n)}var o}var Fr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,o;return n=t,o=[{key:"fromJson",value:function(t,n,o,i){var a=new Se;if(this.isBone(n,o)&&(a=new Ar),this.isMesh(t)){var u=i[t.mesh];a=new je(u.geometry,u.material)}if(this.isSkinnedMesh(t)){var c=i[t.mesh];a=new Re(c.geometry,c.material)}return void 0!==t.matrix&&(a.translation=w(O(),t.matrix),a.rotation=E(St(),t.matrix),a.scale=S(O(),t.matrix)),void 0!==t.translation&&(a.translation=M.apply(e,Lr(t.translation))),void 0!==t.rotation&&(a.rotation=Kt.apply(r,Lr(t.rotation))),void 0!==t.scale&&(a.scale=M.apply(e,Lr(t.scale))),a}},{key:"isMesh",value:function(t){return void 0!==t.mesh&&void 0===t.skin}},{key:"isSkinnedMesh",value:function(t){return void 0!==t.mesh&&void 0!==t.skin}},{key:"isBone",value:function(t,e){for(var r=0;r<e.length;r++)if(e[r].joints.includes(t))return!0;return!1}}],null&&Ir(n.prototype,null),o&&Ir(n,o),Object.defineProperty(n,"prototype",{writable:!1}),t}();function Br(t){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Br(t)}function Nr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Br(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Br(o)?o:String(o)),n)}var o}var Dr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bindPose=e.copy,this.currentPose=e,this._joints=[],this._inverseBindPose=[]}var e,r;return e=t,(r=[{key:"getBone",value:function(t){return this._joints[t]}},{key:"addJoint",value:function(t,e){this._joints.push(t),this._inverseBindPose.push(e)}},{key:"jointMatrix",get:function(){for(var t=this._joints.length,e=new Float32Array(16*t),r=0;r<t;r++)e.set(g(d(),this._joints[r].boneTransform,this._inverseBindPose[r]),16*r);return e}},{key:"jointCount",get:function(){return this._joints.length}}])&&Nr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Xr(t){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xr(t)}function Gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Xr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Xr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Xr(o)?o:String(o)),n)}var o}var Vr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._nodes=e,this._names=r}var e,r;return e=t,(r=[{key:"apply",value:function(t){for(var e=0;e<this._nodes.length;e++){var r=t._nodes[e],n=this._nodes[e];n.translation=r.translation,n.rotation=r.rotation,n.scale=r.scale}}},{key:"addNode",value:function(t,e){this._nodes.push(e),this._names.push(t)}},{key:"getLocalTransform",value:function(t){if(void 0===this._nodes[t])throw new Error('Cannot get global transform for index "'.concat(t,'": undefined node.'));return this._nodes[t]}},{key:"setLocalTransform",value:function(t,e){this._nodes[t]=e}},{key:"blendTo",value:function(t,e){for(var r=this.copy,n=0;n<this._nodes.length;n++){var o=this._nodes[n],i=t._nodes[n];r._nodes[n]=new ve(Z(O(),o.translation,i.translation,e),Ut(St(),o.rotation,i.rotation,e),Z(O(),o.scale,i.scale,e))}return r}},{key:"copy",get:function(){return new t(this._nodes.map((function(t){return t.copy()})),this._names.map((function(t){return t})))}}])&&Gr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qr(t){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qr(t)}function zr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==qr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===qr(o)?o:String(o)),n)}var o}var Hr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromJson",value:function(t,e,r){for(var n=e[t.inverseBindMatrices].data,o=new Vr,i=0;i<r.length;i++){r[i];var a=r[i];o.addNode("node_".concat(i),a.localTransform)}for(var u=new Dr(o),c=0;c<t.joints.length;c++){var s=t.joints[c],l=n.slice(16*c,16*(c+1)),f=r[s];f instanceof Ar&&u.addJoint(f,l)}return u}}],null&&zr(e.prototype,null),r&&zr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Wr(t){return Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wr(t)}function Yr(){Yr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new M(n||[]);return o(a,"_invoke",{value:j(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",y="suspendedYield",p="executing",m="completed",b={};function v(){}function d(){}function _(){}var g={};s(g,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(g=S);var E=_.prototype=v.prototype=Object.create(g);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Wr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=h;return function(i,a){if(o===p)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=O(u,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?m:y,s.arg===b)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,b;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Wr(e)+" is not iterable")}return d.prototype=_,o(E,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:d,configurable:!0}),d.displayName=s(_,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,s(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},T(P.prototype),s(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new P(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(E),s(E,c,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},e}function Jr(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Kr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Jr(i,n,o,a,u,"next",t)}function u(t){Jr(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Wr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Wr(o)?o:String(o)),n)}var o}var Zr=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._defaultScene=e,this._scenes=r,this._nodes=n,this._animations=o,this._skins=i}var e,r,n,o,a;return e=t,r=[{key:"scene",get:function(){var t=this._scenes[this._defaultScene];if(void 0===t)throw new Error('Scene with index "'.concat(this._defaultScene,"\" doesn't exists."));for(var e=new Se,r=0;r<t.length;r++)e.setChild(this._nodes[t[r]]);var n=this._skins.length>0?this._skins[0]:null,o=this._animations.length>0?this._animations:null;return e.traverse((function(t){t instanceof Re&&(t.skeleton=n)})),[e,n,o]}}],n=[{key:"parseBinary",value:(a=Kr(Yr().mark((function t(e){var r,n,o,i,a,u,c,s,l;return Yr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1179937895===(r=new Uint32Array(e,0,3))[0]){t.next=3;break}throw new Error("GLB magic number is not valid.");case 3:if(2===r[1]){t.next=5;break}throw new Error("GLTF versions other than ".concat(r[1]," are not implemented."));case 5:if(n=new Uint32Array(e,12,2),o=20,i=n[0],1313821514===n[1]){t.next=10;break}throw new Error("Unexpected GLB layout.");case 10:if(a=(new TextDecoder).decode(e.slice(o,o+i)),u=JSON.parse(a),o+i!==e.byteLength){t.next=14;break}return t.abrupt("return",u);case 14:if(5130562===(c=new Uint32Array(e,o+i,2))[1]){t.next=17;break}throw new Error("Unexpected GLB layout.");case 17:return s=o+i+8,l=c[0],u.buffers[0].binary=e.slice(s,s+l),t.abrupt("return",this.parse(u));case 21:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"parse",value:(o=Kr(Yr().mark((function t(e){var r,n,o,a,u,s,l,f,h,y,m,b,v;return Yr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("2.0"===e.asset.version){t.next=2;break}throw new Error("GLTF versions other than ".concat(e.asset.version," are not implemented."));case 2:if(o=null!==(r=e.scene)&&void 0!==r?r:0,a=e.scenes?e.scenes.map((function(t){return t.nodes})):[],u=e.bufferViews?e.bufferViews.map((function(t){return c.fromJson(t)})):[],!e.buffers){t.next=11;break}return t.next=8,Promise.all(e.buffers.map((function(t){return p.fromJson(t)})));case 8:t.t0=t.sent,t.next=12;break;case 11:t.t0=[];case 12:if(s=t.t0,l=e.accessors?e.accessors.map((function(t){return i.fromJson(t,u,s)})):[],!e.images){t.next=20;break}return t.next=17,Promise.all(e.images.map((function(t){return Ie.fromJson(t,u,s)})));case 17:t.t1=t.sent,t.next=21;break;case 20:t.t1=[];case 21:return f=t.t1,h=e.materials?e.materials.map((function(t){return Ge.fromJson(t,f)})):[],y=e.meshes?e.meshes.map((function(t){return nr.fromJson(t,l,h)})):[],m=e.animations?e.animations.map((function(t,e){return Tr.fromJson(t,e,l)})):[],b=e.nodes?e.nodes.map((function(t,r){var n;return Fr.fromJson(t,r,null!==(n=e.skins)&&void 0!==n?n:[],y)})):[],v=e.skins?e.skins.map((function(t){return Hr.fromJson(t,l,b)})):[],null===(n=e.nodes)||void 0===n||n.forEach((function(t,e){var r;null===(r=t.children)||void 0===r||r.forEach((function(t){b[e].setChild(b[t])}))})),t.abrupt("return",new this(o,a,b,m,v));case 29:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})}],r&&Qr(e.prototype,r),n&&Qr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $r(t){return $r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$r(t)}function tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rn(n.key),n)}}function en(t,e,r){return(e=rn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rn(t){var e=function(t,e){if("object"!==$r(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==$r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===$r(e)?e:String(e)}var nn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),en(this,"_assetsCount",0),en(this,"_assetsLoaded",0),this._afterLoad=function(){},this._queue=[],this._shaders=new Map,this._images=new Map,this._models=new Map}var e,r;return e=t,(r=[{key:"load",value:function(t){this._afterLoad=t,this._queue.forEach((function(t){return t()}))}},{key:"importShader",value:function(t,e){var r=this;this._assetsCount++,this._queue.push((function(){return fetch(e).then((function(t){return t.text()})).then((function(e){r._shaders.set(t,e),r._assetsLoaded++,r.checkAssets()})).catch((function(t){throw new Error(t)}))}))}},{key:"importImage",value:function(t,e){var r=this;this._assetsCount++,this._queue.push((function(){var n=new Image;n.onload=function(){r._images.set(t,n),r._assetsLoaded++,r.checkAssets()},n.src=e}))}},{key:"importModel",value:function(t,e){var r=this;this._assetsCount++,this._queue.push((function(){return fetch(e).then((function(t){return t.json()})).then((function(t){return Zr.parse(t)})).then((function(e){r._models.set(t,e),r._assetsLoaded++,r.checkAssets()})).catch((function(t){throw new Error(t)}))}))}},{key:"importBinaryModel",value:function(t,e){var r=this;this._assetsCount++,this._queue.push((function(){return fetch(e).then((function(t){return t.arrayBuffer()})).then((function(t){return Zr.parseBinary(t)})).then((function(e){r._models.set(t,e),r._assetsLoaded++,r.checkAssets()})).catch((function(t){throw new Error(t)}))}))}},{key:"shader",value:function(t){if(!this._shaders.has(t))throw new Error('Shader "'.concat(t,'" not found in assets.'));return this._shaders.get(t)}},{key:"image",value:function(t){if(!this._images.has(t))throw new Error('Image "'.concat(t,'" not found in assets.'));return this._images.get(t)}},{key:"model",value:function(t){if(!this._models.has(t))throw new Error('Model "'.concat(t,'" not found in assets.'));return this._models.get(t)}},{key:"checkAssets",value:function(){this._assetsLoaded===this._assetsCount&&this._afterLoad()}}])&&tn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function on(t){return on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},on(t)}function an(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==on(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==on(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===on(o)?o:String(o)),n)}var o}var un=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._debug=e,this._oldTimestamp=0,this._active=!1,this._onRender=function(){return null}}var e,r;return e=t,(r=[{key:"start",value:function(t){this._onRender=t,this._active=!0,requestAnimationFrame(this.run.bind(this))}},{key:"stop",value:function(){this._active=!1}},{key:"run",value:function(t){var e=performance.now(),r=(t-this._oldTimestamp)/1e3;this._oldTimestamp=t,this._onRender(r,t/1e3),null!==this._debug&&(this._debug.fps=1/r,this._debug.cpuTime=performance.now()-e),this._active&&requestAnimationFrame(this.run.bind(this))}}])&&an(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function cn(t){return cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cn(t)}function sn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==cn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===cn(o)?o:String(o)),n)}var o}var ln=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.addEventListener("keydown",this.bindKeyDown.bind(this)),e.addEventListener("keyup",this.bindKeyUp.bind(this)),this.any=!1,this.forward=!1,this.right=!1,this.back=!1,this.left=!1,this.shift=!1}var e,r;return e=t,(r=[{key:"bindKeyDown",value:function(t){switch(this.any=!0,t.code){case"KeyW":case"ArrowUp":this.forward=!0;break;case"KeyD":case"ArrowRight":this.right=!0;break;case"KeyS":case"ArrowDown":this.back=!0;break;case"KeyA":case"ArrowLeft":this.left=!0;break;case"ShiftLeft":this.shift=!0}}},{key:"bindKeyUp",value:function(t){switch(this.any=!1,t.code){case"KeyW":case"ArrowUp":this.forward=!1;break;case"KeyD":case"ArrowRight":this.right=!1;break;case"KeyS":case"ArrowDown":this.back=!1;break;case"KeyA":case"ArrowLeft":this.left=!1;break;case"ShiftLeft":this.shift=!1}}}])&&sn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function fn(t){return fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fn(t)}function hn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==fn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==fn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===fn(o)?o:String(o)),n)}var o}var yn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.addEventListener("mouseup",this.mouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("wheel",this.mouseWheel.bind(this)),this._clicked=!1,this._scrolling=!1,this._offsetX=0,this._mouseOffsetX=0,this._lastMouseOffsetX=0,this._wheelOffset=0,this._mouseWheelOffset=0,this._lastMouseWheelOffset=0}var e,r;return e=t,(r=[{key:"update",value:function(){this._clicked&&(this._offsetX=this._mouseOffsetX-this._lastMouseOffsetX,this._lastMouseOffsetX=this._mouseOffsetX),this._scrolling=this._lastMouseWheelOffset!=this._mouseWheelOffset,this._scrolling&&(this._wheelOffset=this._mouseWheelOffset-this._lastMouseWheelOffset,this._lastMouseWheelOffset=this._mouseWheelOffset)}},{key:"mouseDown",value:function(t){this._clicked=!0,this._lastMouseOffsetX=t.clientX}},{key:"mouseUp",value:function(){this._clicked=!1}},{key:"mouseMove",value:function(t){this._mouseOffsetX=t.clientX}},{key:"mouseWheel",value:function(t){this._mouseWheelOffset+=t.deltaY}}])&&hn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),pn=function(t){return t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT",t}({});function mn(t){return mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mn(t)}function bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dn(n.key),n)}}function vn(t,e,r){return(e=dn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function dn(t){var e=function(t,e){if("object"!==mn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==mn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===mn(e)?e:String(e)}var _n=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),vn(this,"_fov",45),vn(this,"_near",.1),vn(this,"_far",200),vn(this,"_zoomFactor",.01),vn(this,"_zoomMin",5),vn(this,"_zoomMax",40),vn(this,"_rotateFactor",.01),vn(this,"_projectionChanged",!0),vn(this,"_viewChanged",!0),vn(this,"_projectionViewChanged",!0),vn(this,"_orbit",!0),this._width=e.width,this._height=e.height,this._mouseInput=n,this._worldUp=M(0,1,0),this._position=r,this._target=M(0,0,0),this._projectionMatrix=d(),this._viewMatrix=d(),this._projectionViewMatrix=d(),this._direction=J(O(),L(O(),this._position,this._target)),this._followTarget=null,this._previousTargetPosition=null,this.screenPosition=null}var e,r;return e=t,(r=[{key:"update",value:function(t){if(this._orbit&&(at(this._position,this._position,this._target,.1*t),this.calculateViewMatrix()),this._mouseInput._scrolling){var e=O();G(e,this._direction,this._mouseInput._wheelOffset*this._zoomFactor);var r=C(O(),this._position,e),n=k(L(O(),r,this._target));n>this._zoomMin&&n<this._zoomMax&&(G(e,this._direction,this._mouseInput._wheelOffset*this._zoomFactor),this._position=r,J(this._direction,L(O(),this._position,this._target)),this.calculateViewMatrix())}if(this._mouseInput._clicked){var o=-this._mouseInput._offsetX*this._rotateFactor;at(this._position,this._position,this._target,o),this.calculateViewMatrix()}if(null!==this._followTarget&&null!==this._previousTargetPosition){var i=x(this._followTarget.translation);i[1]=1.3;var a=i[0]-this._previousTargetPosition[0],u=i[2]-this._previousTargetPosition[2];this._position[0]+=a,this._position[2]+=u,this._target=i,this._previousTargetPosition=i,J(this._direction,L(O(),this._position,this._target)),this.calculateViewMatrix()}}},{key:"follow",value:function(t){this._followTarget=t,this._previousTargetPosition=t.translation}},{key:"flatDirection",get:function(){return this._direction[1]=0,this._direction}},{key:"viewMatrix",get:function(){return this._viewChanged&&(j(this._viewMatrix,this._position,this._target,this._worldUp),this._viewChanged=!1),this._viewMatrix}},{key:"projectionMatrix",get:function(){return this._projectionChanged&&(P(this._projectionMatrix,this._fov,this._width/this._height,this._near,this._far),this._projectionChanged=!1),this._projectionMatrix}},{key:"projectionViewMatrix",get:function(){return this._projectionViewChanged&&(g(this._projectionViewMatrix,this.projectionMatrix,this.viewMatrix),this._projectionViewChanged=!1),this._projectionViewMatrix}},{key:"calculateViewMatrix",value:function(){this._viewChanged=!0,this._projectionViewChanged=!0}},{key:"calculateProjectionMatrix",value:function(){this._projectionChanged=!0,this._projectionViewChanged=!0}},{key:"rotY",get:function(){var t=E(St(),this.viewMatrix),e=Math.atan2(t[1],t[3]);return Kt(0,Math.sin(e),0,Math.cos(e))}},{key:"invertRotY",get:function(){return Ft(St(),this.rotY)}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"stopOrbiting",value:function(){this._orbit=!1}},{key:"splitScreen",value:function(t){t!==pn.TOP&&t!==pn.BOTTOM||(this._height/=2,this.calculateProjectionMatrix()),t!==pn.LEFT&&t!==pn.RIGHT||(this._width/=2,this.calculateProjectionMatrix()),this.screenPosition=t}}])&&bn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function gn(t){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(t)}function wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==gn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==gn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===gn(o)?o:String(o)),n)}var o}var Sn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._currentClip=null,this._clips={},this._time=null,this._speed=1,this._skeleton=e,this._fadeTargets=[],this._fadeParallel=!1,this._fadeTime=0,this._fadeDuration=.25}var e,r;return e=t,r=[{key:"addClip",value:function(t,e){this._clips[t]=e}},{key:"play",value:function(t){var e;(null===(e=this._currentClip)||void 0===e?void 0:e.name)!==t&&(this._currentClip=this._clips[t],this._time=null)}},{key:"fadeTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._fadeTargets.length>0?this._fadeTargets[1]=this._clips[t]:(this._fadeTargets.push(this._clips[t]),this._fadeParallel=e)}},{key:"update",value:function(t){if(null!==this._currentClip){null===this._time&&(this._time=this._currentClip.startTime);var e=t*this._speed;this._time+=e,this._time>this._currentClip.endTime&&(this._time=Math.max(this._time%this._currentClip.duration,this._currentClip.startTime));var r=this._currentClip.sample(this._skeleton.bindPose,this._time);if(this._fadeTargets.length>0){this._fadeTime+=e;var n=this._fadeTargets[0],o=this._fadeTime;if(this._fadeParallel&&(o=this._time/this._currentClip.duration*n.duration),this._fadeTime>this._fadeDuration)this._currentClip=this._fadeTargets.shift(),this._time=o,this._fadeTime=0,r=this._currentClip.sample(this._skeleton.bindPose,o);else{var i=this._fadeTime/this._fadeDuration,a=n.sample(this._skeleton.bindPose,o);r=r.blendTo(a,i)}}this._skeleton.currentPose.apply(r)}}}],r&&wn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function En(t){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},En(t)}function Tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==En(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==En(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===En(o)?o:String(o)),n)}var o}var Pn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._states={},this._currentState=null}var e,r;return e=t,(r=[{key:"addState",value:function(t,e){this._states[t]=e}},{key:"setState",value:function(t){var e=this._currentState;if(e){if(e.name==t)return;e.exit()}var r=this._states[t];this._currentState=r,r.enter(e)}},{key:"update",value:function(t){this._currentState&&this._currentState.update(t)}}])&&Tn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function jn(t){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jn(t)}function On(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==jn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===jn(o)?o:String(o)),n)}var o}function xn(t,e,r){return e&&On(t.prototype,e),r&&On(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var kn=xn((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));function Mn(t){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mn(t)}function Rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Mn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Mn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Mn(o)?o:String(o)),n)}var o}function An(t,e){return An=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},An(t,e)}function Cn(t){return Cn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Cn(t)}var Ln=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&An(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Cn(n);if(o){var r=Cn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this))._parent=t,e}return e=a,(r=[{key:"name",get:function(){return"idle"}},{key:"enter",value:function(t){null!==t?this._parent.animations.fadeTo("idle"):this._parent.animations.play("idle")}},{key:"exit",value:function(){}},{key:"update",value:function(){this._parent.moving&&this._parent.setState("walk")}}])&&Rn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(kn);function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function In(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Un(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Un(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Un(o)?o:String(o)),n)}var o}function Fn(t,e){return Fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fn(t,e)}function Bn(t){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bn(t)}var Nn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fn(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bn(n);if(o){var r=Bn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this))._parent=t,e}return e=a,(r=[{key:"name",get:function(){return"walk"}},{key:"enter",value:function(t){t&&"idle"===t.name?this._parent.animations.fadeTo("walk"):this._parent.animations.fadeTo("walk",!0)}},{key:"exit",value:function(){}},{key:"update",value:function(){this._parent.moving||this._parent.running||this._parent.setState("idle"),this._parent.moving&&this._parent.running&&this._parent.setState("run")}}])&&In(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(kn);function Dn(t){return Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dn(t)}function Xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Dn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Dn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Dn(o)?o:String(o)),n)}var o}function Gn(t,e){return Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gn(t,e)}function Vn(t){return Vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vn(t)}var qn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gn(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Vn(n);if(o){var r=Vn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this))._parent=t,e}return e=a,(r=[{key:"name",get:function(){return"run"}},{key:"enter",value:function(t){this._parent.animations.fadeTo("run",!0)}},{key:"exit",value:function(){}},{key:"update",value:function(){this._parent.moving?this._parent.running||this._parent.setState("walk"):this._parent.setState("idle")}}])&&Xn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(kn);function zn(t){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zn(t)}function Hn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Zn(n.key),n)}}function Wn(){return Wn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Kn(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Wn.apply(this,arguments)}function Yn(t,e){return Yn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yn(t,e)}function Jn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Kn(t){return Kn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kn(t)}function Qn(t,e,r){return(e=Zn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zn(t){var e=function(t,e){if("object"!==zn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==zn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===zn(e)?e:String(e)}var $n=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Kn(o);if(i){var r=Kn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===zn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Jn(t)}(this,t)});function u(t,e,r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Qn(Jn(o=a.call(this)),"_acceleration",7),Qn(Jn(o),"_deceleration",-4),Qn(Jn(o),"_velocity",0),Qn(Jn(o),"_rotationTime",.5),Qn(Jn(o),"_currentRotationTime",0),Qn(Jn(o),"_previousAngle",0),o.animations=e,o._object=t,o._input=r,o._camera=n,o}return e=u,r=[{key:"update",value:function(t){if(Wn(Kn(u.prototype),"update",this).call(this,t),this.animations.update(t),this.moving){var e=M(0,0,1),r=M(0,0,0),n=this._camera.invertRotY,o=this._velocity*this._deceleration;o*=t,o=Math.sign(o)*Math.min(Math.abs(o),Math.abs(this._velocity)),this._velocity=this._velocity+o,this._velocity+=this._acceleration*t,this._input.forward&&(r[2]=-1),this._input.right&&(r[0]=1),this._input.back&&(r[2]=1),this._input.left&&(r[0]=-1);var i=Math.atan2(r[0],r[2]),a=kt(St(),n,i);i!==this._previousAngle&&(this._currentRotationTime=0,this._previousAngle=i),le(this._object.rotation,a)||(this._currentRotationTime+=t,Ut(this._object.rotation,this._object.rotation,a,this._currentRotationTime/this._rotationTime),this._currentRotationTime>=this._rotationTime&&(this._object.rotation=a)),this.running&&G(e,e,2.8),ot(e,e,this._object.rotation),G(e,e,this._velocity*t),this._object.translation=C(O(),this._object.translation,e)}else this._velocity=0}},{key:"moving",get:function(){return this._input.forward||this._input.right||this._input.back||this._input.left}},{key:"running",get:function(){return this._input.shift}},{key:"velocity",get:function(){return this._velocity}},{key:"previousAngle",get:function(){return this._previousAngle}}],n=[{key:"bind",value:function(t,e,r,n){var o=new u(t,e,r,n);return o.addState("idle",new Ln(o)),o.addState("walk",new Nn(o)),o.addState("run",new qn(o)),o.setState("idle"),o}}],r&&Hn(e.prototype,r),n&&Hn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Pn);function to(t){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},to(t)}function eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,io(n.key),n)}}function ro(t,e){return ro=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ro(t,e)}function no(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oo(t){return oo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oo(t)}function io(t){var e=function(t,e){if("object"!==to(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==to(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===to(e)?e:String(e)}var ao=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ro(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=oo(n);if(o){var r=oo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===to(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return no(t)}(this,t)});function a(){var t,e,r,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e=no(t=i.call(this)),n=[],(r=io(r="_directions"))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,t._intensity=1,t._directions=[{target:M(1,0,0),up:M(0,-1,0)},{target:M(-1,0,0),up:M(0,-1,0)},{target:M(0,1,0),up:M(0,0,1)},{target:M(0,-1,0),up:M(0,0,-1)},{target:M(0,0,1),up:M(0,-1,0)},{target:M(0,0,-1),up:M(0,-1,0)}],t}return e=a,r=[{key:"update",value:function(t){}},{key:"projectionViewMatrix",get:function(){return d()}},{key:"faces",get:function(){return this._directions.length}},{key:"intensity",get:function(){return this._intensity},set:function(t){this._intensity=t}},{key:"getFaceProjectionViewMatrix",value:function(t){var e=j(d(),this.worldTranslation,C(O(),this.worldTranslation,this._directions[t].target),this._directions[t].up),r=P(d(),Math.PI/2,1,.1,20);return g(d(),r,e)}}],r&&eo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Se);function uo(t){return uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uo(t)}function co(t,e){return co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},co(t,e)}function so(t){return so=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},so(t)}var lo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&co(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=so(r);if(n){var o=so(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===uo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this)).vertex=t,r.fragment=e,r.uniforms=new Map,r}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(Ne);function fo(t){return fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fo(t)}function ho(t,e){return ho=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ho(t,e)}function yo(t){return yo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yo(t)}var po=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ho(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yo(r);if(n){var o=yo(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===fo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this)).geometry=t,r.material=e,r}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(Se);function mo(t){return mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mo(t)}function bo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==mo(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==mo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===mo(o)?o:String(o)),n)}var o}function vo(t,e){return vo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vo(t,e)}function _o(t){return _o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_o(t)}var go=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vo(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_o(o);if(i){var r=_o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===mo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function u(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),a.apply(this,arguments)}return e=u,n=[{key:"create",value:function(t,e){var r=new lo(t.shader("fire_vertex"),t.shader("fire_fragment"));r.uniforms.set("u_resolution",[e.width,e.height]);var n=new Qe;return n.count=1,n.setEmptyAttribute("a_position",3,1),new u(n,r.useBlending().disableShadows())}}],(r=[{key:"update",value:function(t,e){var r=e.velocity,n=e.previousAngle/Math.PI%1,o=0;n<0?o=.25*r:n>0&&(o=.25*-r);var i=this.material;i.uniforms.set("u_time",t),i.uniforms.set("u_windFactor",o)}}])&&bo(e.prototype,r),n&&bo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(po);function wo(t){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wo(t)}function So(t,e){return So=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},So(t,e)}function Eo(t){return Eo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Eo(t)}var To=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&So(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Eo(r);if(n){var o=Eo(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this)).geometry=t,r.material=e,r}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(Se);function Po(t){return Po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Po(t)}function jo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Po(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Po(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Po(o)?o:String(o)),n)}var o}var Oo=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.objects=[],this.drawables=[],this.light=null}var e,r;return e=t,r=[{key:"addLight",value:function(t){return this.objects.push(t),this.light=t,this}},{key:"add",value:function(){for(var t,e=this,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];(t=this.objects).push.apply(t,n);for(var i=0;i<n.length;i++)n[i].traverse((function(t){t instanceof To||t instanceof je||t instanceof po?e.drawables.push(t):t instanceof ao&&(e.light=t)}));return this}},{key:"updateMatrixWorld",value:function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].updateMatrixWorld()}},{key:"traverse",value:function(t){for(var e=0,r=this.objects.length;e<r;e++)this.objects[e].traverse(t)}}],r&&jo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function xo(){var t=new b(2);return b!=Float32Array&&(t[0]=0,t[1]=0),t}function ko(t,e){var r=new b(2);return r[0]=t,r[1]=e,r}function Mo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ro(t){return Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ro(t)}function Ao(t){return function(t){if(Array.isArray(t))return Co(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Co(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Co(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Co(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Lo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ro(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ro(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ro(o)?o:String(o)),n)}var o}xo();var Uo=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=[],n=[],o=[],i=[],a=[],u=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)/2,c=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)/2,s=M(0,0,1),l=M(-u,c,0),f=M(-u,-c,0),h=M(u,-c,0),y=M(u,c,0),p=ko(0,1*e),m=ko(0,0),b=ko(1*t,0),v=ko(1*t,1*e),d=L(O(),f,l),_=L(O(),h,l),g=Mo(xo(),m,p),w=Mo(xo(),b,p),S=1/(g[0]*w[1]-w[0]*g[1]),E=O(),T=O();E[0]=S*(w[1]*d[0]-g[1]*_[0]),E[1]=S*(w[1]*d[1]-g[1]*_[1]),E[2]=S*(w[1]*d[2]-g[1]*_[2]),T[0]=S*(-w[0]*d[0]+g[0]*_[0]),T[1]=S*(-w[0]*d[1]+g[0]*_[1]),T[2]=S*(-w[0]*d[2]+g[0]*_[2]),d=L(O(),h,l),_=L(O(),y,l),g=Mo(xo(),b,p),w=Mo(xo(),v,p),S=1/(g[0]*w[1]-w[0]*g[1]);var P=O(),j=O();P[0]=S*(w[1]*d[0]-g[1]*_[0]),P[1]=S*(w[1]*d[1]-g[1]*_[1]),P[2]=S*(w[1]*d[2]-g[1]*_[2]),j[0]=S*(-w[0]*d[0]+g[0]*_[0]),j[1]=S*(-w[0]*d[1]+g[0]*_[1]),j[2]=S*(-w[0]*d[2]+g[0]*_[2]),r.push.apply(r,Ao(l)),n.push.apply(n,Ao(s)),o.push.apply(o,Ao(p)),i.push.apply(i,Ao(E)),a.push.apply(a,Ao(T)),r.push.apply(r,Ao(f)),n.push.apply(n,Ao(s)),o.push.apply(o,Ao(m)),i.push.apply(i,Ao(E)),a.push.apply(a,Ao(T)),r.push.apply(r,Ao(h)),n.push.apply(n,Ao(s)),o.push.apply(o,Ao(b)),i.push.apply(i,Ao(E)),a.push.apply(a,Ao(T)),r.push.apply(r,Ao(l)),n.push.apply(n,Ao(s)),o.push.apply(o,Ao(p)),i.push.apply(i,Ao(P)),a.push.apply(a,Ao(j)),r.push.apply(r,Ao(h)),n.push.apply(n,Ao(s)),o.push.apply(o,Ao(b)),i.push.apply(i,Ao(P)),a.push.apply(a,Ao(j)),r.push.apply(r,Ao(y)),n.push.apply(n,Ao(s)),o.push.apply(o,Ao(v)),i.push.apply(i,Ao(P)),a.push.apply(a,Ao(j));var x=new Qe;return x.setAttribute("a_position",new Float32Array(r),3),x.setAttribute("a_normal",new Float32Array(n),3),x.setAttribute("a_uv",new Float32Array(o),2),x.setAttribute("a_tangents",new Float32Array(i),3),x.setAttribute("a_bitangents",new Float32Array(a),3),x.count=r.length/3,x}}],null&&Lo(e.prototype,null),r&&Lo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Io(t){return Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Io(t)}function Fo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Io(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Io(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Io(o)?o:String(o)),n)}var o}var Bo=20,No=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._tiles=[];for(var r=0;r<3;r++)for(var n=0;n<3;n++){var o=new je(Uo.create(Bo,Bo,2,2),(new Ne).setImage(e.image("ground"),!0).setNormal(e.image("ground_normal"),!0));o.rotation=xt(St(),o.rotation,-Math.PI/2),o.translation=M(Bo*r-20,0,Bo*n-20),this._tiles.push(o)}this._playerConstraintsX=[-10,10],this._playerConstraintsZ=[-10,10]}var e,r;return e=t,(r=[{key:"update",value:function(t){if(!this.withinConstraints(t)){for(var e=null,r=0;r<this._tiles.length;r++)null===e&&(e=this._tiles[r].translation),q(t,this._tiles[r].translation)<q(t,e)&&(e=this._tiles[r].translation);if(null===e)throw new Error("Nearest point cannot be calculated.");for(var n=0,o=0;o<3;o++)for(var i=0;i<3;i++,n++){var a=M(Bo*o-20,0,Bo*i-20);C(a,a,e),this._tiles[n].translation=a}this._playerConstraintsX=[e[0]-10,e[0]+10],this._playerConstraintsZ=[e[2]-10,e[2]+10]}}},{key:"tiles",get:function(){return this._tiles}},{key:"withinConstraints",value:function(t){return!(t[0]<this._playerConstraintsX[0]||t[0]>this._playerConstraintsX[1]||t[2]<this._playerConstraintsZ[0]||t[2]>this._playerConstraintsZ[1])}}])&&Fo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Do(t){return Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Do(t)}function Xo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Vo(n.key),n)}}function Go(t,e,r){return(e=Vo(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Vo(t){var e=function(t,e){if("object"!==Do(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Do(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Do(e)?e:String(e)}var qo=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Go(this,"_nextValue",0),Go(this,"_currentValue",0),Go(this,"_previousValue",0),Go(this,"_t",0),this._value=e,this._previousValue=e,this._currentValue=e,this._frequency=r,this._amplitude=n}var e,r;return e=t,(r=[{key:"update",value:function(t){this._t+=t*this._frequency,this._t>=1&&(this._previousValue=this._nextValue,this._nextValue=this._value+(Math.random()*(this._amplitude- -this._amplitude)-this._amplitude),this._t=0),this._currentValue=this._lerp(this._previousValue,this._nextValue,this._t)}},{key:"value",get:function(){return this._currentValue},set:function(t){this._value=t}},{key:"_lerp",value:function(t,e,r){return t*(1-r)+e*r}}])&&Xo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function zo(t){return zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zo(t)}function Ho(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,e)||Wo(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wo(t,e){if(t){if("string"==typeof t)return Yo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Yo(t,e):void 0}}function Yo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Jo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==zo(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==zo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===zo(o)?o:String(o)),n)}var o}var Ko=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._assets=r,this._debug=o,this._loop=new un(o),this._renderer=n,this._keyboard=new ln(e),this._mouse=new yn(e)}var e,r;return e=t,(r=[{key:"bootstrap",value:function(){var t=this,e=new _n(this._renderer.canvas,M(0,4.5,4.5),this._mouse),r=new No(this._assets),n=Ho(this._assets.model("torch").scene,1)[0];n.translation=M(0,-.05,0),n.rotation=kt(St(),St(),Math.PI/2);var o=Ho(this._assets.model("akai").scene,3),i=o[0],a=o[1],u=o[2];i.rotation=kt(St(),St(),.7),null==a||a.getBone(31).setChild(n),e.follow(i);var c=new Sn(a);c.addClip("idle",u[0]),c.addClip("walk",u[2]),c.addClip("run",u[1]);var s=$n.bind(i,c,this._keyboard,e),l=new ao;l.translation=M(0,.8,.2),n.setChild(l);var f=new qo(.9,4,.15),h=new qo(l.translation[1],4,.1),y=go.create(this._assets,e);n.setChild(y),y.translation=M(0,.58,0);var p,m=new Oo;m.addLight(l),m.add.apply(m,function(t){if(Array.isArray(t))return Yo(t)}(p=r.tiles)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(p)||Wo(p)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m.add(i),m.add(y),this._loop.start((function(n,o){var a,u;t._keyboard.any&&e.stopOrbiting(),t._mouse.update(),e.update(n),s.update(n),r.update(i.translation),null===(a=m.light)||void 0===a||a.update(n),m.light instanceof ao&&(f.update(n),h.update(n),m.light.intensity=f.value,m.light.translation=M(l.translation[0],h.value,l.translation[2])),y.update(o,s),t._renderer.render(m,e),null===(u=t._debug)||void 0===u||u.update(n)}))}}])&&Jo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Qo(t){return Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qo(t)}function Zo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Qo(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Qo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Qo(o)?o:String(o)),n)}var o}var $o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._window=e}var e,r;return e=t,(r=[{key:"find",value:function(t){return this._window.document.querySelector(t)}},{key:"addEventListener",value:function(t,e){this._window.document.addEventListener(t,e)}},{key:"searchParams",get:function(){return new URLSearchParams(this._window.location.search)}},{key:"debug",get:function(){return this.searchParams.has("debug")}},{key:"body",get:function(){return this._window.document.body}}])&&Zo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ti(t){return ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ti(t)}function ei(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==ti(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ti(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ti(o)?o:String(o)),n)}var o}var ri=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t){for(var e,r=3735928559,n=1103547991,o=0,i=t.length;o<i;o++)e=t.charCodeAt(o),r=Math.imul(r^e,2654435761),n=Math.imul(n^e,1597334677);return r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),4294967296*(2097151&(n^=Math.imul(r^r>>>13,3266489909)))+(r>>>0)}}],null&&ei(e.prototype,null),r&&ei(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ni(t){return ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ni(t)}function oi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==ni(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ni(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ni(o)?o:String(o)),n)}var o}var ii=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this._name=r,this._location=n,this._type=o,this._size=i}var e,r;return e=t,(r=[{key:"set",value:function(t){switch(this._type){case 35676:this._gl.uniformMatrix4fv(this._location,!1,t);break;case 35675:this._gl.uniformMatrix3fv(this._location,!1,t);break;case 35665:this._gl.uniform3fv(this._location,t);break;case 35678:case 35680:case 5124:case 35682:case 36293:this._gl.uniform1i(this._location,t);break;case 5126:this._gl.uniform1f(this._location,t);break;case 35666:this._gl.uniform4fv(this._location,t);break;case 35664:this._gl.uniform2fv(this._location,t);break;default:throw new Error('Cannot set uniform value - unrecognized type "'.concat(this._type,'".'))}}}])&&oi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ai(t){return ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ai(t)}function ui(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==ai(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ai(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ai(o)?o:String(o)),n)}var o}var ci=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._uniforms=new Map}var e,r,n;return e=t,n=[{key:"create",value:function(t,e){for(var r=new this,n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=0;o<n;++o){var i=t.getActiveUniform(e,o),a=t.getUniformLocation(e,i.name),u=i.name;u.endsWith("[0]")&&(u=u.slice(0,-3)),r._uniforms.set(u,new ii(t,u,a,i.type,i.size))}return r}}],(r=[{key:"get",value:function(t){if(!this._uniforms.has(t))throw new Error("Program doesn't have \"".concat(t,'" uniform.'));return this._uniforms.get(t)}},{key:"has",value:function(t){return this._uniforms.has(t)}}])&&ui(e.prototype,r),n&&ui(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function si(t){return si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},si(t)}function li(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==si(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==si(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===si(o)?o:String(o)),n)}var o}var fi=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.location=n,this._gl=e,this._name=r}var e,r;return e=t,r=[{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._gl.ARRAY_BUFFER,r=this._gl,n=r.createBuffer();if(null===n)throw new Error("Cannot create webgl buffer.");var o=function(){switch(!0){case t.data instanceof Int8Array:return r.BYTE;case t.data instanceof Uint8Array:return r.UNSIGNED_BYTE;case t.data instanceof Int16Array:return r.SHORT;case t.data instanceof Uint16Array:return r.UNSIGNED_SHORT;case t.data instanceof Int32Array:return r.INT;case t.data instanceof Uint32Array:return r.UNSIGNED_INT;case t.data instanceof Float32Array:return r.FLOAT;default:throw new Error("Cannot infer data type from array.")}}();r.bindBuffer(e,n),r.bufferData(e,t.data,r.STATIC_DRAW),r.enableVertexAttribArray(this.location),r.vertexAttribPointer(this.location,t.itemSize,o,t.normalized,0,0),r.bindBuffer(e,null)}}],r&&li(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function hi(t){return hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hi(t)}function yi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==hi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==hi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===hi(o)?o:String(o)),n)}var o}var pi=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this._attributes=new Map}var e,r,n;return e=t,r=[{key:"get",value:function(t){if(!this.has(t))throw new Error("Program doesn't have \"".concat(t,'" attribute.'));return this._attributes.get(t)}},{key:"has",value:function(t){return this._attributes.has(t)}},{key:"setInterleaved",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._gl.ARRAY_BUFFER,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._gl.STATIC_DRAW,o=this._gl,i=o.createBuffer();if(null===i)throw new Error("Cannot create webgl buffer.");var a=function(){switch(!0){case t instanceof Int8Array:return o.BYTE;case t instanceof Uint8Array:return o.UNSIGNED_BYTE;case t instanceof Int16Array:return o.SHORT;case t instanceof Uint16Array:return o.UNSIGNED_SHORT;case t instanceof Int32Array:return o.INT;case t instanceof Uint32Array:return o.UNSIGNED_INT;case t instanceof Float32Array:return o.FLOAT;default:throw new Error("Cannot infer data type from array.")}}();o.bindBuffer(r,i),o.bufferData(r,t,n);for(var u=0,c=e.length;u<c;u++)t.BYTES_PER_ELEMENT,e[u].itemSize;for(var s=0,l=e.length;s<l;s++){var f=e[s];if(this.has(f.name)){var h=this.get(f.name).location;console.log(h,f.itemSize,a,f.normalized),o.enableVertexAttribArray(h),o.vertexAttribPointer(h,f.itemSize,a,f.normalized,0,0),t.BYTES_PER_ELEMENT,f.itemSize}}return o.bindBuffer(r,null),i}}],n=[{key:"create",value:function(t,e){for(var r=new this(t),n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<n;++o){var i=t.getActiveAttrib(e,o),a=t.getAttribLocation(e,i.name);r._attributes.set(i.name,new fi(t,i.name,a))}return r}}],r&&yi(e.prototype,r),n&&yi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function mi(t){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mi(t)}function bi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==mi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===mi(o)?o:String(o)),n)}var o}var vi=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e,r){var n=t.createShader(e);if(null===n)throw new Error("Cannot create webgl shader.");if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Unexpected error while compiling ".concat(e===t.VERTEX_SHADER?"vertex":"fragment"," shader: ")+t.getShaderInfoLog(n));return n}}],null&&bi(e.prototype,null),r&&bi(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function di(t){return di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},di(t)}function _i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==di(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===di(o)?o:String(o)),n)}var o}var gi=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this._program=r,this._cachedUniforms=null,this._cachedAttributes=null}var e,r,n;return e=t,n=[{key:"create",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=t.createProgram();if(null===o)throw new Error("Cannot create webgl program.");var i=vi.create(t,t.VERTEX_SHADER,e),a=vi.create(t,t.FRAGMENT_SHADER,r);if(t.attachShader(o,i),t.attachShader(o,a),n.length>0&&t.transformFeedbackVaryings(o,n,t.INTERLEAVED_ATTRIBS),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error("Unexpected error while creating a program. "+t.getProgramInfoLog(o));return new this(t,o)}}],(r=[{key:"attributes",get:function(){return null===this._cachedAttributes&&(this._cachedAttributes=pi.create(this._gl,this._program)),this._cachedAttributes}},{key:"uniforms",get:function(){return null===this._cachedUniforms&&(this._cachedUniforms=ci.create(this._gl,this._program)),this._cachedUniforms}},{key:"useProgram",value:function(){this._gl.useProgram(this._program)}},{key:"stopProgram",value:function(){this._gl.useProgram(null)}}])&&_i(e.prototype,r),n&&_i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function wi(t){return wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wi(t)}function Si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Oi(n.key),n)}}function Ei(t,e){return Ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ei(t,e)}function Ti(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Pi(t){return Pi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pi(t)}function ji(t,e,r){return(e=Oi(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oi(t){var e=function(t,e){if("object"!==wi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==wi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===wi(e)?e:String(e)}var xi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ei(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pi(n);if(o){var r=Pi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ti(t)}(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(0,0,0);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),ji(Ti(t=i.call(this)),"_projectionChanged",!0),ji(Ti(t),"_viewChanged",!0),ji(Ti(t),"_projectionViewChanged",!0),t._currentTarget=e,t._followTarget=null,t._previousFollowTargetPosition=null,t._worldUp=[0,1,0],t._projectionMatrix=d(),t._viewMatrix=d(),t._projectionViewMatrix=d(),t}return e=a,(r=[{key:"update",value:function(t){if(null!==this._followTarget&&null!==this._previousFollowTargetPosition){var e=this._followTarget.translation;ht(this._previousFollowTargetPosition,e)||(this.translation=M(e[0],5,e[2]+5),this._currentTarget=this._followTarget.translation,this._viewChanged=!0,this._projectionViewChanged=!0,this._previousFollowTargetPosition=e)}}},{key:"follow",value:function(t){this._followTarget=t,this._previousFollowTargetPosition=t.translation}},{key:"projectionViewMatrix",get:function(){return this._projectionViewChanged&&(g(this._projectionViewMatrix,this.orthographicProjectionMatrix,this.viewMatrix),this._projectionViewChanged=!1),this._projectionViewMatrix}},{key:"viewMatrix",get:function(){return this._viewChanged&&(j(this._viewMatrix,this.translation,this._currentTarget,this._worldUp),this._viewChanged=!1),this._viewMatrix}},{key:"perspectiveProjectionMatrix",get:function(){return this._projectionChanged&&(P(this._projectionMatrix,60*Math.PI/180,1,1,30),this._projectionChanged=!1),this._projectionMatrix}},{key:"orthographicProjectionMatrix",get:function(){return this._projectionChanged&&(function(t,e,r,n,o,i,a){var u=1/(e-r),c=1/(n-o),s=1/(i-a);t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*s,t[11]=0,t[12]=(e+r)*u,t[13]=(o+n)*c,t[14]=(a+i)*s,t[15]=1}(this._projectionMatrix,-2,2,-2,2,0,10),this._projectionChanged=!1),this._projectionMatrix}}])&&Si(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Se);function ki(t){return ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ki(t)}function Mi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==ki(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ki(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ki(o)?o:String(o)),n)}var o}var Ri=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._shaderCache=e,this._programs=new Map,this._depthPrograms=new Map}var e,r;return e=t,(r=[{key:"fromMaterial",value:function(t,e,r,n){if(r instanceof lo)return this.fromShader(t,r.vertex,r.fragment);var o=[];o.push(r.image?"#define USE_TEXTURE":""),o.push(r.vertexColors?"#define USE_COLOR_ATTRIBUTE":""),o.push(r.color?"#define USE_STATIC_COLOR_ATTRIBUTE":""),o.push(r.normal?"#define USE_NORMAL_MAPPING":""),o.push(n instanceof xi?"#define USE_LIGHT_DIRECTIONAL":""),o.push(n instanceof ao?"#define USE_LIGHT_POINT":""),o.push(n instanceof xi||n instanceof ao?"#define USE_LIGHT":""),e instanceof Re&&o.push("#define USE_SKINNING");var i=ri.create(o.join(""));if(this._programs.has(i))return this._programs.get(i);var a=gi.create(t,this._shaderCache.getVertex(o),this._shaderCache.getFragment(o));return this._programs.set(i,a),a}},{key:"fromShader",value:function(t,e,r){var n=ri.create(e+r);if(this._programs.has(n))return this._programs.get(n);var o=gi.create(t,e,r);return this._programs.set(n,o),o}},{key:"depthPass",value:function(t,e){var r=[];e instanceof Re&&r.push("#define USE_SKINNING");var n=ri.create(r.join(""));if(this._depthPrograms.has(n))return this._depthPrograms.get(n);var o=gi.create(t,this._shaderCache.getDepthVertex(r),this._shaderCache.getDepthFragment(r));return this._depthPrograms.set(n,o),o}}])&&Mi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ai(t){return Ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ai(t)}function Ci(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ai(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ai(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ai(o)?o:String(o)),n)}var o}var Li=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._textures=new Map}var e,r;return e=t,r=[{key:"set",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.LINEAR,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.CLAMP_TO_EDGE,i=t.createTexture();if(null===i)throw new Error("Cannot create webgl texture.");t.bindTexture(t.TEXTURE_2D,i),null!==r&&(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.generateMipmap(t.TEXTURE_2D)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),this._textures.set(e,i),t.bindTexture(t.TEXTURE_2D,null)}},{key:"has",value:function(t){return this._textures.has(t)}},{key:"get",value:function(t){if(!this.has(t))throw new Error('Texture with name "'.concat(t,"\" doesn't exists."));return this._textures.get(t)}}],r&&Ci(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ui(t){return Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ui(t)}function Ii(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ui(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ui(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ui(o)?o:String(o)),n)}var o}var Fi=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._vaos=new Map}var e,r;return e=t,(r=[{key:"bind",value:function(t,e){var r,n=null!==(r=this._vaos.get(e))&&void 0!==r?r:null;if(null===n&&(n=t.createVertexArray()),null===n)throw new Error("Cannot create vertex attribute array.");this._vaos.set(e,n),t.bindVertexArray(n)}},{key:"unbind",value:function(t){t.bindVertexArray(null)}}])&&Ii(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Bi(t){return Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bi(t)}function Ni(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Bi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Bi(o)?o:String(o)),n)}var o}var Di="#version 300 es",Xi=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._assets=e}var e,r;return e=t,(r=[{key:"getVertex",value:function(t){return"".concat(Di,"\n        \n        ").concat(t.join("\n"),"\n        \n        ").concat(this._assets.shader("default_vertex"),"\n        ")}},{key:"getFragment",value:function(t){return"".concat(Di,"\n        \n        ").concat(t.join("\n"),"\n        \n        ").concat(this._assets.shader("default_fragment"),"\n        ")}},{key:"getDepthVertex",value:function(t){return"".concat(Di,"\n            \n        ").concat(t.join("\n"),"\n    \n        ").concat(this._assets.shader("depth_vertex"),"\n        ")}},{key:"getDepthFragment",value:function(t){return"".concat(Di,"\n                \n        ").concat(t.join("\n"),"\n\n        ").concat(this._assets.shader("depth_fragment"),"\n        ")}}])&&Ni(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Gi(t){return Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gi(t)}function Vi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qi(n.key),n)}}function qi(t){var e=function(t,e){if("object"!==Gi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Gi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Gi(e)?e:String(e)}var zi,Hi,Wi=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.depthTexture=e,this.depthFramebuffer=r}var e,r,n;return e=t,n=[{key:"depth",value:function(t){var e=t.createTexture(),r=t.createFramebuffer();if(null===e)throw new Error("Cannot create framebuffer depth texture.");if(null===r)throw new Error("Cannot create framebuffer.");return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,this.textureSize,this.textureSize,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_FUNC,t.LEQUAL),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,e,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),new this(e,r)}},{key:"cubeDepth",value:function(t){var e=t.createTexture(),r=t.createFramebuffer();if(null===e)throw new Error("Cannot create framebuffer depth texture.");if(null===r)throw new Error("Cannot create framebuffer.");t.bindTexture(t.TEXTURE_CUBE_MAP,e),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_FUNC,t.LEQUAL);for(var n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.DEPTH_COMPONENT16,this.textureSize,this.textureSize,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_CUBE_MAP,null),new this(e,r)}}],(r=[{key:"passDirection",value:function(t,e){return[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z][e]}}])&&Vi(e.prototype,r),n&&Vi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Yi(t){return Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yi(t)}function Ji(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qi(n.key),n)}}function Ki(t,e,r){return(e=Qi(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qi(t){var e=function(t,e){if("object"!==Yi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Yi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Yi(e)?e:String(e)}zi=Wi,(Hi=qi(Hi="textureSize"))in zi?Object.defineProperty(zi,Hi,{value:256,enumerable:!0,configurable:!0,writable:!0}):zi[Hi]=256;var Zi=function(){function t(e,r,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ki(this,"_vertexArrays",new Fi),Ki(this,"_textures",new Li),this._canvas=e.find("canvas"),this._gl=this._canvas.getContext("webgl2",{powerPreference:"high-performance",antialias:!0}),null===this._gl)throw new Error("Unsupported browser or a device: WebGL 2 is unavailable.");this._debug=n,this._shaderCache=new Xi(r),this._programs=new Ri(this._shaderCache),this._framebuffer=null,this._query=null,this._queryExt=null,this._canvas.width=this._canvas.offsetWidth,this._canvas.style.width="".concat(this._canvas.offsetWidth,"px"),this._canvas.height=this._canvas.offsetHeight,this._canvas.style.height="".concat(this._canvas.offsetHeight,"px"),this._gl.enable(this._gl.DEPTH_TEST),this._gl.enable(this._gl.CULL_FACE),null!==this._debug&&(this._queryExt=this._gl.getExtension("EXT_disjoint_timer_query_webgl2"))}var e,r;return e=t,r=[{key:"render",value:function(t,e){var r=this._gl,n=this._canvas.width,o=this._canvas.height;if(t.updateMatrixWorld(),null!==this._queryExt){if(null!==this._query){var i=r.getQueryParameter(this._query,r.QUERY_RESULT_AVAILABLE),a=r.getParameter(this._queryExt.GPU_DISJOINT_EXT);if(i&&!a){var u=r.getQueryParameter(this._query,r.QUERY_RESULT);this._debug.gpuTime=1e-6*u}}else this._query=r.createQuery();r.beginQuery(this._queryExt.TIME_ELAPSED_EXT,this._query)}if(null!==t.light){if(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(1,10),t.light instanceof xi&&(null===this._framebuffer&&(this._framebuffer=Wi.depth(r)),this.renderToFramebuffer(t,t.light.projectionViewMatrix)),t.light instanceof ao){null===this._framebuffer&&(this._framebuffer=Wi.cubeDepth(r));for(var c=0;c<t.light.faces;c++)this.renderToFramebuffer(t,t.light.getFaceProjectionViewMatrix(c),c)}r.disable(r.POLYGON_OFFSET_FILL)}null!==e.screenPosition?(r.enable(r.SCISSOR_TEST),pn.TOP===e.screenPosition&&(r.viewport(0,o/2,n,o/2),r.scissor(0,o/2,n,o/2)),pn.BOTTOM===e.screenPosition&&(r.viewport(0,0,n,o/2),r.scissor(0,0,n,o/2)),pn.LEFT===e.screenPosition&&(r.viewport(0,0,n/2,o),r.scissor(0,0,n/2,o)),pn.RIGHT===e.screenPosition&&(r.viewport(n/2,0,n/2,o),r.scissor(n/2,0,n/2,o))):r.viewport(0,0,n,o);for(var s=0,l=t.drawables.length;s<l;s++)this.renderObject(r,t.drawables[s],e,t.light);null!==e.screenPosition&&r.disable(r.SCISSOR_TEST),null!==this._queryExt&&r.endQuery(this._queryExt.TIME_ELAPSED_EXT)}},{key:"renderObject",value:function(t,e,r,n){var o,i,a=e.geometry,u=e.material,c=this._programs.fromMaterial(t,e,u,n);if(c.useProgram(),this._vertexArrays.bind(t,a.id),a.updateBuffers){for(var s=0,l=a.attributes.length;s<l;s++){var f=a.attributes[s];c.attributes.has(f.name)&&c.attributes.get(f.name).set(f)}if(a.indexed){var h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.index,t.STATIC_DRAW)}a.updateBuffers=!1}if(c.uniforms.get("u_projectionView").set(r.projectionViewMatrix),c.uniforms.get("u_model").set(e.worldTransform),null!==e.material.image&&(this._textures.has(e.material.image.src)||this._textures.set(t,e.material.image.src,e.material.image,t.LINEAR,e.material.imageRepeat?t.REPEAT:t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._textures.get(e.material.image.src)),c.uniforms.get("u_texture").set(1)),null!==e.material.normal&&c.uniforms.has("u_textureNormal")&&(this._textures.has(e.material.normal.src)||this._textures.set(t,e.material.normal.src,e.material.normal,t.LINEAR,e.material.normalRepeat?t.REPEAT:t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this._textures.get(e.material.normal.src)),c.uniforms.get("u_textureNormal").set(2)),c.uniforms.has("u_depthTexture")&&null!==(o=this._framebuffer)&&void 0!==o&&o.depthTexture&&(t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,this._framebuffer.depthTexture),c.uniforms.get("u_depthTexture").set(3)),c.uniforms.has("u_depthCubeMapTexture")&&null!==(i=this._framebuffer)&&void 0!==i&&i.depthTexture&&(t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_CUBE_MAP,this._framebuffer.depthTexture),c.uniforms.get("u_depthCubeMapTexture").set(4)),n&&c.uniforms.has("u_lightPosition")&&c.uniforms.get("u_lightPosition").set(n.worldTranslation),n instanceof ao&&c.uniforms.has("u_lightIntensity")&&c.uniforms.get("u_lightIntensity").set(n.intensity),n&&c.uniforms.has("u_lightProjectionViewMatrix")&&c.uniforms.get("u_lightProjectionViewMatrix").set(n.projectionViewMatrix),c.uniforms.has("u_cameraPosition")&&c.uniforms.get("u_cameraPosition").set(r._position),c.uniforms.has("u_normalMatrix")){var y=d();!function(t,e){var r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],u=e[5],c=e[6],s=e[7],l=e[8],f=e[9],h=e[10],y=e[11],p=e[12],m=e[13],b=e[14],v=e[15],d=r*u-n*a,_=r*c-o*a,g=r*s-i*a,w=n*c-o*u,S=n*s-i*u,E=o*s-i*c,T=l*m-f*p,P=l*b-h*p,j=l*v-y*p,O=f*b-h*m,x=f*v-y*m,k=h*v-y*b,M=d*k-_*x+g*O+w*j-S*P+E*T;M&&(M=1/M,t[0]=(u*k-c*x+s*O)*M,t[1]=(o*x-n*k-i*O)*M,t[2]=(m*E-b*S+v*w)*M,t[3]=(h*S-f*E-y*w)*M,t[4]=(c*j-a*k-s*P)*M,t[5]=(r*k-o*j+i*P)*M,t[6]=(b*g-p*E-v*_)*M,t[7]=(l*E-h*g+y*_)*M,t[8]=(a*x-u*j+s*T)*M,t[9]=(n*j-r*x-i*T)*M,t[10]=(p*S-m*g+v*d)*M,t[11]=(f*g-l*S-y*d)*M,t[12]=(u*P-a*O-c*T)*M,t[13]=(r*O-n*P+o*T)*M,t[14]=(m*_-p*w-b*d)*M,t[15]=(l*w-f*_+h*d)*M)}(y,e.worldTransform),function(t,e){if(t===e){var r=e[1],n=e[2],o=e[3],i=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=o,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(y,y),c.uniforms.get("u_normalMatrix").set(y)}if(e instanceof Re){var p="skin_".concat(e.geometry.id);this._textures.has(p)||this._textures.set(t,p,null,t.NEAREST,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE5),t.bindTexture(t.TEXTURE_2D,this._textures.get(p)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,4,e.skeleton.jointCount,0,t.RGBA,t.FLOAT,e.skeleton.jointMatrix),c.uniforms.get("u_jointTexture").set(5)}null!==e.material.color&&c.uniforms.get("u_color").set(e.material.color),e.material instanceof lo&&e.material.uniforms.forEach((function(t,e){c.uniforms.has(e)&&c.uniforms.get(e).set(t)}));var m=null;if(e instanceof To&&(m=t.LINES),e instanceof je&&(m=t.TRIANGLES),e instanceof po&&(m=t.POINTS),null===m)throw new Error("Cannot get rendering mode.");e.material.blending&&(t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE)),a.indexed?t.drawElements(m,a.count,t.UNSIGNED_SHORT,0):t.drawArrays(m,0,a.count),e.material.blending&&(t.blendFunc(t.SRC_ALPHA,t.ZERO),t.enable(t.DEPTH_TEST)),this._vertexArrays.unbind(t),c.stopProgram()}},{key:"renderToFramebuffer",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===this._framebuffer)throw new Error("Framebuffer should be initialized before rendering to framebuffer.");var n=this._gl;n.bindFramebuffer(n.FRAMEBUFFER,this._framebuffer.depthFramebuffer),null!==r&&n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,this._framebuffer.passDirection(n,r),this._framebuffer.depthTexture,0),n.viewport(0,0,Wi.textureSize,Wi.textureSize),n.clear(n.DEPTH_BUFFER_BIT);for(var o=0,i=t.drawables.length;o<i;o++){var a=t.drawables[o];if(a.material.castShadow){var u=a.geometry,c=this._programs.depthPass(n,a);if(c.useProgram(),this._vertexArrays.bind(n,u.id),u.updateBuffers&&u.indexed){var s=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),n.bufferData(n.ELEMENT_ARRAY_BUFFER,u.index,n.STATIC_DRAW)}if(a instanceof Re){var l="skin_".concat(a.geometry.id);this._textures.has(l)||this._textures.set(n,l,null,n.NEAREST,n.CLAMP_TO_EDGE),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._textures.get(l)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA32F,4,a.skeleton.jointCount,0,n.RGBA,n.FLOAT,a.skeleton.jointMatrix),c.uniforms.get("u_jointTexture").set(0)}c.uniforms.get("u_model").set(a.worldTransform),c.uniforms.get("u_lightSpace").set(e);var f=null;if(a instanceof To&&(f=n.LINES),a instanceof je&&(f=n.TRIANGLES),a instanceof po&&(f=n.POINTS),null===f)throw new Error("Cannot get rendering mode.");u.indexed?n.drawElements(f,u.count,n.UNSIGNED_SHORT,0):n.drawArrays(f,0,u.count),this._vertexArrays.unbind(n),c.stopProgram()}}n.bindFramebuffer(n.FRAMEBUFFER,null)}},{key:"canvas",get:function(){return this._canvas}}],r&&Ji(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $i(t){return $i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$i(t)}function ta(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ra(n.key),n)}}function ea(t,e,r){return(e=ra(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ra(t){var e=function(t,e){if("object"!==$i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==$i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===$i(e)?e:String(e)}var na=function(){function t(e,r,n,o,i,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ea(this,"_updateInterval",3),ea(this,"_samplesCount",60),ea(this,"_fpsSamples",[]),ea(this,"_cpuTimeSamples",[]),ea(this,"_gpuTimeSamples",[]),ea(this,"_active",!1),ea(this,"_lastUpdate",this._updateInterval),this._fpsElement=e,this._cpuTimeElement=r,this._gpuTimeElement=n,this._jsHeapUsedElement=o,this._jsHeapLimitElement=i,this._jsHeapAvailableElement=a}var e,r,n;return e=t,r=[{key:"update",value:function(t){if(this._active&&(this._lastUpdate+=t,!(this._lastUpdate<this._updateInterval))){this._fpsElement.textContent=Math.round(this.averageFrom(this._fpsSamples)).toString(),this._cpuTimeElement.textContent=this.averageFrom(this._cpuTimeSamples).toFixed(2).concat(" ms"),this._gpuTimeElement.textContent=this.averageFrom(this._gpuTimeSamples).toFixed(2).concat(" ms");var e=window.performance.memory;void 0!==e&&(this._jsHeapLimitElement.textContent=Math.round(e.jsHeapSizeLimit/1e6).toString().concat(" MB"),this._jsHeapAvailableElement.textContent=Math.round(e.totalJSHeapSize/1e6).toString().concat(" MB"),this._jsHeapUsedElement.textContent=Math.round(e.usedJSHeapSize/1e6).toString().concat(" MB")),this._lastUpdate=0}}},{key:"fps",set:function(t){this._fpsSamples.push(t),this._fpsSamples.length>=this._samplesCount&&this._fpsSamples.shift()}},{key:"cpuTime",set:function(t){this._cpuTimeSamples.push(t),this._cpuTimeSamples.length>=this._samplesCount&&this._cpuTimeSamples.shift()}},{key:"gpuTime",set:function(t){this._gpuTimeSamples.push(t),this._gpuTimeSamples.length>=this._samplesCount&&this._gpuTimeSamples.shift()}},{key:"averageFrom",value:function(t){if(0===t.length)return 0;for(var e=0,r=0;r<t.length;r++)e+=t[r];return e/t.length}}],n=[{key:"create",value:function(t){var e=t.find("[data-debug-container]"),r=t.find("[data-toggle-debug-container]"),n=new this(e.querySelector("[data-fps-counter]"),e.querySelector("[data-ms-cpu-counter]"),e.querySelector("[data-ms-gpu-counter]"),e.querySelector("[data-heap-used]"),e.querySelector("[data-heap-limit]"),e.querySelector("[data-heap-available]"));return r.addEventListener("click",(function(){return n._active=e.classList.toggle("active")})),r.classList.add("initialized"),n}}],r&&ta(e.prototype,r),n&&ta(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();window.addEventListener("error",(function(t){return alert(t.message)}));var oa=new $o(window),ia=oa.debug?na.create(oa):null,aa=new nn,ua=new Zi(oa,aa,ia),ca=new Ko(oa,aa,ua,ia);aa.importShader("default_vertex","shader/default/vertex.glsl"),aa.importShader("default_fragment","shader/default/fragment.glsl"),aa.importShader("depth_vertex","shader/depth/vertex.glsl"),aa.importShader("depth_fragment","shader/depth/fragment.glsl"),aa.importShader("fire_vertex","shader/particle/fire/vertex.glsl"),aa.importShader("fire_fragment","shader/particle/fire/fragment.glsl"),aa.importImage("ground","image/ground.jpg"),aa.importImage("ground_normal","image/ground_normal.jpg"),aa.importBinaryModel("akai","model/akai.glb"),aa.importBinaryModel("torch","model/torch.glb"),oa.addEventListener("DOMContentLoaded",(function(){aa.load((function(){ca.bootstrap(),oa.body.classList.add("initialized")}))}))})();