(()=>{"use strict";var t={887:(t,e,r)=>{r.r(e),r.d(e,{glMatrix:()=>a,mat2:()=>n,mat2d:()=>i,mat3:()=>s,mat4:()=>o,quat:()=>c,quat2:()=>l,vec2:()=>f,vec3:()=>u,vec4:()=>h});var a={};r.r(a),r.d(a,{ARRAY_TYPE:()=>d,EPSILON:()=>_,RANDOM:()=>m,equals:()=>g,setMatrixArrayType:()=>p,toRadian:()=>v});var n={};r.r(n),r.d(n,{LDU:()=>D,add:()=>V,adjoint:()=>S,clone:()=>T,copy:()=>E,create:()=>b,determinant:()=>R,equals:()=>k,exactEquals:()=>q,frob:()=>F,fromRotation:()=>j,fromScaling:()=>L,fromValues:()=>y,identity:()=>w,invert:()=>A,mul:()=>G,multiply:()=>C,multiplyScalar:()=>N,multiplyScalarAndAdd:()=>X,rotate:()=>O,scale:()=>U,set:()=>x,str:()=>I,sub:()=>z,subtract:()=>B,transpose:()=>P});var i={};r.r(i),r.d(i,{add:()=>ht,clone:()=>W,copy:()=>Y,create:()=>H,determinant:()=>K,equals:()=>dt,exactEquals:()=>_t,frob:()=>ut,fromRotation:()=>nt,fromScaling:()=>it,fromTranslation:()=>st,fromValues:()=>J,identity:()=>$,invert:()=>Z,mul:()=>mt,multiply:()=>tt,multiplyScalar:()=>lt,multiplyScalarAndAdd:()=>ft,rotate:()=>et,scale:()=>rt,set:()=>Q,str:()=>ot,sub:()=>pt,subtract:()=>ct,translate:()=>at});var s={};r.r(s),r.d(s,{add:()=>kt,adjoint:()=>Pt,clone:()=>gt,copy:()=>bt,create:()=>Mt,determinant:()=>At,equals:()=>Ht,exactEquals:()=>zt,frob:()=>qt,fromMat2d:()=>It,fromMat4:()=>vt,fromQuat:()=>Ft,fromRotation:()=>jt,fromScaling:()=>Lt,fromTranslation:()=>Ut,fromValues:()=>Tt,identity:()=>wt,invert:()=>xt,mul:()=>Wt,multiply:()=>St,multiplyScalar:()=>Xt,multiplyScalarAndAdd:()=>Gt,normalFromMat4:()=>Dt,projection:()=>Vt,rotate:()=>Ct,scale:()=>Ot,set:()=>Et,str:()=>Bt,sub:()=>Yt,subtract:()=>Nt,translate:()=>Rt,transpose:()=>yt});var o={};r.r(o),r.d(o,{add:()=>Ve,adjoint:()=>ae,clone:()=>Jt,copy:()=>Qt,create:()=>$t,determinant:()=>ne,equals:()=>Xe,exactEquals:()=>Ne,frob:()=>De,fromQuat:()=>xe,fromQuat2:()=>ge,fromRotation:()=>de,fromRotationTranslation:()=>ve,fromRotationTranslationScale:()=>we,fromRotationTranslationScaleOrigin:()=>ye,fromScaling:()=>_e,fromTranslation:()=>fe,fromValues:()=>Zt,fromXRotation:()=>me,fromYRotation:()=>pe,fromZRotation:()=>Me,frustum:()=>Pe,getRotation:()=>Ee,getScaling:()=>Te,getTranslation:()=>be,identity:()=>te,invert:()=>re,lookAt:()=>Le,mul:()=>Ge,multiply:()=>ie,multiplyScalar:()=>qe,multiplyScalarAndAdd:()=>ke,ortho:()=>Ue,orthoNO:()=>Oe,orthoZO:()=>je,perspective:()=>Se,perspectiveFromFieldOfView:()=>Ce,perspectiveNO:()=>Ae,perspectiveZO:()=>Re,rotate:()=>ue,rotateX:()=>he,rotateY:()=>ce,rotateZ:()=>le,scale:()=>oe,set:()=>Kt,str:()=>Fe,sub:()=>ze,subtract:()=>Be,targetTo:()=>Ie,translate:()=>se,transpose:()=>ee});var u={};r.r(u),r.d(u,{add:()=>Ze,angle:()=>Ar,bezier:()=>gr,ceil:()=>rr,clone:()=>We,copy:()=>Je,create:()=>He,cross:()=>pr,dist:()=>Fr,distance:()=>hr,div:()=>Ir,divide:()=>er,dot:()=>mr,equals:()=>Or,exactEquals:()=>Cr,floor:()=>ar,forEach:()=>qr,fromValues:()=>$e,hermite:()=>vr,inverse:()=>_r,len:()=>Vr,length:()=>Ye,lerp:()=>Mr,max:()=>ir,min:()=>nr,mul:()=>Lr,multiply:()=>tr,negate:()=>fr,normalize:()=>dr,random:()=>br,rotateX:()=>yr,rotateY:()=>xr,rotateZ:()=>Pr,round:()=>sr,scale:()=>or,scaleAndAdd:()=>ur,set:()=>Qe,sqrDist:()=>Dr,sqrLen:()=>Br,squaredDistance:()=>cr,squaredLength:()=>lr,str:()=>Rr,sub:()=>jr,subtract:()=>Ke,transformMat3:()=>Er,transformMat4:()=>Tr,transformQuat:()=>wr,zero:()=>Sr});var h={};r.r(h),r.d(h,{add:()=>Hr,ceil:()=>Jr,clone:()=>Nr,copy:()=>Gr,create:()=>kr,cross:()=>la,dist:()=>wa,distance:()=>aa,div:()=>Ea,divide:()=>$r,dot:()=>ca,equals:()=>ga,exactEquals:()=>va,floor:()=>Qr,forEach:()=>Aa,fromValues:()=>Xr,inverse:()=>ua,len:()=>xa,length:()=>ia,lerp:()=>fa,max:()=>Kr,min:()=>Zr,mul:()=>Ta,multiply:()=>Yr,negate:()=>oa,normalize:()=>ha,random:()=>_a,round:()=>ta,scale:()=>ea,scaleAndAdd:()=>ra,set:()=>zr,sqrDist:()=>ya,sqrLen:()=>Pa,squaredDistance:()=>na,squaredLength:()=>sa,str:()=>Ma,sub:()=>ba,subtract:()=>Wr,transformMat4:()=>da,transformQuat:()=>ma,zero:()=>pa});var c={};r.r(c),r.d(c,{add:()=>nn,calculateW:()=>Da,clone:()=>tn,conjugate:()=>Ga,copy:()=>rn,create:()=>Sa,dot:()=>un,equals:()=>pn,exactEquals:()=>mn,exp:()=>Va,fromEuler:()=>Ha,fromMat3:()=>za,fromValues:()=>en,getAngle:()=>Ua,getAxisAngle:()=>Oa,identity:()=>Ra,invert:()=>Xa,len:()=>ln,length:()=>cn,lerp:()=>hn,ln:()=>Ba,mul:()=>sn,multiply:()=>ja,normalize:()=>dn,pow:()=>qa,random:()=>Na,rotateX:()=>La,rotateY:()=>Ia,rotateZ:()=>Fa,rotationTo:()=>Mn,scale:()=>on,set:()=>an,setAxes:()=>gn,setAxisAngle:()=>Ca,slerp:()=>ka,sqlerp:()=>vn,sqrLen:()=>_n,squaredLength:()=>fn,str:()=>Wa});var l={};r.r(l),r.d(l,{add:()=>Xn,clone:()=>Tn,conjugate:()=>Jn,copy:()=>Sn,create:()=>bn,dot:()=>Wn,equals:()=>ni,exactEquals:()=>ai,fromMat4:()=>An,fromRotation:()=>Pn,fromRotationTranslation:()=>yn,fromRotationTranslationValues:()=>wn,fromTranslation:()=>xn,fromValues:()=>En,getDual:()=>Un,getReal:()=>On,getTranslation:()=>In,identity:()=>Rn,invert:()=>$n,len:()=>Zn,length:()=>Qn,lerp:()=>Yn,mul:()=>zn,multiply:()=>Gn,normalize:()=>ei,rotateAroundAxis:()=>Nn,rotateByQuatAppend:()=>qn,rotateByQuatPrepend:()=>kn,rotateX:()=>Dn,rotateY:()=>Vn,rotateZ:()=>Bn,scale:()=>Hn,set:()=>Cn,setDual:()=>Ln,setReal:()=>jn,sqrLen:()=>ti,squaredLength:()=>Kn,str:()=>ri,translate:()=>Fn});var f={};r.r(f),r.d(f,{add:()=>ci,angle:()=>Di,ceil:()=>di,clone:()=>si,copy:()=>ui,create:()=>ii,cross:()=>Ri,dist:()=>Hi,distance:()=>Ti,div:()=>zi,divide:()=>_i,dot:()=>Si,equals:()=>ki,exactEquals:()=>qi,floor:()=>mi,forEach:()=>$i,fromValues:()=>oi,inverse:()=>Pi,len:()=>Ni,length:()=>wi,lerp:()=>Ci,max:()=>Mi,min:()=>pi,mul:()=>Gi,multiply:()=>fi,negate:()=>xi,normalize:()=>Ai,random:()=>Oi,rotate:()=>Fi,round:()=>vi,scale:()=>gi,scaleAndAdd:()=>bi,set:()=>hi,sqrDist:()=>Wi,sqrLen:()=>Yi,squaredDistance:()=>Ei,squaredLength:()=>yi,str:()=>Bi,sub:()=>Xi,subtract:()=>li,transformMat2:()=>Ui,transformMat2d:()=>ji,transformMat3:()=>Li,transformMat4:()=>Ii,zero:()=>Vi});var _=1e-6,d="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function p(t){d=t}var M=Math.PI/180;function v(t){return t*M}function g(t,e){return Math.abs(t-e)<=_*Math.max(1,Math.abs(t),Math.abs(e))}function b(){var t=new d(4);return d!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function T(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function E(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function w(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function y(t,e,r,a){var n=new d(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n}function x(t,e,r,a,n){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t}function P(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function A(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r*i-n*a;return s?(s=1/s,t[0]=i*s,t[1]=-a*s,t[2]=-n*s,t[3]=r*s,t):null}function S(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function R(t){return t[0]*t[3]-t[2]*t[1]}function C(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],u=r[1],h=r[2],c=r[3];return t[0]=a*o+i*u,t[1]=n*o+s*u,t[2]=a*h+i*c,t[3]=n*h+s*c,t}function O(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=a*u+i*o,t[1]=n*u+s*o,t[2]=a*-o+i*u,t[3]=n*-o+s*u,t}function U(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],u=r[1];return t[0]=a*o,t[1]=n*o,t[2]=i*u,t[3]=s*u,t}function j(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t}function L(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function I(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function F(t){return Math.hypot(t[0],t[1],t[2],t[3])}function D(t,e,r,a){return t[2]=a[2]/a[0],r[0]=a[0],r[1]=a[1],r[3]=a[3]-t[2]*r[1],[t,e,r]}function V(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function B(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function k(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=e[0],o=e[1],u=e[2],h=e[3];return Math.abs(r-s)<=_*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-o)<=_*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(n-u)<=_*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=_*Math.max(1,Math.abs(i),Math.abs(h))}function N(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function X(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var G=C,z=B;function H(){var t=new d(6);return d!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function W(t){var e=new d(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Y(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function $(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function J(t,e,r,a,n,i){var s=new d(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=a,s[4]=n,s[5]=i,s}function Q(t,e,r,a,n,i,s){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t}function Z(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],u=r*i-a*n;return u?(u=1/u,t[0]=i*u,t[1]=-a*u,t[2]=-n*u,t[3]=r*u,t[4]=(n*o-i*s)*u,t[5]=(a*s-r*o)*u,t):null}function K(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=r[0],c=r[1],l=r[2],f=r[3],_=r[4],d=r[5];return t[0]=a*h+i*c,t[1]=n*h+s*c,t[2]=a*l+i*f,t[3]=n*l+s*f,t[4]=a*_+i*d+o,t[5]=n*_+s*d+u,t}function et(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=Math.sin(r),c=Math.cos(r);return t[0]=a*c+i*h,t[1]=n*c+s*h,t[2]=a*-h+i*c,t[3]=n*-h+s*c,t[4]=o,t[5]=u,t}function rt(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=r[0],c=r[1];return t[0]=a*h,t[1]=n*h,t[2]=i*c,t[3]=s*c,t[4]=o,t[5]=u,t}function at(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=r[0],c=r[1];return t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=a*h+i*c+o,t[5]=n*h+s*c+u,t}function nt(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t[4]=0,t[5]=0,t}function it(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function st(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function ot(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ht(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function ct(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function lt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function ft(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t}function _t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function dt(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=t[4],o=t[5],u=e[0],h=e[1],c=e[2],l=e[3],f=e[4],d=e[5];return Math.abs(r-u)<=_*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-h)<=_*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(n-c)<=_*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-l)<=_*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-f)<=_*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-d)<=_*Math.max(1,Math.abs(o),Math.abs(d))}var mt=tt,pt=ct;function Mt(){var t=new d(9);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function vt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function gt(t){var e=new d(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tt(t,e,r,a,n,i,s,o,u){var h=new d(9);return h[0]=t,h[1]=e,h[2]=r,h[3]=a,h[4]=n,h[5]=i,h[6]=s,h[7]=o,h[8]=u,h}function Et(t,e,r,a,n,i,s,o,u,h){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t[6]=o,t[7]=u,t[8]=h,t}function wt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function yt(t,e){if(t===e){var r=e[1],a=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=a,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function xt(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],u=e[6],h=e[7],c=e[8],l=c*s-o*h,f=-c*i+o*u,_=h*i-s*u,d=r*l+a*f+n*_;return d?(d=1/d,t[0]=l*d,t[1]=(-c*a+n*h)*d,t[2]=(o*a-n*s)*d,t[3]=f*d,t[4]=(c*r-n*u)*d,t[5]=(-o*r+n*i)*d,t[6]=_*d,t[7]=(-h*r+a*u)*d,t[8]=(s*r-a*i)*d,t):null}function Pt(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],u=e[6],h=e[7],c=e[8];return t[0]=s*c-o*h,t[1]=n*h-a*c,t[2]=a*o-n*s,t[3]=o*u-i*c,t[4]=r*c-n*u,t[5]=n*i-r*o,t[6]=i*h-s*u,t[7]=a*u-r*h,t[8]=r*s-a*i,t}function At(t){var e=t[0],r=t[1],a=t[2],n=t[3],i=t[4],s=t[5],o=t[6],u=t[7],h=t[8];return e*(h*i-s*u)+r*(-h*n+s*o)+a*(u*n-i*o)}function St(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=r[0],_=r[1],d=r[2],m=r[3],p=r[4],M=r[5],v=r[6],g=r[7],b=r[8];return t[0]=f*a+_*s+d*h,t[1]=f*n+_*o+d*c,t[2]=f*i+_*u+d*l,t[3]=m*a+p*s+M*h,t[4]=m*n+p*o+M*c,t[5]=m*i+p*u+M*l,t[6]=v*a+g*s+b*h,t[7]=v*n+g*o+b*c,t[8]=v*i+g*u+b*l,t}function Rt(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=r[0],_=r[1];return t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=o,t[5]=u,t[6]=f*a+_*s+h,t[7]=f*n+_*o+c,t[8]=f*i+_*u+l,t}function Ct(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=Math.sin(r),_=Math.cos(r);return t[0]=_*a+f*s,t[1]=_*n+f*o,t[2]=_*i+f*u,t[3]=_*s-f*a,t[4]=_*o-f*n,t[5]=_*u-f*i,t[6]=h,t[7]=c,t[8]=l,t}function Ot(t,e,r){var a=r[0],n=r[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ut(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function jt(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Lt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function It(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ft(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r+r,o=a+a,u=n+n,h=r*s,c=a*s,l=a*o,f=n*s,_=n*o,d=n*u,m=i*s,p=i*o,M=i*u;return t[0]=1-l-d,t[3]=c-M,t[6]=f+p,t[1]=c+M,t[4]=1-h-d,t[7]=_-m,t[2]=f-p,t[5]=_+m,t[8]=1-h-l,t}function Dt(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],_=e[11],d=e[12],m=e[13],p=e[14],M=e[15],v=r*o-a*s,g=r*u-n*s,b=r*h-i*s,T=a*u-n*o,E=a*h-i*o,w=n*h-i*u,y=c*m-l*d,x=c*p-f*d,P=c*M-_*d,A=l*p-f*m,S=l*M-_*m,R=f*M-_*p,C=v*R-g*S+b*A+T*P-E*x+w*y;return C?(C=1/C,t[0]=(o*R-u*S+h*A)*C,t[1]=(u*P-s*R-h*x)*C,t[2]=(s*S-o*P+h*y)*C,t[3]=(n*S-a*R-i*A)*C,t[4]=(r*R-n*P+i*x)*C,t[5]=(a*P-r*S-i*y)*C,t[6]=(m*w-p*E+M*T)*C,t[7]=(p*b-d*w-M*g)*C,t[8]=(d*E-m*b+M*v)*C,t):null}function Vt(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Bt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function qt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function kt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Nt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Xt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Gt(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t}function zt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ht(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8],l=e[0],f=e[1],d=e[2],m=e[3],p=e[4],M=e[5],v=e[6],g=e[7],b=e[8];return Math.abs(r-l)<=_*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-f)<=_*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(n-d)<=_*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-m)<=_*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-p)<=_*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-M)<=_*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(u-v)<=_*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-g)<=_*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(c-b)<=_*Math.max(1,Math.abs(c),Math.abs(b))}var Wt=St,Yt=Nt;function $t(){var t=new d(16);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Jt(t){var e=new d(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Zt(t,e,r,a,n,i,s,o,u,h,c,l,f,_,m,p){var M=new d(16);return M[0]=t,M[1]=e,M[2]=r,M[3]=a,M[4]=n,M[5]=i,M[6]=s,M[7]=o,M[8]=u,M[9]=h,M[10]=c,M[11]=l,M[12]=f,M[13]=_,M[14]=m,M[15]=p,M}function Kt(t,e,r,a,n,i,s,o,u,h,c,l,f,_,d,m,p){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t[6]=o,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=f,t[12]=_,t[13]=d,t[14]=m,t[15]=p,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var r=e[1],a=e[2],n=e[3],i=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=i,t[11]=e[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function re(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],_=e[11],d=e[12],m=e[13],p=e[14],M=e[15],v=r*o-a*s,g=r*u-n*s,b=r*h-i*s,T=a*u-n*o,E=a*h-i*o,w=n*h-i*u,y=c*m-l*d,x=c*p-f*d,P=c*M-_*d,A=l*p-f*m,S=l*M-_*m,R=f*M-_*p,C=v*R-g*S+b*A+T*P-E*x+w*y;return C?(C=1/C,t[0]=(o*R-u*S+h*A)*C,t[1]=(n*S-a*R-i*A)*C,t[2]=(m*w-p*E+M*T)*C,t[3]=(f*E-l*w-_*T)*C,t[4]=(u*P-s*R-h*x)*C,t[5]=(r*R-n*P+i*x)*C,t[6]=(p*b-d*w-M*g)*C,t[7]=(c*w-f*b+_*g)*C,t[8]=(s*S-o*P+h*y)*C,t[9]=(a*P-r*S-i*y)*C,t[10]=(d*E-m*b+M*v)*C,t[11]=(l*b-c*E-_*v)*C,t[12]=(o*x-s*A-u*y)*C,t[13]=(r*A-a*x+n*y)*C,t[14]=(m*g-d*T-p*v)*C,t[15]=(c*T-l*g+f*v)*C,t):null}function ae(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],_=e[11],d=e[12],m=e[13],p=e[14],M=e[15];return t[0]=o*(f*M-_*p)-l*(u*M-h*p)+m*(u*_-h*f),t[1]=-(a*(f*M-_*p)-l*(n*M-i*p)+m*(n*_-i*f)),t[2]=a*(u*M-h*p)-o*(n*M-i*p)+m*(n*h-i*u),t[3]=-(a*(u*_-h*f)-o*(n*_-i*f)+l*(n*h-i*u)),t[4]=-(s*(f*M-_*p)-c*(u*M-h*p)+d*(u*_-h*f)),t[5]=r*(f*M-_*p)-c*(n*M-i*p)+d*(n*_-i*f),t[6]=-(r*(u*M-h*p)-s*(n*M-i*p)+d*(n*h-i*u)),t[7]=r*(u*_-h*f)-s*(n*_-i*f)+c*(n*h-i*u),t[8]=s*(l*M-_*m)-c*(o*M-h*m)+d*(o*_-h*l),t[9]=-(r*(l*M-_*m)-c*(a*M-i*m)+d*(a*_-i*l)),t[10]=r*(o*M-h*m)-s*(a*M-i*m)+d*(a*h-i*o),t[11]=-(r*(o*_-h*l)-s*(a*_-i*l)+c*(a*h-i*o)),t[12]=-(s*(l*p-f*m)-c*(o*p-u*m)+d*(o*f-u*l)),t[13]=r*(l*p-f*m)-c*(a*p-n*m)+d*(a*f-n*l),t[14]=-(r*(o*p-u*m)-s*(a*p-n*m)+d*(a*u-n*o)),t[15]=r*(o*f-u*l)-s*(a*f-n*l)+c*(a*u-n*o),t}function ne(t){var e=t[0],r=t[1],a=t[2],n=t[3],i=t[4],s=t[5],o=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],_=t[12],d=t[13],m=t[14],p=t[15];return(e*s-r*i)*(l*p-f*m)-(e*o-a*i)*(c*p-f*d)+(e*u-n*i)*(c*m-l*d)+(r*o-a*s)*(h*p-f*_)-(r*u-n*s)*(h*m-l*_)+(a*u-n*o)*(h*d-c*_)}function ie(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],_=e[10],d=e[11],m=e[12],p=e[13],M=e[14],v=e[15],g=r[0],b=r[1],T=r[2],E=r[3];return t[0]=g*a+b*o+T*l+E*m,t[1]=g*n+b*u+T*f+E*p,t[2]=g*i+b*h+T*_+E*M,t[3]=g*s+b*c+T*d+E*v,g=r[4],b=r[5],T=r[6],E=r[7],t[4]=g*a+b*o+T*l+E*m,t[5]=g*n+b*u+T*f+E*p,t[6]=g*i+b*h+T*_+E*M,t[7]=g*s+b*c+T*d+E*v,g=r[8],b=r[9],T=r[10],E=r[11],t[8]=g*a+b*o+T*l+E*m,t[9]=g*n+b*u+T*f+E*p,t[10]=g*i+b*h+T*_+E*M,t[11]=g*s+b*c+T*d+E*v,g=r[12],b=r[13],T=r[14],E=r[15],t[12]=g*a+b*o+T*l+E*m,t[13]=g*n+b*u+T*f+E*p,t[14]=g*i+b*h+T*_+E*M,t[15]=g*s+b*c+T*d+E*v,t}function se(t,e,r){var a,n,i,s,o,u,h,c,l,f,_,d,m=r[0],p=r[1],M=r[2];return e===t?(t[12]=e[0]*m+e[4]*p+e[8]*M+e[12],t[13]=e[1]*m+e[5]*p+e[9]*M+e[13],t[14]=e[2]*m+e[6]*p+e[10]*M+e[14],t[15]=e[3]*m+e[7]*p+e[11]*M+e[15]):(a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],_=e[10],d=e[11],t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=o,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=_,t[11]=d,t[12]=a*m+o*p+l*M+e[12],t[13]=n*m+u*p+f*M+e[13],t[14]=i*m+h*p+_*M+e[14],t[15]=s*m+c*p+d*M+e[15]),t}function oe(t,e,r){var a=r[0],n=r[1],i=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ue(t,e,r,a){var n,i,s,o,u,h,c,l,f,d,m,p,M,v,g,b,T,E,w,y,x,P,A,S,R=a[0],C=a[1],O=a[2],U=Math.hypot(R,C,O);return U<_?null:(R*=U=1/U,C*=U,O*=U,n=Math.sin(r),s=1-(i=Math.cos(r)),o=e[0],u=e[1],h=e[2],c=e[3],l=e[4],f=e[5],d=e[6],m=e[7],p=e[8],M=e[9],v=e[10],g=e[11],b=R*R*s+i,T=C*R*s+O*n,E=O*R*s-C*n,w=R*C*s-O*n,y=C*C*s+i,x=O*C*s+R*n,P=R*O*s+C*n,A=C*O*s-R*n,S=O*O*s+i,t[0]=o*b+l*T+p*E,t[1]=u*b+f*T+M*E,t[2]=h*b+d*T+v*E,t[3]=c*b+m*T+g*E,t[4]=o*w+l*y+p*x,t[5]=u*w+f*y+M*x,t[6]=h*w+d*y+v*x,t[7]=c*w+m*y+g*x,t[8]=o*P+l*A+p*S,t[9]=u*P+f*A+M*S,t[10]=h*P+d*A+v*S,t[11]=c*P+m*A+g*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function he(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[4],s=e[5],o=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*n+h*a,t[5]=s*n+c*a,t[6]=o*n+l*a,t[7]=u*n+f*a,t[8]=h*n-i*a,t[9]=c*n-s*a,t[10]=l*n-o*a,t[11]=f*n-u*a,t}function ce(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[0],s=e[1],o=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n-h*a,t[1]=s*n-c*a,t[2]=o*n-l*a,t[3]=u*n-f*a,t[8]=i*a+h*n,t[9]=s*a+c*n,t[10]=o*a+l*n,t[11]=u*a+f*n,t}function le(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[0],s=e[1],o=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n+h*a,t[1]=s*n+c*a,t[2]=o*n+l*a,t[3]=u*n+f*a,t[4]=h*n-i*a,t[5]=c*n-s*a,t[6]=l*n-o*a,t[7]=f*n-u*a,t}function fe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function _e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function de(t,e,r){var a,n,i,s=r[0],o=r[1],u=r[2],h=Math.hypot(s,o,u);return h<_?null:(s*=h=1/h,o*=h,u*=h,a=Math.sin(e),i=1-(n=Math.cos(e)),t[0]=s*s*i+n,t[1]=o*s*i+u*a,t[2]=u*s*i-o*a,t[3]=0,t[4]=s*o*i-u*a,t[5]=o*o*i+n,t[6]=u*o*i+s*a,t[7]=0,t[8]=s*u*i+o*a,t[9]=o*u*i-s*a,t[10]=u*u*i+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function me(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pe(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Me(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ve(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=a+a,u=n+n,h=i+i,c=a*o,l=a*u,f=a*h,_=n*u,d=n*h,m=i*h,p=s*o,M=s*u,v=s*h;return t[0]=1-(_+m),t[1]=l+v,t[2]=f-M,t[3]=0,t[4]=l-v,t[5]=1-(c+m),t[6]=d+p,t[7]=0,t[8]=f+M,t[9]=d-p,t[10]=1-(c+_),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function ge(t,e){var r=new d(3),a=-e[0],n=-e[1],i=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=a*a+n*n+i*i+s*s;return l>0?(r[0]=2*(o*s+c*a+u*i-h*n)/l,r[1]=2*(u*s+c*n+h*a-o*i)/l,r[2]=2*(h*s+c*i+o*n-u*a)/l):(r[0]=2*(o*s+c*a+u*i-h*n),r[1]=2*(u*s+c*n+h*a-o*i),r[2]=2*(h*s+c*i+o*n-u*a)),ve(t,e,r),t}function be(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Te(t,e){var r=e[0],a=e[1],n=e[2],i=e[4],s=e[5],o=e[6],u=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(r,a,n),t[1]=Math.hypot(i,s,o),t[2]=Math.hypot(u,h,c),t}function Ee(t,e){var r=new d(3);Te(r,e);var a=1/r[0],n=1/r[1],i=1/r[2],s=e[0]*a,o=e[1]*n,u=e[2]*i,h=e[4]*a,c=e[5]*n,l=e[6]*i,f=e[8]*a,_=e[9]*n,m=e[10]*i,p=s+c+m,M=0;return p>0?(M=2*Math.sqrt(p+1),t[3]=.25*M,t[0]=(l-_)/M,t[1]=(f-u)/M,t[2]=(o-h)/M):s>c&&s>m?(M=2*Math.sqrt(1+s-c-m),t[3]=(l-_)/M,t[0]=.25*M,t[1]=(o+h)/M,t[2]=(f+u)/M):c>m?(M=2*Math.sqrt(1+c-s-m),t[3]=(f-u)/M,t[0]=(o+h)/M,t[1]=.25*M,t[2]=(l+_)/M):(M=2*Math.sqrt(1+m-s-c),t[3]=(o-h)/M,t[0]=(f+u)/M,t[1]=(l+_)/M,t[2]=.25*M),t}function we(t,e,r,a){var n=e[0],i=e[1],s=e[2],o=e[3],u=n+n,h=i+i,c=s+s,l=n*u,f=n*h,_=n*c,d=i*h,m=i*c,p=s*c,M=o*u,v=o*h,g=o*c,b=a[0],T=a[1],E=a[2];return t[0]=(1-(d+p))*b,t[1]=(f+g)*b,t[2]=(_-v)*b,t[3]=0,t[4]=(f-g)*T,t[5]=(1-(l+p))*T,t[6]=(m+M)*T,t[7]=0,t[8]=(_+v)*E,t[9]=(m-M)*E,t[10]=(1-(l+d))*E,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function ye(t,e,r,a,n){var i=e[0],s=e[1],o=e[2],u=e[3],h=i+i,c=s+s,l=o+o,f=i*h,_=i*c,d=i*l,m=s*c,p=s*l,M=o*l,v=u*h,g=u*c,b=u*l,T=a[0],E=a[1],w=a[2],y=n[0],x=n[1],P=n[2],A=(1-(m+M))*T,S=(_+b)*T,R=(d-g)*T,C=(_-b)*E,O=(1-(f+M))*E,U=(p+v)*E,j=(d+g)*w,L=(p-v)*w,I=(1-(f+m))*w;return t[0]=A,t[1]=S,t[2]=R,t[3]=0,t[4]=C,t[5]=O,t[6]=U,t[7]=0,t[8]=j,t[9]=L,t[10]=I,t[11]=0,t[12]=r[0]+y-(A*y+C*x+j*P),t[13]=r[1]+x-(S*y+O*x+L*P),t[14]=r[2]+P-(R*y+U*x+I*P),t[15]=1,t}function xe(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r+r,o=a+a,u=n+n,h=r*s,c=a*s,l=a*o,f=n*s,_=n*o,d=n*u,m=i*s,p=i*o,M=i*u;return t[0]=1-l-d,t[1]=c+M,t[2]=f-p,t[3]=0,t[4]=c-M,t[5]=1-h-d,t[6]=_+m,t[7]=0,t[8]=f+p,t[9]=_-m,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pe(t,e,r,a,n,i,s){var o=1/(r-e),u=1/(n-a),h=1/(i-s);return t[0]=2*i*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+a)*u,t[10]=(s+i)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*i*2*h,t[15]=0,t}function Ae(t,e,r,a,n){var i,s=1/Math.tan(e/2);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(i=1/(a-n),t[10]=(n+a)*i,t[14]=2*n*a*i):(t[10]=-1,t[14]=-2*a),t}var Se=Ae;function Re(t,e,r,a,n){var i,s=1/Math.tan(e/2);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(i=1/(a-n),t[10]=n*i,t[14]=n*a*i):(t[10]=-1,t[14]=-a),t}function Ce(t,e,r,a){var n=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),u=2/(s+o),h=2/(n+i);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(s-o)*u*.5,t[9]=(n-i)*h*.5,t[10]=a/(r-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r/(r-a),t[15]=0,t}function Oe(t,e,r,a,n,i,s){var o=1/(e-r),u=1/(a-n),h=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*o,t[13]=(n+a)*u,t[14]=(s+i)*h,t[15]=1,t}var Ue=Oe;function je(t,e,r,a,n,i,s){var o=1/(e-r),u=1/(a-n),h=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(e+r)*o,t[13]=(n+a)*u,t[14]=i*h,t[15]=1,t}function Le(t,e,r,a){var n,i,s,o,u,h,c,l,f,d,m=e[0],p=e[1],M=e[2],v=a[0],g=a[1],b=a[2],T=r[0],E=r[1],w=r[2];return Math.abs(m-T)<_&&Math.abs(p-E)<_&&Math.abs(M-w)<_?te(t):(c=m-T,l=p-E,f=M-w,n=g*(f*=d=1/Math.hypot(c,l,f))-b*(l*=d),i=b*(c*=d)-v*f,s=v*l-g*c,(d=Math.hypot(n,i,s))?(n*=d=1/d,i*=d,s*=d):(n=0,i=0,s=0),o=l*s-f*i,u=f*n-c*s,h=c*i-l*n,(d=Math.hypot(o,u,h))?(o*=d=1/d,u*=d,h*=d):(o=0,u=0,h=0),t[0]=n,t[1]=o,t[2]=c,t[3]=0,t[4]=i,t[5]=u,t[6]=l,t[7]=0,t[8]=s,t[9]=h,t[10]=f,t[11]=0,t[12]=-(n*m+i*p+s*M),t[13]=-(o*m+u*p+h*M),t[14]=-(c*m+l*p+f*M),t[15]=1,t)}function Ie(t,e,r,a){var n=e[0],i=e[1],s=e[2],o=a[0],u=a[1],h=a[2],c=n-r[0],l=i-r[1],f=s-r[2],_=c*c+l*l+f*f;_>0&&(c*=_=1/Math.sqrt(_),l*=_,f*=_);var d=u*f-h*l,m=h*c-o*f,p=o*l-u*c;return(_=d*d+m*m+p*p)>0&&(d*=_=1/Math.sqrt(_),m*=_,p*=_),t[0]=d,t[1]=m,t[2]=p,t[3]=0,t[4]=l*p-f*m,t[5]=f*d-c*p,t[6]=c*m-l*d,t[7]=0,t[8]=c,t[9]=l,t[10]=f,t[11]=0,t[12]=n,t[13]=i,t[14]=s,t[15]=1,t}function Fe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function De(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ve(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Be(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function qe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function ke(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t[9]=e[9]+r[9]*a,t[10]=e[10]+r[10]*a,t[11]=e[11]+r[11]*a,t[12]=e[12]+r[12]*a,t[13]=e[13]+r[13]*a,t[14]=e[14]+r[14]*a,t[15]=e[15]+r[15]*a,t}function Ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Xe(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8],l=t[9],f=t[10],d=t[11],m=t[12],p=t[13],M=t[14],v=t[15],g=e[0],b=e[1],T=e[2],E=e[3],w=e[4],y=e[5],x=e[6],P=e[7],A=e[8],S=e[9],R=e[10],C=e[11],O=e[12],U=e[13],j=e[14],L=e[15];return Math.abs(r-g)<=_*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-b)<=_*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(n-T)<=_*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(i-E)<=_*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(s-w)<=_*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-y)<=_*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(u-x)<=_*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-P)<=_*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(c-A)<=_*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-S)<=_*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(f-R)<=_*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(d-C)<=_*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(m-O)<=_*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(p-U)<=_*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(M-j)<=_*Math.max(1,Math.abs(M),Math.abs(j))&&Math.abs(v-L)<=_*Math.max(1,Math.abs(v),Math.abs(L))}var Ge=ie,ze=Be;function He(){var t=new d(3);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function We(t){var e=new d(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ye(t){var e=t[0],r=t[1],a=t[2];return Math.hypot(e,r,a)}function $e(t,e,r){var a=new d(3);return a[0]=t,a[1]=e,a[2]=r,a}function Je(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Qe(t,e,r,a){return t[0]=e,t[1]=r,t[2]=a,t}function Ze(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Ke(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function tr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function er(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function rr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function ar(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function nr(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function ir(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function sr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function or(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function ur(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t}function hr(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return Math.hypot(r,a,n)}function cr(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return r*r+a*a+n*n}function lr(t){var e=t[0],r=t[1],a=t[2];return e*e+r*r+a*a}function fr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function _r(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function dr(t,e){var r=e[0],a=e[1],n=e[2],i=r*r+a*a+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function mr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function pr(t,e,r){var a=e[0],n=e[1],i=e[2],s=r[0],o=r[1],u=r[2];return t[0]=n*u-i*o,t[1]=i*s-a*u,t[2]=a*o-n*s,t}function Mr(t,e,r,a){var n=e[0],i=e[1],s=e[2];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t[2]=s+a*(r[2]-s),t}function vr(t,e,r,a,n,i){var s=i*i,o=s*(2*i-3)+1,u=s*(i-2)+i,h=s*(i-1),c=s*(3-2*i);return t[0]=e[0]*o+r[0]*u+a[0]*h+n[0]*c,t[1]=e[1]*o+r[1]*u+a[1]*h+n[1]*c,t[2]=e[2]*o+r[2]*u+a[2]*h+n[2]*c,t}function gr(t,e,r,a,n,i){var s=1-i,o=s*s,u=i*i,h=o*s,c=3*i*o,l=3*u*s,f=u*i;return t[0]=e[0]*h+r[0]*c+a[0]*l+n[0]*f,t[1]=e[1]*h+r[1]*c+a[1]*l+n[1]*f,t[2]=e[2]*h+r[2]*c+a[2]*l+n[2]*f,t}function br(t,e){e=e||1;var r=2*m()*Math.PI,a=2*m()-1,n=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=a*e,t}function Tr(t,e,r){var a=e[0],n=e[1],i=e[2],s=r[3]*a+r[7]*n+r[11]*i+r[15];return s=s||1,t[0]=(r[0]*a+r[4]*n+r[8]*i+r[12])/s,t[1]=(r[1]*a+r[5]*n+r[9]*i+r[13])/s,t[2]=(r[2]*a+r[6]*n+r[10]*i+r[14])/s,t}function Er(t,e,r){var a=e[0],n=e[1],i=e[2];return t[0]=a*r[0]+n*r[3]+i*r[6],t[1]=a*r[1]+n*r[4]+i*r[7],t[2]=a*r[2]+n*r[5]+i*r[8],t}function wr(t,e,r){var a=r[0],n=r[1],i=r[2],s=r[3],o=e[0],u=e[1],h=e[2],c=n*h-i*u,l=i*o-a*h,f=a*u-n*o,_=n*f-i*l,d=i*c-a*f,m=a*l-n*c,p=2*s;return c*=p,l*=p,f*=p,_*=2,d*=2,m*=2,t[0]=o+c+_,t[1]=u+l+d,t[2]=h+f+m,t}function yr(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[0],i[1]=n[1]*Math.cos(a)-n[2]*Math.sin(a),i[2]=n[1]*Math.sin(a)+n[2]*Math.cos(a),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function xr(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[2]*Math.sin(a)+n[0]*Math.cos(a),i[1]=n[1],i[2]=n[2]*Math.cos(a)-n[0]*Math.sin(a),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Pr(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[0]*Math.cos(a)-n[1]*Math.sin(a),i[1]=n[0]*Math.sin(a)+n[1]*Math.cos(a),i[2]=n[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Ar(t,e){var r=t[0],a=t[1],n=t[2],i=e[0],s=e[1],o=e[2],u=Math.sqrt(r*r+a*a+n*n)*Math.sqrt(i*i+s*s+o*o),h=u&&mr(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}function Sr(t){return t[0]=0,t[1]=0,t[2]=0,t}function Rr(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Cr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Or(t,e){var r=t[0],a=t[1],n=t[2],i=e[0],s=e[1],o=e[2];return Math.abs(r-i)<=_*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-s)<=_*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(n-o)<=_*Math.max(1,Math.abs(n),Math.abs(o))}var Ur,jr=Ke,Lr=tr,Ir=er,Fr=hr,Dr=cr,Vr=Ye,Br=lr,qr=(Ur=He(),function(t,e,r,a,n,i){var s,o;for(e||(e=3),r||(r=0),o=a?Math.min(a*e+r,t.length):t.length,s=r;s<o;s+=e)Ur[0]=t[s],Ur[1]=t[s+1],Ur[2]=t[s+2],n(Ur,Ur,i),t[s]=Ur[0],t[s+1]=Ur[1],t[s+2]=Ur[2];return t});function kr(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Nr(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xr(t,e,r,a){var n=new d(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n}function Gr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function zr(t,e,r,a,n){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t}function Hr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Wr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Yr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function $r(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Jr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Qr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Zr(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Kr(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function ta(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function ea(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ra(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t}function aa(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2],i=e[3]-t[3];return Math.hypot(r,a,n,i)}function na(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2],i=e[3]-t[3];return r*r+a*a+n*n+i*i}function ia(t){var e=t[0],r=t[1],a=t[2],n=t[3];return Math.hypot(e,r,a,n)}function sa(t){var e=t[0],r=t[1],a=t[2],n=t[3];return e*e+r*r+a*a+n*n}function oa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function ua(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ha(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r*r+a*a+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=a*s,t[2]=n*s,t[3]=i*s,t}function ca(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function la(t,e,r,a){var n=r[0]*a[1]-r[1]*a[0],i=r[0]*a[2]-r[2]*a[0],s=r[0]*a[3]-r[3]*a[0],o=r[1]*a[2]-r[2]*a[1],u=r[1]*a[3]-r[3]*a[1],h=r[2]*a[3]-r[3]*a[2],c=e[0],l=e[1],f=e[2],_=e[3];return t[0]=l*h-f*u+_*o,t[1]=-c*h+f*s-_*i,t[2]=c*u-l*s+_*n,t[3]=-c*o+l*i-f*n,t}function fa(t,e,r,a){var n=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t[2]=s+a*(r[2]-s),t[3]=o+a*(r[3]-o),t}function _a(t,e){var r,a,n,i,s,o;e=e||1;do{s=(r=2*m()-1)*r+(a=2*m()-1)*a}while(s>=1);do{o=(n=2*m()-1)*n+(i=2*m()-1)*i}while(o>=1);var u=Math.sqrt((1-s)/o);return t[0]=e*r,t[1]=e*a,t[2]=e*n*u,t[3]=e*i*u,t}function da(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3];return t[0]=r[0]*a+r[4]*n+r[8]*i+r[12]*s,t[1]=r[1]*a+r[5]*n+r[9]*i+r[13]*s,t[2]=r[2]*a+r[6]*n+r[10]*i+r[14]*s,t[3]=r[3]*a+r[7]*n+r[11]*i+r[15]*s,t}function ma(t,e,r){var a=e[0],n=e[1],i=e[2],s=r[0],o=r[1],u=r[2],h=r[3],c=h*a+o*i-u*n,l=h*n+u*a-s*i,f=h*i+s*n-o*a,_=-s*a-o*n-u*i;return t[0]=c*h+_*-s+l*-u-f*-o,t[1]=l*h+_*-o+f*-s-c*-u,t[2]=f*h+_*-u+c*-o-l*-s,t[3]=e[3],t}function pa(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Ma(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function va(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function ga(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=e[0],o=e[1],u=e[2],h=e[3];return Math.abs(r-s)<=_*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-o)<=_*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(n-u)<=_*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=_*Math.max(1,Math.abs(i),Math.abs(h))}var ba=Wr,Ta=Yr,Ea=$r,wa=aa,ya=na,xa=ia,Pa=sa,Aa=function(){var t=kr();return function(e,r,a,n,i,s){var o,u;for(r||(r=4),a||(a=0),u=n?Math.min(n*r+a,e.length):e.length,o=a;o<u;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();function Sa(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ra(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ca(t,e,r){r*=.5;var a=Math.sin(r);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(r),t}function Oa(t,e){var r=2*Math.acos(e[3]),a=Math.sin(r/2);return a>_?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),r}function Ua(t,e){var r=un(t,e);return Math.acos(2*r*r-1)}function ja(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],u=r[1],h=r[2],c=r[3];return t[0]=a*c+s*o+n*h-i*u,t[1]=n*c+s*u+i*o-a*h,t[2]=i*c+s*h+a*u-n*o,t[3]=s*c-a*o-n*u-i*h,t}function La(t,e,r){r*=.5;var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=a*u+s*o,t[1]=n*u+i*o,t[2]=i*u-n*o,t[3]=s*u-a*o,t}function Ia(t,e,r){r*=.5;var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=a*u-i*o,t[1]=n*u+s*o,t[2]=i*u+a*o,t[3]=s*u-n*o,t}function Fa(t,e,r){r*=.5;var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=a*u+n*o,t[1]=n*u-a*o,t[2]=i*u+s*o,t[3]=s*u-i*o,t}function Da(t,e){var r=e[0],a=e[1],n=e[2];return t[0]=r,t[1]=a,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-a*a-n*n)),t}function Va(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=Math.sqrt(r*r+a*a+n*n),o=Math.exp(i),u=s>0?o*Math.sin(s)/s:0;return t[0]=r*u,t[1]=a*u,t[2]=n*u,t[3]=o*Math.cos(s),t}function Ba(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=Math.sqrt(r*r+a*a+n*n),o=s>0?Math.atan2(s,i)/s:0;return t[0]=r*o,t[1]=a*o,t[2]=n*o,t[3]=.5*Math.log(r*r+a*a+n*n+i*i),t}function qa(t,e,r){return Ba(t,e),on(t,t,r),Va(t,t),t}function ka(t,e,r,a){var n,i,s,o,u,h=e[0],c=e[1],l=e[2],f=e[3],d=r[0],m=r[1],p=r[2],M=r[3];return(i=h*d+c*m+l*p+f*M)<0&&(i=-i,d=-d,m=-m,p=-p,M=-M),1-i>_?(n=Math.acos(i),s=Math.sin(n),o=Math.sin((1-a)*n)/s,u=Math.sin(a*n)/s):(o=1-a,u=a),t[0]=o*h+u*d,t[1]=o*c+u*m,t[2]=o*l+u*p,t[3]=o*f+u*M,t}function Na(t){var e=m(),r=m(),a=m(),n=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*a),t[3]=i*Math.cos(2*Math.PI*a),t}function Xa(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r*r+a*a+n*n+i*i,o=s?1/s:0;return t[0]=-r*o,t[1]=-a*o,t[2]=-n*o,t[3]=i*o,t}function Ga(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function za(t,e){var r,a=e[0]+e[4]+e[8];if(a>0)r=Math.sqrt(a+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var i=(n+1)%3,s=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*s+s]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*i+s]-e[3*s+i])*r,t[i]=(e[3*i+n]+e[3*n+i])*r,t[s]=(e[3*s+n]+e[3*n+s])*r}return t}function Ha(t,e,r,a){var n=.5*Math.PI/180;e*=n,r*=n,a*=n;var i=Math.sin(e),s=Math.cos(e),o=Math.sin(r),u=Math.cos(r),h=Math.sin(a),c=Math.cos(a);return t[0]=i*u*c-s*o*h,t[1]=s*o*c+i*u*h,t[2]=s*u*h-i*o*c,t[3]=s*u*c+i*o*h,t}function Wa(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Ya,$a,Ja,Qa,Za,Ka,tn=Nr,en=Xr,rn=Gr,an=zr,nn=Hr,sn=ja,on=ea,un=ca,hn=fa,cn=ia,ln=cn,fn=sa,_n=fn,dn=ha,mn=va,pn=ga,Mn=(Ya=He(),$a=$e(1,0,0),Ja=$e(0,1,0),function(t,e,r){var a=mr(e,r);return a<-.999999?(pr(Ya,$a,e),Vr(Ya)<1e-6&&pr(Ya,Ja,e),dr(Ya,Ya),Ca(t,Ya,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(pr(Ya,e,r),t[0]=Ya[0],t[1]=Ya[1],t[2]=Ya[2],t[3]=1+a,dn(t,t))}),vn=(Qa=Sa(),Za=Sa(),function(t,e,r,a,n,i){return ka(Qa,e,n,i),ka(Za,r,a,i),ka(t,Qa,Za,2*i*(1-i)),t}),gn=(Ka=Mt(),function(t,e,r,a){return Ka[0]=r[0],Ka[3]=r[1],Ka[6]=r[2],Ka[1]=a[0],Ka[4]=a[1],Ka[7]=a[2],Ka[2]=-e[0],Ka[5]=-e[1],Ka[8]=-e[2],dn(t,za(t,Ka))});function bn(){var t=new d(8);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function Tn(t){var e=new d(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function En(t,e,r,a,n,i,s,o){var u=new d(8);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u[4]=n,u[5]=i,u[6]=s,u[7]=o,u}function wn(t,e,r,a,n,i,s){var o=new d(8);o[0]=t,o[1]=e,o[2]=r,o[3]=a;var u=.5*n,h=.5*i,c=.5*s;return o[4]=u*a+h*r-c*e,o[5]=h*a+c*t-u*r,o[6]=c*a+u*e-h*t,o[7]=-u*t-h*e-c*r,o}function yn(t,e,r){var a=.5*r[0],n=.5*r[1],i=.5*r[2],s=e[0],o=e[1],u=e[2],h=e[3];return t[0]=s,t[1]=o,t[2]=u,t[3]=h,t[4]=a*h+n*u-i*o,t[5]=n*h+i*s-a*u,t[6]=i*h+a*o-n*s,t[7]=-a*s-n*o-i*u,t}function xn(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Pn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function An(t,e){var r=Sa();Ee(r,e);var a=new d(3);return be(a,e),yn(t,r,a),t}function Sn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Rn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Cn(t,e,r,a,n,i,s,o,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t[6]=o,t[7]=u,t}var On=rn;function Un(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var jn=rn;function Ln(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function In(t,e){var r=e[4],a=e[5],n=e[6],i=e[7],s=-e[0],o=-e[1],u=-e[2],h=e[3];return t[0]=2*(r*h+i*s+a*u-n*o),t[1]=2*(a*h+i*o+n*s-r*u),t[2]=2*(n*h+i*u+r*o-a*s),t}function Fn(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=.5*r[0],u=.5*r[1],h=.5*r[2],c=e[4],l=e[5],f=e[6],_=e[7];return t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=s*o+n*h-i*u+c,t[5]=s*u+i*o-a*h+l,t[6]=s*h+a*u-n*o+f,t[7]=-a*o-n*u-i*h+_,t}function Dn(t,e,r){var a=-e[0],n=-e[1],i=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=o*s+c*a+u*i-h*n,f=u*s+c*n+h*a-o*i,_=h*s+c*i+o*n-u*a,d=c*s-o*a-u*n-h*i;return La(t,e,r),a=t[0],n=t[1],i=t[2],s=t[3],t[4]=l*s+d*a+f*i-_*n,t[5]=f*s+d*n+_*a-l*i,t[6]=_*s+d*i+l*n-f*a,t[7]=d*s-l*a-f*n-_*i,t}function Vn(t,e,r){var a=-e[0],n=-e[1],i=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=o*s+c*a+u*i-h*n,f=u*s+c*n+h*a-o*i,_=h*s+c*i+o*n-u*a,d=c*s-o*a-u*n-h*i;return Ia(t,e,r),a=t[0],n=t[1],i=t[2],s=t[3],t[4]=l*s+d*a+f*i-_*n,t[5]=f*s+d*n+_*a-l*i,t[6]=_*s+d*i+l*n-f*a,t[7]=d*s-l*a-f*n-_*i,t}function Bn(t,e,r){var a=-e[0],n=-e[1],i=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=o*s+c*a+u*i-h*n,f=u*s+c*n+h*a-o*i,_=h*s+c*i+o*n-u*a,d=c*s-o*a-u*n-h*i;return Fa(t,e,r),a=t[0],n=t[1],i=t[2],s=t[3],t[4]=l*s+d*a+f*i-_*n,t[5]=f*s+d*n+_*a-l*i,t[6]=_*s+d*i+l*n-f*a,t[7]=d*s-l*a-f*n-_*i,t}function qn(t,e,r){var a=r[0],n=r[1],i=r[2],s=r[3],o=e[0],u=e[1],h=e[2],c=e[3];return t[0]=o*s+c*a+u*i-h*n,t[1]=u*s+c*n+h*a-o*i,t[2]=h*s+c*i+o*n-u*a,t[3]=c*s-o*a-u*n-h*i,o=e[4],u=e[5],h=e[6],c=e[7],t[4]=o*s+c*a+u*i-h*n,t[5]=u*s+c*n+h*a-o*i,t[6]=h*s+c*i+o*n-u*a,t[7]=c*s-o*a-u*n-h*i,t}function kn(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],u=r[1],h=r[2],c=r[3];return t[0]=a*c+s*o+n*h-i*u,t[1]=n*c+s*u+i*o-a*h,t[2]=i*c+s*h+a*u-n*o,t[3]=s*c-a*o-n*u-i*h,o=r[4],u=r[5],h=r[6],c=r[7],t[4]=a*c+s*o+n*h-i*u,t[5]=n*c+s*u+i*o-a*h,t[6]=i*c+s*h+a*u-n*o,t[7]=s*c-a*o-n*u-i*h,t}function Nn(t,e,r,a){if(Math.abs(a)<_)return Sn(t,e);var n=Math.hypot(r[0],r[1],r[2]);a*=.5;var i=Math.sin(a),s=i*r[0]/n,o=i*r[1]/n,u=i*r[2]/n,h=Math.cos(a),c=e[0],l=e[1],f=e[2],d=e[3];t[0]=c*h+d*s+l*u-f*o,t[1]=l*h+d*o+f*s-c*u,t[2]=f*h+d*u+c*o-l*s,t[3]=d*h-c*s-l*o-f*u;var m=e[4],p=e[5],M=e[6],v=e[7];return t[4]=m*h+v*s+p*u-M*o,t[5]=p*h+v*o+M*s-m*u,t[6]=M*h+v*u+m*o-p*s,t[7]=v*h-m*s-p*o-M*u,t}function Xn(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Gn(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[4],u=r[5],h=r[6],c=r[7],l=e[4],f=e[5],_=e[6],d=e[7],m=r[0],p=r[1],M=r[2],v=r[3];return t[0]=a*v+s*m+n*M-i*p,t[1]=n*v+s*p+i*m-a*M,t[2]=i*v+s*M+a*p-n*m,t[3]=s*v-a*m-n*p-i*M,t[4]=a*c+s*o+n*h-i*u+l*v+d*m+f*M-_*p,t[5]=n*c+s*u+i*o-a*h+f*v+d*p+_*m-l*M,t[6]=i*c+s*h+a*u-n*o+_*v+d*M+l*p-f*m,t[7]=s*c-a*o-n*u-i*h+d*v-l*m-f*p-_*M,t}var zn=Gn;function Hn(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var Wn=un;function Yn(t,e,r,a){var n=1-a;return Wn(e,r)<0&&(a=-a),t[0]=e[0]*n+r[0]*a,t[1]=e[1]*n+r[1]*a,t[2]=e[2]*n+r[2]*a,t[3]=e[3]*n+r[3]*a,t[4]=e[4]*n+r[4]*a,t[5]=e[5]*n+r[5]*a,t[6]=e[6]*n+r[6]*a,t[7]=e[7]*n+r[7]*a,t}function $n(t,e){var r=Kn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function Jn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Qn=cn,Zn=Qn,Kn=fn,ti=Kn;function ei(t,e){var r=Kn(e);if(r>0){r=Math.sqrt(r);var a=e[0]/r,n=e[1]/r,i=e[2]/r,s=e[3]/r,o=e[4],u=e[5],h=e[6],c=e[7],l=a*o+n*u+i*h+s*c;t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=(o-a*l)/r,t[5]=(u-n*l)/r,t[6]=(h-i*l)/r,t[7]=(c-s*l)/r}return t}function ri(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function ai(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ni(t,e){var r=t[0],a=t[1],n=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=e[0],l=e[1],f=e[2],d=e[3],m=e[4],p=e[5],M=e[6],v=e[7];return Math.abs(r-c)<=_*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-l)<=_*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(n-f)<=_*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-d)<=_*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-m)<=_*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-p)<=_*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-M)<=_*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-v)<=_*Math.max(1,Math.abs(h),Math.abs(v))}function ii(){var t=new d(2);return d!=Float32Array&&(t[0]=0,t[1]=0),t}function si(t){var e=new d(2);return e[0]=t[0],e[1]=t[1],e}function oi(t,e){var r=new d(2);return r[0]=t,r[1]=e,r}function ui(t,e){return t[0]=e[0],t[1]=e[1],t}function hi(t,e,r){return t[0]=e,t[1]=r,t}function ci(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function li(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function fi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function _i(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function di(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function mi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function pi(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Mi(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function vi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function gi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function bi(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t}function Ti(t,e){var r=e[0]-t[0],a=e[1]-t[1];return Math.hypot(r,a)}function Ei(t,e){var r=e[0]-t[0],a=e[1]-t[1];return r*r+a*a}function wi(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function yi(t){var e=t[0],r=t[1];return e*e+r*r}function xi(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Pi(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Ai(t,e){var r=e[0],a=e[1],n=r*r+a*a;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function Si(t,e){return t[0]*e[0]+t[1]*e[1]}function Ri(t,e,r){var a=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=a,t}function Ci(t,e,r,a){var n=e[0],i=e[1];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t}function Oi(t,e){e=e||1;var r=2*m()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Ui(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[2]*n,t[1]=r[1]*a+r[3]*n,t}function ji(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[2]*n+r[4],t[1]=r[1]*a+r[3]*n+r[5],t}function Li(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[3]*n+r[6],t[1]=r[1]*a+r[4]*n+r[7],t}function Ii(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[4]*n+r[12],t[1]=r[1]*a+r[5]*n+r[13],t}function Fi(t,e,r,a){var n=e[0]-r[0],i=e[1]-r[1],s=Math.sin(a),o=Math.cos(a);return t[0]=n*o-i*s+r[0],t[1]=n*s+i*o+r[1],t}function Di(t,e){var r=t[0],a=t[1],n=e[0],i=e[1],s=Math.sqrt(r*r+a*a)*Math.sqrt(n*n+i*i),o=s&&(r*n+a*i)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function Vi(t){return t[0]=0,t[1]=0,t}function Bi(t){return"vec2("+t[0]+", "+t[1]+")"}function qi(t,e){return t[0]===e[0]&&t[1]===e[1]}function ki(t,e){var r=t[0],a=t[1],n=e[0],i=e[1];return Math.abs(r-n)<=_*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(a-i)<=_*Math.max(1,Math.abs(a),Math.abs(i))}var Ni=wi,Xi=li,Gi=fi,zi=_i,Hi=Ti,Wi=Ei,Yi=yi,$i=function(){var t=ii();return function(e,r,a,n,i,s){var o,u;for(r||(r=2),a||(a=0),u=n?Math.min(n*r+a,e.length):e.length,o=a;o<u;o+=r)t[0]=e[o],t[1]=e[o+1],i(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}()},8903:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationClip=void 0,e.AnimationClip=class{tracks;name;startTime;endTime;duration;constructor(t){this.name=t,this.tracks=[],this.startTime=1/0,this.endTime=0,this.duration=0}sample(t,e){const r=t.copy;for(let t=0;t<this.tracks.length;t++){const a=this.tracks[t].id,n=r.getLocalTransform(a),i=this.tracks[t].sample(n,e);r.setLocalTransform(a,i)}return r}recalculateDuration(){for(let t=0;t<this.tracks.length;t++)this.startTime=Math.min(this.startTime,this.tracks[t].startTime),this.endTime=Math.max(this.endTime,this.tracks[t].endTime);this.duration=this.endTime-this.startTime}}},4011:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationControl=void 0,e.AnimationControl=class{_currentClip;_clips;_time;_speed;_skeleton;_fadeTargets;_fadeParallel;_fadeTime;_fadeDuration;constructor(t){this._currentClip=null,this._clips={},this._time=null,this._speed=1,this._skeleton=t,this._fadeTargets=[],this._fadeParallel=!1,this._fadeTime=0,this._fadeDuration=.25}addClip(t,e){this._clips[t]=e}play(t){this._currentClip?.name!==t&&(this._currentClip=this._clips[t],this._time=null)}fadeTo(t,e=!1){this._fadeTargets.length>0?this._fadeTargets[1]=this._clips[t]:(this._fadeTargets.push(this._clips[t]),this._fadeParallel=e)}update(t){if(null===this._currentClip)return;null===this._time&&(this._time=this._currentClip.startTime);const e=t*this._speed;this._time+=e,this._time>this._currentClip.endTime&&(this._time=Math.max(this._time%this._currentClip.duration,this._currentClip.startTime));let r=this._currentClip.sample(this._skeleton.bindPose,this._time);if(this._fadeTargets.length>0){this._fadeTime+=e;const t=this._fadeTargets[0];let a=this._fadeTime;if(this._fadeParallel&&(a=this._time/this._currentClip.duration*t.duration),this._fadeTime>this._fadeDuration)this._currentClip=this._fadeTargets.shift(),this._time=a,this._fadeTime=0,r=this._currentClip.sample(this._skeleton.bindPose,a);else{const e=this._fadeTime/this._fadeDuration,n=t.sample(this._skeleton.bindPose,a);r=r.blendTo(n,e)}}this._skeleton.currentPose.apply(r)}}},1905:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.QuaternionFrame=void 0;const a=r(887),n=r(3641);e.QuaternionFrame=class{time;value;constructor(t,e){this.time=t,this.value=e}interpolate(t,e,r){if(r===n.Interpolation.STEP)return this.value;if(r===n.Interpolation.LINEAR)return a.quat.slerp(a.quat.create(),this.value,t.value,e);if(r===n.Interpolation.CUBICSPLINE)throw new Error("Cubic spline quaternion interpolation is not implemented.");throw new Error(`Unrecognized quaternion interpolation: "${r}".`)}}},9036:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VectorFrame=void 0;const a=r(887),n=r(3641);e.VectorFrame=class{time;value;constructor(t,e){this.time=t,this.value=e}interpolate(t,e,r){if(r===n.Interpolation.STEP)return this.value;if(r===n.Interpolation.LINEAR)return a.vec3.lerp(a.vec3.create(),this.value,t.value,e);if(r===n.Interpolation.CUBICSPLINE)throw new Error("Cubic spline vector interpolation is not implemented.");throw new Error(`Unrecognized vector interpolation: "${r}".`)}}},3641:(t,e)=>{var r;Object.defineProperty(e,"__esModule",{value:!0}),e.Interpolation=void 0,function(t){t.LINEAR="LINEAR",t.STEP="STEP",t.CUBICSPLINE="CUBICSPLINE"}(r||(e.Interpolation=r={}))},1462:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Pose=void 0;const a=r(6143),n=r(887);class i{_nodes;_names;constructor(t=[],e=[]){this._nodes=t,this._names=e}apply(t){for(let e=0;e<this._nodes.length;e++){const r=t._nodes[e],a=this._nodes[e];a.translation=r.translation,a.rotation=r.rotation,a.scale=r.scale}}addNode(t,e){this._nodes.push(e),this._names.push(t)}getLocalTransform(t){if(void 0===this._nodes[t])throw new Error(`Cannot get global transform for index "${t}": undefined node.`);return this._nodes[t]}setLocalTransform(t,e){this._nodes[t]=e}blendTo(t,e){const r=this.copy;for(let i=0;i<this._nodes.length;i++){const s=this._nodes[i],o=t._nodes[i];r._nodes[i]=new a.Transform(n.vec3.lerp(n.vec3.create(),s.translation,o.translation,e),n.quat.slerp(n.quat.create(),s.rotation,o.rotation,e),n.vec3.lerp(n.vec3.create(),s.scale,o.scale,e))}return r}get copy(){return new i(this._nodes.map((t=>t.copy())),this._names.map((t=>t)))}}e.Pose=i},9414:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;const a=r(3641);e.Track=class{_frames;_interpolation;constructor(t,e=a.Interpolation.LINEAR){this._frames=t,this._interpolation=e}sample(t){const e=this.getFrameIndexAt(t),r=this._frames[e],a=this._frames[e+1];if(void 0===a)throw new Error("Can't sample track: next frame doesn't exists.");const n=(t-r.time)/(a.time-r.time);return r.interpolate(a,n,this._interpolation)}get startTime(){return this._frames.reduce(((t,e)=>Math.min(t,e.time)),1/0)}get endTime(){return this._frames.reduce(((t,e)=>Math.max(t,e.time)),0)}getFrameIndexAt(t){for(let e=0;e<this._frames.length;e++)if(this._frames[e].time>=t)return Math.max(1,e)-1;throw new Error(`Can't get current frame index at time "${t}": time is out of bounds.`)}}},2218:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TransformTrack=void 0,e.TransformTrack=class{id;translation=null;rotation=null;scale=null;constructor(t){this.id=t}sample(t,e){return null!==this.translation&&(t.translation=this.translation.sample(e)),null!==this.rotation&&(t.rotation=this.rotation.sample(e)),null!==this.scale&&(t.scale=this.scale.sample(e)),t}get startTime(){let t=1/0;if(null!==this.translation&&(t=Math.min(t,this.translation.startTime)),null!==this.rotation&&(t=Math.min(t,this.rotation.startTime)),null!==this.scale&&(t=Math.min(t,this.scale.startTime)),t===1/0)throw new Error("Cannot calculate start time: no available tracks.");return t}get endTime(){let t=0;if(null!==this.translation&&(t=Math.max(t,this.translation.endTime)),null!==this.rotation&&(t=Math.max(t,this.rotation.endTime)),null!==this.scale&&(t=Math.max(t,this.scale.endTime)),0===t)throw new Error("Cannot calculate end time: no available tracks.");return t}}},647:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const a=r(887),n=r(3347);e.Camera=class{_fov=45;_near=.1;_far=200;_zoomFactor=.01;_zoomMin=5;_zoomMax=40;_rotateFactor=.01;_width;_height;_mouseInput;_worldUp;_position;_target;_direction;_projectionMatrix;_projectionChanged=!0;_viewMatrix;_viewChanged=!0;_projectionViewMatrix;_projectionViewChanged=!0;_followTarget;_previousTargetPosition;screenPosition;_orbit=!0;constructor(t,e,r){this._width=t.width,this._height=t.height,this._mouseInput=r,this._worldUp=a.vec3.fromValues(0,1,0),this._position=e,this._target=a.vec3.fromValues(0,0,0),this._projectionMatrix=a.mat4.create(),this._viewMatrix=a.mat4.create(),this._projectionViewMatrix=a.mat4.create(),this._direction=a.vec3.normalize(a.vec3.create(),a.vec3.subtract(a.vec3.create(),this._position,this._target)),this._followTarget=null,this._previousTargetPosition=null,this.screenPosition=null}update(t){if(this._orbit&&(a.vec3.rotateY(this._position,this._position,this._target,.1*t),this.calculateViewMatrix()),this._mouseInput._scrolling){const t=a.vec3.create();a.vec3.scale(t,this._direction,this._mouseInput._wheelOffset*this._zoomFactor);const e=a.vec3.add(a.vec3.create(),this._position,t),r=a.vec3.length(a.vec3.subtract(a.vec3.create(),e,this._target));r>this._zoomMin&&r<this._zoomMax&&(a.vec3.scale(t,this._direction,this._mouseInput._wheelOffset*this._zoomFactor),this._position=e,a.vec3.normalize(this._direction,a.vec3.subtract(a.vec3.create(),this._position,this._target)),this.calculateViewMatrix())}if(this._mouseInput._clicked){const t=-this._mouseInput._offsetX*this._rotateFactor;a.vec3.rotateY(this._position,this._position,this._target,t),this.calculateViewMatrix()}if(null!==this._followTarget&&null!==this._previousTargetPosition){const t=a.vec3.clone(this._followTarget.translation);t[1]=1.3;const e=t[0]-this._previousTargetPosition[0],r=t[2]-this._previousTargetPosition[2];this._position[0]+=e,this._position[2]+=r,this._target=t,this._previousTargetPosition=t,a.vec3.normalize(this._direction,a.vec3.subtract(a.vec3.create(),this._position,this._target)),this.calculateViewMatrix()}}follow(t){this._followTarget=t,this._previousTargetPosition=t.translation}get flatDirection(){return this._direction[1]=0,this._direction}get viewMatrix(){return this._viewChanged&&(a.mat4.lookAt(this._viewMatrix,this._position,this._target,this._worldUp),this._viewChanged=!1),this._viewMatrix}get projectionMatrix(){return this._projectionChanged&&(a.mat4.perspective(this._projectionMatrix,this._fov,this._width/this._height,this._near,this._far),this._projectionChanged=!1),this._projectionMatrix}get projectionViewMatrix(){return this._projectionViewChanged&&(a.mat4.multiply(this._projectionViewMatrix,this.projectionMatrix,this.viewMatrix),this._projectionViewChanged=!1),this._projectionViewMatrix}calculateViewMatrix(){this._viewChanged=!0,this._projectionViewChanged=!0}calculateProjectionMatrix(){this._projectionChanged=!0,this._projectionViewChanged=!0}get rotY(){const t=a.mat4.getRotation(a.quat.create(),this.viewMatrix),e=Math.atan2(t[1],t[3]);return a.quat.fromValues(0,Math.sin(e),0,Math.cos(e))}get invertRotY(){return a.quat.invert(a.quat.create(),this.rotY)}get width(){return this._width}get height(){return this._height}stopOrbiting(){this._orbit=!1}splitScreen(t){t!==n.CameraPosition.TOP&&t!==n.CameraPosition.BOTTOM||(this._height/=2,this.calculateProjectionMatrix()),t!==n.CameraPosition.LEFT&&t!==n.CameraPosition.RIGHT||(this._width/=2,this.calculateProjectionMatrix()),this.screenPosition=t}}},3347:(t,e)=>{var r;Object.defineProperty(e,"__esModule",{value:!0}),e.CameraPosition=void 0,function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(r||(e.CameraPosition=r={}))},4461:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Assets=void 0;const a=r(1491);e.Assets=class{_queue;_shaders;_images;_models;_afterLoad;_assetsCount=0;_assetsLoaded=0;constructor(){this._afterLoad=()=>{},this._queue=[],this._shaders=new Map,this._images=new Map,this._models=new Map}load(t){this._afterLoad=t,this._queue.forEach((t=>t()))}importShader(t,e){this._assetsCount++,this._queue.push((()=>fetch(e).then((t=>t.text())).then((e=>{this._shaders.set(t,e),this._assetsLoaded++,this.checkAssets()})).catch((t=>{throw new Error(t)}))))}importImage(t,e){this._assetsCount++,this._queue.push((()=>{const r=new Image;r.onload=()=>{this._images.set(t,r),this._assetsLoaded++,this.checkAssets()},r.src=e}))}importModel(t,e){this._assetsCount++,this._queue.push((()=>fetch(e).then((t=>t.json())).then((t=>a.GLTFLoader.parse(t))).then((e=>{this._models.set(t,e),this._assetsLoaded++,this.checkAssets()})).catch((t=>{throw new Error(t)}))))}importBinaryModel(t,e){this._assetsCount++,this._queue.push((()=>fetch(e).then((t=>t.arrayBuffer())).then((t=>a.GLTFLoader.parseBinary(t))).then((e=>{this._models.set(t,e),this._assetsLoaded++,this.checkAssets()})).catch((t=>{throw new Error(t)}))))}shader(t){if(!this._shaders.has(t))throw new Error(`Shader "${t}" not found in assets.`);return this._shaders.get(t)}image(t){if(!this._images.has(t))throw new Error(`Image "${t}" not found in assets.`);return this._images.get(t)}model(t){if(!this._models.has(t))throw new Error(`Model "${t}" not found in assets.`);return this._models.get(t)}checkAssets(){this._assetsLoaded===this._assetsCount&&this._afterLoad()}}},224:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Geometry=void 0;const a=r(7458);class n{static count=0;id;attributes=[];updateBuffers=!1;count=0;index=null;constructor(){this.id=n.count++}setAttribute(t,e,r,n=!1){this.attributes.push(new a.GeometryAttribute(t,e,r,n)),this.updateBuffers=!0}setEmptyAttribute(t,e,r,n=!1){this.attributes.push(new a.GeometryAttribute(t,new Float32Array(e),r,n)),this.updateBuffers=!0}get indexed(){return null!==this.index}get attributesLength(){let t=0;for(let e=0;e<this.attributes.length;e++)t+=this.attributes[e].itemSize;return t}}e.Geometry=n},7458:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GeometryAttribute=void 0,e.GeometryAttribute=class{name;data;itemSize;normalized;constructor(t,e,r,a=!1){this.name=t,this.data=e,this.itemSize=r,this.normalized=a}}},9664:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Hash=void 0,e.Hash=class{static create(t){let e=3735928559,r=1103547991;for(let a,n=0,i=t.length;n<i;n++)a=t.charCodeAt(n),e=Math.imul(e^a,2654435761),r=Math.imul(r^a,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&r)+(e>>>0)}}},1132:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Material=void 0,e.Material=class{image;imageRepeat;normal;normalRepeat;color;vertexColors;castShadow;blending;constructor(){this.image=null,this.imageRepeat=!1,this.normal=null,this.normalRepeat=!1,this.color=null,this.vertexColors=!1,this.castShadow=!0,this.blending=!1}setImage(t,e=!1){return this.image=t,this.imageRepeat=e,this}setNormal(t,e=!1){return this.normal=t,this.normalRepeat=e,this}setColor(t){return this.color=t,this}disableShadows(){return this.castShadow=!1,this}useVertexColors(){return this.vertexColors=!0,this}useBlending(){return this.blending=!0,this}}},530:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderMaterial=void 0;const a=r(1132);class n extends a.Material{vertex;fragment;uniforms;constructor(t,e){super(),this.vertex=t,this.fragment=e,this.uniforms=new Map}}e.ShaderMaterial=n},1632:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bone=void 0;const a=r(1873),n=r(887);class i extends a.Object3D{_boneTransform=n.mat4.create();constructor(){super(),this._boneTransform=n.mat4.create()}calculateTransforms(){super.calculateTransforms(),this._parent instanceof i?this._boneTransform=n.mat4.multiply(n.mat4.create(),this._parent._boneTransform,this._localTransform.matrix):n.mat4.copy(this._boneTransform,this._localTransform.matrix)}get boneTransform(){return this._boneTransform}}e.Bone=i},978:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;const a=r(1873);class n extends a.Object3D{geometry;material;constructor(t,e){super(),this.geometry=t,this.material=e}}e.Line=n},9026:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;const a=r(1873);class n extends a.Object3D{geometry;material;constructor(t,e){super(),this.geometry=t,this.material=e}}e.Mesh=n},2225:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Point=void 0;const a=r(1873);class n extends a.Object3D{geometry;material;constructor(t,e){super(),this.geometry=t,this.material=e}}e.Point=n},1912:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SkinnedMesh=void 0;const a=r(9026);class n extends a.Mesh{geometry;material;_skeleton;constructor(t,e){super(t,e),this.geometry=t,this.material=e,this._skeleton=null}set skeleton(t){this._skeleton=t}get skeleton(){if(null===this._skeleton)throw new Error("Skeleton for a mesh wasn't assigned yet.");return this._skeleton}}e.SkinnedMesh=n},1873:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Object3D=void 0;const a=r(887),n=r(6143);e.Object3D=class{_worldTransform=a.mat4.create();_localTransform=n.Transform.init();_parent=null;_children=[];set translation(t){this._localTransform.translation=t}get translation(){return this._localTransform.translation}get worldTranslation(){return a.mat4.getTranslation(a.vec3.create(),this._worldTransform)}set rotation(t){this._localTransform.rotation=t}get rotation(){return this._localTransform.rotation}set scale(t){this._localTransform.scale=t}get scale(){return this._localTransform.scale}get localTransform(){return this._localTransform}get worldTransform(){return this._worldTransform}setChild(t){t._parent=this,this._children.push(t)}traverse(t){t(this);for(let e=0,r=this._children.length;e<r;e++)this._children[e].traverse(t)}updateMatrixWorld(){this.traverse((t=>t.calculateTransforms()))}calculateTransforms(){null===this._parent?a.mat4.copy(this._worldTransform,this._localTransform.matrix):this._worldTransform=a.mat4.multiply(a.mat4.create(),this._parent.worldTransform,this._localTransform.matrix)}}},4486:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RenderLoop=void 0,e.RenderLoop=class{_debug;_oldTimestamp;_active;_onRender;constructor(t){this._debug=t,this._oldTimestamp=0,this._active=!1,this._onRender=()=>null}start(t){this._onRender=t,this._active=!0,requestAnimationFrame(this.run.bind(this))}stop(){this._active=!1}run(t){const e=performance.now(),r=(t-this._oldTimestamp)/1e3;this._oldTimestamp=t,this._onRender(r,t/1e3),null!==this._debug&&(this._debug.fps=1/r,this._debug.cpuTime=performance.now()-e),this._active&&requestAnimationFrame(this.run.bind(this))}}},7593:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const a=r(9026),n=r(978),i=r(661),s=r(2225);e.Scene=class{objects;light;drawables;constructor(){this.objects=[],this.drawables=[],this.light=null}addLight(t){return this.objects.push(t),this.light=t,this}add(...t){this.objects.push(...t);for(let e=0;e<t.length;e++)t[e].traverse((t=>{t instanceof n.Line||t instanceof a.Mesh||t instanceof s.Point?this.drawables.push(t):t instanceof i.PointLight&&(this.light=t)}));return this}updateMatrixWorld(){for(let t=0,e=this.objects.length;t<e;t++)this.objects[t].updateMatrixWorld()}traverse(t){for(let e=0,r=this.objects.length;e<r;e++)this.objects[e].traverse(t)}}},3200:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Skeleton=void 0;const a=r(887);e.Skeleton=class{bindPose;currentPose;_joints;_inverseBindPose;constructor(t){this.bindPose=t.copy,this.currentPose=t,this._joints=[],this._inverseBindPose=[]}getBone(t){return this._joints[t]}addJoint(t,e){this._joints.push(t),this._inverseBindPose.push(e)}get jointMatrix(){const t=this._joints.length,e=new Float32Array(16*t);for(let r=0;r<t;r++)e.set(a.mat4.multiply(a.mat4.create(),this._joints[r].boneTransform,this._inverseBindPose[r]),16*r);return e}get jointCount(){return this._joints.length}}},6143:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Transform=void 0;const a=r(887);class n{_translation;_rotation;_scale;_matrix;_calculateMatrix=!1;constructor(t,e,r){this._translation=t,this._rotation=e,this._scale=r,this._matrix=a.mat4.fromRotationTranslationScale(a.mat4.create(),e,t,r)}static init(){return new this(a.vec3.fromValues(0,0,0),a.quat.fromValues(0,0,0,1),a.vec3.fromValues(1,1,1))}copy(){return new n(a.vec3.fromValues(this._translation[0],this._translation[1],this._translation[2]),a.quat.fromValues(this._rotation[0],this._rotation[1],this._rotation[2],this._rotation[3]),a.vec3.fromValues(this._scale[0],this._scale[1],this._scale[2]))}static fromMatrix(t){return new this(a.mat4.getTranslation(a.vec3.create(),t),a.mat4.getRotation(a.quat.create(),t),a.mat4.getScaling(a.vec3.create(),t))}set translation(t){this._translation=t,this._calculateMatrix=!0}get translation(){return this._translation}set rotation(t){this._rotation=t,this._calculateMatrix=!0}get rotation(){return this._rotation}set scale(t){this._scale=t,this._calculateMatrix=!0}get scale(){return this._scale}get matrix(){return this._calculateMatrix&&(this._matrix=a.mat4.fromRotationTranslationScale(a.mat4.create(),this._rotation,this._translation,this._scale),this._calculateMatrix=!1),this._matrix}}e.Transform=n},7656:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Wiggle=void 0,e.Wiggle=class{_frequency;_amplitude;_value;_nextValue=0;_currentValue=0;_previousValue=0;_t=0;constructor(t,e,r){this._value=t,this._previousValue=t,this._currentValue=t,this._frequency=e,this._amplitude=r}update(t){this._t+=t*this._frequency,this._t>=1&&(this._previousValue=this._nextValue,this._nextValue=this._value+(Math.random()*(this._amplitude- -this._amplitude)-this._amplitude),this._t=0),this._currentValue=this._lerp(this._previousValue,this._nextValue,this._t)}get value(){return this._currentValue}set value(t){this._value=t}_lerp(t,e,r){return t*(1-r)+e*r}}},9287:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WindowDecorator=void 0,e.WindowDecorator=class{_window;constructor(t){this._window=t}find(t){return this._window.document.querySelector(t)}addEventListener(t,e){this._window.document.addEventListener(t,e)}get searchParams(){return new URLSearchParams(this._window.location.search)}get debug(){return this.searchParams.has("debug")}get body(){return this._window.document.body}}},5171:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DebugContainer=void 0,e.DebugContainer=class{_fpsElement;_cpuTimeElement;_gpuTimeElement;_jsHeapUsedElement;_jsHeapLimitElement;_jsHeapAvailableElement;_updateInterval=3;_samplesCount=60;_fpsSamples=[];_cpuTimeSamples=[];_gpuTimeSamples=[];_active=!1;_lastUpdate=this._updateInterval;constructor(t,e,r,a,n,i){this._fpsElement=t,this._cpuTimeElement=e,this._gpuTimeElement=r,this._jsHeapUsedElement=a,this._jsHeapLimitElement=n,this._jsHeapAvailableElement=i}static create(t){const e=t.find("[data-debug-container]"),r=t.find("[data-toggle-debug-container]"),a=new this(e.querySelector("[data-fps-counter]"),e.querySelector("[data-ms-cpu-counter]"),e.querySelector("[data-ms-gpu-counter]"),e.querySelector("[data-heap-used]"),e.querySelector("[data-heap-limit]"),e.querySelector("[data-heap-available]"));return r.addEventListener("click",(()=>a._active=e.classList.toggle("active"))),r.classList.add("initialized"),a}update(t){if(!this._active)return;if(this._lastUpdate+=t,this._lastUpdate<this._updateInterval)return;this._fpsElement.textContent=Math.round(this.averageFrom(this._fpsSamples)).toString(),this._cpuTimeElement.textContent=this.averageFrom(this._cpuTimeSamples).toFixed(2).concat(" ms"),this._gpuTimeElement.textContent=this.averageFrom(this._gpuTimeSamples).toFixed(2).concat(" ms");const e=window.performance.memory;void 0!==e&&(this._jsHeapLimitElement.textContent=Math.round(e.jsHeapSizeLimit/1e6).toString().concat(" MB"),this._jsHeapAvailableElement.textContent=Math.round(e.totalJSHeapSize/1e6).toString().concat(" MB"),this._jsHeapUsedElement.textContent=Math.round(e.usedJSHeapSize/1e6).toString().concat(" MB")),this._lastUpdate=0}set fps(t){this._fpsSamples.push(t),this._fpsSamples.length>=this._samplesCount&&this._fpsSamples.shift()}set cpuTime(t){this._cpuTimeSamples.push(t),this._cpuTimeSamples.length>=this._samplesCount&&this._cpuTimeSamples.shift()}set gpuTime(t){this._gpuTimeSamples.push(t),this._gpuTimeSamples.length>=this._samplesCount&&this._gpuTimeSamples.shift()}averageFrom(t){if(0===t.length)return 0;let e=0;for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}},2711:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EndlessNight=void 0;const a=r(4486),n=r(3324),i=r(4540),s=r(647),o=r(887),u=r(4011),h=r(7823),c=r(661),l=r(9905),f=r(7593),_=r(7989),d=r(7656);e.EndlessNight=class{_assets;_debug;_loop;_renderer;_keyboard;_mouse;constructor(t,e,r,s){this._assets=e,this._debug=s,this._loop=new a.RenderLoop(s),this._renderer=r,this._keyboard=new n.Keyboard(t),this._mouse=new i.Mouse(t)}bootstrap(){const t=new s.Camera(this._renderer.canvas,o.vec3.fromValues(0,4.5,4.5),this._mouse),e=new _.Ground(this._assets),[r]=this._assets.model("torch").scene;r.translation=o.vec3.fromValues(0,-.05,0),r.rotation=o.quat.rotateY(o.quat.create(),o.quat.create(),Math.PI/2);const[a,n,i]=this._assets.model("akai").scene;a.rotation=o.quat.rotateY(o.quat.create(),o.quat.create(),.7),n?.getBone(31).setChild(r),t.follow(a);const m=new u.AnimationControl(n);m.addClip("idle",i[0]),m.addClip("walk",i[2]),m.addClip("run",i[1]);const p=h.MovementControl.bind(a,m,this._keyboard,t),M=new c.PointLight;M.translation=o.vec3.fromValues(0,.8,.2),r.setChild(M);const v=new d.Wiggle(.9,4,.15),g=new d.Wiggle(M.translation[1],4,.1),b=l.Fire.create(this._assets,t);r.setChild(b),b.translation=o.vec3.fromValues(0,.58,0);const T=new f.Scene;T.addLight(M),T.add(...e.tiles),T.add(a),T.add(b),this._loop.start(((r,n)=>{this._keyboard.any&&t.stopOrbiting(),this._mouse.update(),t.update(r),p.update(r),e.update(a.translation),T.light?.update(r),T.light instanceof c.PointLight&&(v.update(r),g.update(r),T.light.intensity=v.value,T.light.translation=o.vec3.fromValues(M.translation[0],g.value,M.translation[2])),b.update(n,p),this._renderer.render(T,t),this._debug?.update(r)}))}}},3324:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Keyboard=void 0,e.Keyboard=class{any;forward;right;back;left;shift;constructor(t){t.addEventListener("keydown",this.bindKeyDown.bind(this)),t.addEventListener("keyup",this.bindKeyUp.bind(this)),this.any=!1,this.forward=!1,this.right=!1,this.back=!1,this.left=!1,this.shift=!1}bindKeyDown(t){switch(this.any=!0,t.code){case"KeyW":case"ArrowUp":this.forward=!0;break;case"KeyD":case"ArrowRight":this.right=!0;break;case"KeyS":case"ArrowDown":this.back=!0;break;case"KeyA":case"ArrowLeft":this.left=!0;break;case"ShiftLeft":this.shift=!0}}bindKeyUp(t){switch(this.any=!1,t.code){case"KeyW":case"ArrowUp":this.forward=!1;break;case"KeyD":case"ArrowRight":this.right=!1;break;case"KeyS":case"ArrowDown":this.back=!1;break;case"KeyA":case"ArrowLeft":this.left=!1;break;case"ShiftLeft":this.shift=!1}}}},4540:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mouse=void 0,e.Mouse=class{_clicked;_scrolling;_offsetX;_mouseOffsetX;_lastMouseOffsetX;_wheelOffset;_mouseWheelOffset;_lastMouseWheelOffset;constructor(t){t.addEventListener("mouseup",this.mouseUp.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("wheel",this.mouseWheel.bind(this)),this._clicked=!1,this._scrolling=!1,this._offsetX=0,this._mouseOffsetX=0,this._lastMouseOffsetX=0,this._wheelOffset=0,this._mouseWheelOffset=0,this._lastMouseWheelOffset=0}update(){this._clicked&&(this._offsetX=this._mouseOffsetX-this._lastMouseOffsetX,this._lastMouseOffsetX=this._mouseOffsetX),this._scrolling=this._lastMouseWheelOffset!=this._mouseWheelOffset,this._scrolling&&(this._wheelOffset=this._mouseWheelOffset-this._lastMouseWheelOffset,this._lastMouseWheelOffset=this._mouseWheelOffset)}mouseDown(t){this._clicked=!0,this._lastMouseOffsetX=t.clientX}mouseUp(){this._clicked=!1}mouseMove(t){this._mouseOffsetX=t.clientX}mouseWheel(t){this._mouseWheelOffset+=t.deltaY}}},5162:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DirectionalLight=void 0;const a=r(887),n=r(1873);class i extends n.Object3D{_currentTarget;_followTarget;_previousFollowTargetPosition;_worldUp;_projectionMatrix;_viewMatrix;_projectionViewMatrix;_projectionChanged=!0;_viewChanged=!0;_projectionViewChanged=!0;constructor(t=a.vec3.fromValues(0,0,0)){super(),this._currentTarget=t,this._followTarget=null,this._previousFollowTargetPosition=null,this._worldUp=[0,1,0],this._projectionMatrix=a.mat4.create(),this._viewMatrix=a.mat4.create(),this._projectionViewMatrix=a.mat4.create()}update(t){if(null===this._followTarget||null===this._previousFollowTargetPosition)return;const e=this._followTarget.translation;a.vec3.equals(this._previousFollowTargetPosition,e)||(this.translation=a.vec3.fromValues(e[0],5,e[2]+5),this._currentTarget=this._followTarget.translation,this._viewChanged=!0,this._projectionViewChanged=!0,this._previousFollowTargetPosition=e)}follow(t){this._followTarget=t,this._previousFollowTargetPosition=t.translation}get projectionViewMatrix(){return this._projectionViewChanged&&(a.mat4.multiply(this._projectionViewMatrix,this.orthographicProjectionMatrix,this.viewMatrix),this._projectionViewChanged=!1),this._projectionViewMatrix}get viewMatrix(){return this._viewChanged&&(a.mat4.lookAt(this._viewMatrix,this.translation,this._currentTarget,this._worldUp),this._viewChanged=!1),this._viewMatrix}get perspectiveProjectionMatrix(){return this._projectionChanged&&(a.mat4.perspective(this._projectionMatrix,60*Math.PI/180,1,1,30),this._projectionChanged=!1),this._projectionMatrix}get orthographicProjectionMatrix(){return this._projectionChanged&&(a.mat4.ortho(this._projectionMatrix,-2,2,-2,2,0,10),this._projectionChanged=!1),this._projectionMatrix}}e.DirectionalLight=i},661:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PointLight=void 0;const a=r(887),n=r(1873);class i extends n.Object3D{_directions=[];_intensity;constructor(){super(),this._intensity=1,this._directions=[{target:a.vec3.fromValues(1,0,0),up:a.vec3.fromValues(0,-1,0)},{target:a.vec3.fromValues(-1,0,0),up:a.vec3.fromValues(0,-1,0)},{target:a.vec3.fromValues(0,1,0),up:a.vec3.fromValues(0,0,1)},{target:a.vec3.fromValues(0,-1,0),up:a.vec3.fromValues(0,0,-1)},{target:a.vec3.fromValues(0,0,1),up:a.vec3.fromValues(0,-1,0)},{target:a.vec3.fromValues(0,0,-1),up:a.vec3.fromValues(0,-1,0)}]}update(t){}get projectionViewMatrix(){return a.mat4.create()}get faces(){return this._directions.length}get intensity(){return this._intensity}set intensity(t){this._intensity=t}getFaceProjectionViewMatrix(t){const e=a.mat4.lookAt(a.mat4.create(),this.worldTranslation,a.vec3.add(a.vec3.create(),this.worldTranslation,this._directions[t].target),this._directions[t].up),r=a.mat4.perspective(a.mat4.create(),Math.PI/2,1,.1,20);return a.mat4.multiply(a.mat4.create(),r,e)}}e.PointLight=i},7341:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Accessor=void 0,e.Accessor=class{bufferView;buffer;byteOffset;componentType;count;type;constructor(t,e,r,a,n,i){this.bufferView=t,this.buffer=e,this.byteOffset=r,this.componentType=a,this.count=n,this.type=i}static fromJson(t,e,r){const a=e[t.bufferView];return new this(a,r[a.buffer],t.byteOffset??0,t.componentType,t.count,t.type)}get data(){const t=this.bufferView,e=this.buffer,r=this.typedArray;if(t.isInterleaved){const a=new r(e.arrayBuffer(),t.byteOffset+this.byteOffset),n=new r(this.length),i=t.byteStride/r.BYTES_PER_ELEMENT;for(let t=0;t<this.count;t++){const e=i*t,r=e+this.typeSize;n.set(a.slice(e,r),t*this.typeSize)}return new r(n,t.byteOffset+this.byteOffset)}return new r(e.arrayBuffer(),t.byteOffset+this.byteOffset,this.count*this.typeSize)}get typeSize(){switch(this.type){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error(`Can't get typed size based on "${this.type}" type`)}}get typedArray(){switch(this.componentType){case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Can't get typed array based on "${this.componentType}" type`)}}get length(){return this.count*this.typeSize}}},5287:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Animation=void 0;const a=r(8903),n=r(3641),i=r(2218),s=r(9036),o=r(9414),u=r(1905);e.Animation=class{static fromJson(t,e,r){const h=t.name??`animation_${e}`,c=new a.AnimationClip(h);for(let e=0;e<t.channels.length;e++){const a=t.channels[e],h=a.target.node,l=a.target.path,f=t.samplers[a.sampler],_=r[f.input].data,d=r[f.output].data;if(void 0===h)continue;let m=n.Interpolation.LINEAR;if("STEP"===f.interpolation&&(m=n.Interpolation.STEP),"CUBICSPLINE"===f.interpolation)throw new Error("GLTF: cubic spline interpolation is not implemented.");const p=new i.TransformTrack(h),M=d.length/_.length;if("translation"===l){const t=[];for(let e=0;e<_.length;e++)t.push(new s.VectorFrame(_[e],d.slice(e*M,e*M+M)));p.translation=new o.Track(t,m)}if("rotation"===l){const t=[];for(let e=0;e<_.length;e++)t.push(new u.QuaternionFrame(_[e],d.slice(e*M,e*M+M)));p.rotation=new o.Track(t,m)}if("scale"===l){const t=[];for(let e=0;e<_.length;e++)t.push(new s.VectorFrame(_[e],d.slice(e*M,e*M+M)));p.scale=new o.Track(t,m)}c.tracks.push(p)}return c.recalculateDuration(),c}}},8035:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Buffer=void 0,e.Buffer=class{_uri;_byteLength;_arrayBufferCache;constructor(t,e){this._uri=t,this._byteLength=e,this._arrayBufferCache=null}static async fromJson(t){const e=new this(t.uri,t.byteLength);if(void 0!==t.binary)e._arrayBufferCache=t.binary;else if(!e._uri.startsWith("data:")){const t=await fetch("/model/"+e._uri);e._arrayBufferCache=await t.arrayBuffer()}return e}arrayBuffer(){if(null!==this._arrayBufferCache)return this._arrayBufferCache;if(!this._uri.startsWith("data:"))throw new Error("GLTF buffer URIs other than data are not implemented.");const t=this._uri.indexOf(","),[e,r]=this._uri.substring(5,t).split(";");if(!["application/octet-stream","application/gltf-buffer"].includes(e))throw new Error(`GLTF buffer data URIs "${e}" mime type is not supported.`);if(!["base64"].includes(r))throw new Error(`GLTF buffer data URIs "${r}" encoding is not supported.`);const a=this._uri.substring(t+1),n=atob(a),i=new ArrayBuffer(n.length),s=new Uint8Array(i);for(let t=0;t<n.length;t++)s[t]=n.charCodeAt(t);return i}}},9629:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferView=void 0,e.BufferView=class{buffer;byteOffset;byteLength;byteStride;target;constructor(t,e,r,a,n){this.buffer=t,this.byteOffset=e,this.byteLength=r,this.byteStride=a,this.target=n}static fromJson(t){return new this(t.buffer,t.byteOffset??0,t.byteLength,t.byteStride??0,t.target??null)}get isInterleaved(){return this.byteStride>0}}},5727:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TYPE_SIZES=e.ATTRIBUTES=void 0,e.ATTRIBUTES={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",TEXCOORD_3:"uv4",TEXCOORD_4:"uv5",TEXCOORD_5:"uv6",TEXCOORD_6:"uv7",COLOR_0:"color",WEIGHTS_0:"weights",JOINTS_0:"joints"},e.TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}},617:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Image=void 0,e.Image=class{static async fromJson(t,e,r){let a=null;if(void 0!==t.bufferView){const n=e[t.bufferView],i=r[n.buffer],s=new Uint8Array(i.arrayBuffer(),n.byteOffset,n.byteLength/Uint8Array.BYTES_PER_ELEMENT),o=new Blob([s],{type:t.mimeType});a=URL.createObjectURL(o)}if(void 0!==t.uri&&t.uri.startsWith("data:")&&(a=t.uri),void 0===t.uri||t.uri.startsWith("data:")||(a=`/image/${t.uri}`),null===a)throw new Error("Cannot decode gltf image uri.");return await this.resolveImage(a)}static resolveImage(t){return new Promise(((e,r)=>{const a=new globalThis.Image;a.onload=()=>e(a),a.onerror=()=>r(new Error("Cannot fetch image from file.")),a.src=t}))}}},7664:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Material=void 0;const a=r(887),n=r(1132);e.Material=class{static fromJson(t,e){if(void 0===t)return(new n.Material).setColor(a.vec3.fromValues(.4,.4,.4));const r=t.pbrMetallicRoughness?.baseColorTexture?.index;if(void 0===r)throw new Error("Only textured material is supported now.");return(new n.Material).setImage(e[r])}}},3864:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;const a=r(9026),n=r(224),i=r(5727);e.Mesh=class{static fromJson(t,e,r){if(t.primitives.length>1)throw new Error("Mesh with multi-primitives are not supported.");const s=t.primitives[0].indices,o=t.primitives[0].attributes,u=t.primitives[0].material,h=new n.Geometry;void 0!==s&&(h.index=e[s].data,h.count=h.index.length);for(const[t,r]of Object.entries(o)){const a=i.ATTRIBUTES[t],n=e[r];if(void 0===a||void 0===n)throw new Error(`Cannot create geometry attribute from name "${t}".`);"position"===a&&void 0===s&&(h.count=n.length/i.TYPE_SIZES[n.type]),h.setAttribute("a_"+a,e[r].data,i.TYPE_SIZES[n.type])}return new a.Mesh(h,r[u])}}},3171:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Node=void 0;const a=r(887),n=r(9026),i=r(1873),s=r(1632),o=r(1912);e.Node=class{static fromJson(t,e,r,u){let h=new i.Object3D;if(this.isBone(e,r)&&(h=new s.Bone),this.isMesh(t)){const e=u[t.mesh];h=new n.Mesh(e.geometry,e.material)}if(this.isSkinnedMesh(t)){const e=u[t.mesh];h=new o.SkinnedMesh(e.geometry,e.material)}return void 0!==t.matrix&&(h.translation=a.mat4.getTranslation(a.vec3.create(),t.matrix),h.rotation=a.mat4.getRotation(a.quat.create(),t.matrix),h.scale=a.mat4.getScaling(a.vec3.create(),t.matrix)),void 0!==t.translation&&(h.translation=a.vec3.fromValues(...t.translation)),void 0!==t.rotation&&(h.rotation=a.quat.fromValues(...t.rotation)),void 0!==t.scale&&(h.scale=a.vec3.fromValues(...t.scale)),h}static isMesh(t){return void 0!==t.mesh&&void 0===t.skin}static isSkinnedMesh(t){return void 0!==t.mesh&&void 0!==t.skin}static isBone(t,e){for(let r=0;r<e.length;r++)if(e[r].joints.includes(t))return!0;return!1}}},8828:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Skin=void 0;const a=r(1632),n=r(3200),i=r(1462);e.Skin=class{static fromJson(t,e,r){const s=e[t.inverseBindMatrices].data,o=new i.Pose;for(let t=0;t<r.length;t++){r[t];const e=r[t];o.addNode(`node_${t}`,e.localTransform)}const u=new n.Skeleton(o);for(let e=0;e<t.joints.length;e++){const n=t.joints[e],i=s.slice(16*e,16*(e+1)),o=r[n];o instanceof a.Bone&&u.addJoint(o,i)}return u}}},1491:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GLTFLoader=void 0;const a=r(7341),n=r(9629),i=r(8035),s=r(1873),o=r(1912),u=r(617),h=r(7664),c=r(3864),l=r(5287),f=r(3171),_=r(8828);e.GLTFLoader=class{_defaultScene;_scenes;_nodes;_animations;_skins;constructor(t,e,r,a,n){this._defaultScene=t,this._scenes=e,this._nodes=r,this._animations=a,this._skins=n}static async parseBinary(t){const e=new Uint32Array(t,0,3);if(1179937895!==e[0])throw new Error("GLB magic number is not valid.");if(2!==e[1])throw new Error(`GLTF versions other than ${e[1]} are not implemented.`);const r=new Uint32Array(t,12,2),a=r[0];if(1313821514!==r[1])throw new Error("Unexpected GLB layout.");const n=(new TextDecoder).decode(t.slice(20,20+a)),i=JSON.parse(n);if(20+a===t.byteLength)return i;const s=new Uint32Array(t,20+a,2);if(5130562!==s[1])throw new Error("Unexpected GLB layout.");const o=20+a+8,u=s[0];return i.buffers[0].binary=t.slice(o,o+u),this.parse(i)}static async parse(t){if("2.0"!==t.asset.version)throw new Error(`GLTF versions other than ${t.asset.version} are not implemented.`);const e=t.scene??0,r=t.scenes?t.scenes.map((t=>t.nodes)):[],s=t.bufferViews?t.bufferViews.map((t=>n.BufferView.fromJson(t))):[],o=t.buffers?await Promise.all(t.buffers.map((t=>i.Buffer.fromJson(t)))):[],d=t.accessors?t.accessors.map((t=>a.Accessor.fromJson(t,s,o))):[],m=t.images?await Promise.all(t.images.map((t=>u.Image.fromJson(t,s,o)))):[],p=t.materials?t.materials.map((t=>h.Material.fromJson(t,m))):[],M=t.meshes?t.meshes.map((t=>c.Mesh.fromJson(t,d,p))):[],v=t.animations?t.animations.map(((t,e)=>l.Animation.fromJson(t,e,d))):[],g=t.nodes?t.nodes.map(((e,r)=>f.Node.fromJson(e,r,t.skins??[],M))):[],b=t.skins?t.skins.map((t=>_.Skin.fromJson(t,d,g))):[];return t.nodes?.forEach(((t,e)=>{t.children?.forEach((t=>{g[e].setChild(g[t])}))})),new this(e,r,g,v,b)}get scene(){const t=this._scenes[this._defaultScene];if(void 0===t)throw new Error(`Scene with index "${this._defaultScene}" doesn't exists.`);let e=new s.Object3D;for(let r=0;r<t.length;r++)e.setChild(this._nodes[t[r]]);let r=this._skins.length>0?this._skins[0]:null,a=this._animations.length>0?this._animations:null;return e.traverse((t=>{t instanceof o.SkinnedMesh&&(t.skeleton=r)})),[e,r,a]}}},9905:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Fire=void 0;const a=r(530),n=r(2225),i=r(224);class s extends n.Point{static create(t,e){const r=new a.ShaderMaterial(t.shader("fire_vertex"),t.shader("fire_fragment"));r.uniforms.set("u_resolution",[e.width,e.height]);const n=new i.Geometry;return n.count=1,n.setEmptyAttribute("a_position",3,1),new s(n,r.useBlending().disableShadows())}update(t,e){const r=e.velocity,a=e.previousAngle/Math.PI%1;let n=0;a<0?n=.25*r:a>0&&(n=.25*-r);const i=this.material;i.uniforms.set("u_time",t),i.uniforms.set("u_windFactor",n)}}e.Fire=s},7989:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Ground=void 0;const a=r(9026),n=r(3120),i=r(1132),s=r(887),o=20;e.Ground=class{_tiles;_playerConstraintsX;_playerConstraintsZ;constructor(t){this._tiles=[];for(let e=0;e<3;e++)for(let r=0;r<3;r++){const u=new a.Mesh(n.Plane.create(o,o,2,2),(new i.Material).setImage(t.image("ground"),!0).setNormal(t.image("ground_normal"),!0));u.rotation=s.quat.rotateX(s.quat.create(),u.rotation,-Math.PI/2),u.translation=s.vec3.fromValues(o*e-20,0,o*r-20),this._tiles.push(u)}this._playerConstraintsX=[-10,10],this._playerConstraintsZ=[-10,10]}update(t){if(this.withinConstraints(t))return;let e=null;for(let r=0;r<this._tiles.length;r++)null===e&&(e=this._tiles[r].translation),s.vec3.distance(t,this._tiles[r].translation)<s.vec3.distance(t,e)&&(e=this._tiles[r].translation);if(null===e)throw new Error("Nearest point cannot be calculated.");for(let t=0,r=0;r<3;r++)for(let a=0;a<3;a++,t++){const n=s.vec3.fromValues(o*r-20,0,o*a-20);s.vec3.add(n,n,e),this._tiles[t].translation=n}this._playerConstraintsX=[e[0]-10,e[0]+10],this._playerConstraintsZ=[e[2]-10,e[2]+10]}get tiles(){return this._tiles}withinConstraints(t){return!(t[0]<this._playerConstraintsX[0]||t[0]>this._playerConstraintsX[1]||t[2]<this._playerConstraintsZ[0]||t[2]>this._playerConstraintsZ[1])}}},3120:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Plane=void 0;const a=r(224),n=r(887);e.Plane=class{static create(t=1,e=1,r=1,i=1){const s=[],o=[],u=[],h=[],c=[],l=t/2,f=e/2,_=n.vec3.fromValues(0,0,1),d=n.vec3.fromValues(-l,f,0),m=n.vec3.fromValues(-l,-f,0),p=n.vec3.fromValues(l,-f,0),M=n.vec3.fromValues(l,f,0),v=n.vec2.fromValues(0,1*i),g=n.vec2.fromValues(0,0),b=n.vec2.fromValues(1*r,0),T=n.vec2.fromValues(1*r,1*i);let E=n.vec3.subtract(n.vec3.create(),m,d),w=n.vec3.subtract(n.vec3.create(),p,d),y=n.vec2.subtract(n.vec2.create(),g,v),x=n.vec2.subtract(n.vec2.create(),b,v),P=1/(y[0]*x[1]-x[0]*y[1]);const A=n.vec3.create(),S=n.vec3.create();A[0]=P*(x[1]*E[0]-y[1]*w[0]),A[1]=P*(x[1]*E[1]-y[1]*w[1]),A[2]=P*(x[1]*E[2]-y[1]*w[2]),S[0]=P*(-x[0]*E[0]+y[0]*w[0]),S[1]=P*(-x[0]*E[1]+y[0]*w[1]),S[2]=P*(-x[0]*E[2]+y[0]*w[2]),E=n.vec3.subtract(n.vec3.create(),p,d),w=n.vec3.subtract(n.vec3.create(),M,d),y=n.vec2.subtract(n.vec2.create(),b,v),x=n.vec2.subtract(n.vec2.create(),T,v),P=1/(y[0]*x[1]-x[0]*y[1]);const R=n.vec3.create(),C=n.vec3.create();R[0]=P*(x[1]*E[0]-y[1]*w[0]),R[1]=P*(x[1]*E[1]-y[1]*w[1]),R[2]=P*(x[1]*E[2]-y[1]*w[2]),C[0]=P*(-x[0]*E[0]+y[0]*w[0]),C[1]=P*(-x[0]*E[1]+y[0]*w[1]),C[2]=P*(-x[0]*E[2]+y[0]*w[2]),s.push(...d),o.push(..._),u.push(...v),h.push(...A),c.push(...S),s.push(...m),o.push(..._),u.push(...g),h.push(...A),c.push(...S),s.push(...p),o.push(..._),u.push(...b),h.push(...A),c.push(...S),s.push(...d),o.push(..._),u.push(...v),h.push(...R),c.push(...C),s.push(...p),o.push(..._),u.push(...b),h.push(...R),c.push(...C),s.push(...M),o.push(..._),u.push(...T),h.push(...R),c.push(...C);const O=new a.Geometry;return O.setAttribute("a_position",new Float32Array(s),3),O.setAttribute("a_normal",new Float32Array(o),3),O.setAttribute("a_uv",new Float32Array(u),2),O.setAttribute("a_tangents",new Float32Array(h),3),O.setAttribute("a_bitangents",new Float32Array(c),3),O.count=s.length/3,O}}},9502:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IdleState=void 0;const a=r(7833);class n extends a.State{_parent;constructor(t){super(),this._parent=t}get name(){return"idle"}enter(t){null!==t?this._parent.animations.fadeTo("idle"):this._parent.animations.play("idle")}exit(){}update(){this._parent.moving&&this._parent.setState("walk")}}e.IdleState=n},7823:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MovementControl=void 0;const a=r(4032),n=r(9502),i=r(1108),s=r(5893),o=r(887);class u extends a.StateMachine{animations;_object;_input;_camera;_acceleration=7;_deceleration=-4;_velocity=0;_rotationTime=.5;_currentRotationTime=0;_previousAngle=0;constructor(t,e,r,a){super(),this.animations=e,this._object=t,this._input=r,this._camera=a}static bind(t,e,r,a){const o=new u(t,e,r,a);return o.addState("idle",new n.IdleState(o)),o.addState("walk",new i.WalkState(o)),o.addState("run",new s.RunState(o)),o.setState("idle"),o}update(t){if(super.update(t),this.animations.update(t),!this.moving)return void(this._velocity=0);const e=o.vec3.fromValues(0,0,1),r=o.vec3.fromValues(0,0,0),a=this._camera.invertRotY;let n=this._velocity*this._deceleration;n*=t,n=Math.sign(n)*Math.min(Math.abs(n),Math.abs(this._velocity)),this._velocity=this._velocity+n,this._velocity+=this._acceleration*t,this._input.forward&&(r[2]=-1),this._input.right&&(r[0]=1),this._input.back&&(r[2]=1),this._input.left&&(r[0]=-1);const i=Math.atan2(r[0],r[2]),s=o.quat.rotateY(o.quat.create(),a,i);i!==this._previousAngle&&(this._currentRotationTime=0,this._previousAngle=i),o.quat.equals(this._object.rotation,s)||(this._currentRotationTime+=t,o.quat.slerp(this._object.rotation,this._object.rotation,s,this._currentRotationTime/this._rotationTime),this._currentRotationTime>=this._rotationTime&&(this._object.rotation=s)),this.running&&o.vec3.scale(e,e,2.8),o.vec3.transformQuat(e,e,this._object.rotation),o.vec3.scale(e,e,this._velocity*t),this._object.translation=o.vec3.add(o.vec3.create(),this._object.translation,e)}get moving(){return this._input.forward||this._input.right||this._input.back||this._input.left}get running(){return this._input.shift}get velocity(){return this._velocity}get previousAngle(){return this._previousAngle}}e.MovementControl=u},5893:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RunState=void 0;const a=r(7833);class n extends a.State{_parent;constructor(t){super(),this._parent=t}get name(){return"run"}enter(t){this._parent.animations.fadeTo("run",!0)}exit(){}update(){this._parent.moving?this._parent.running||this._parent.setState("walk"):this._parent.setState("idle")}}e.RunState=n},1108:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WalkState=void 0;const a=r(7833);class n extends a.State{_parent;constructor(t){super(),this._parent=t}get name(){return"walk"}enter(t){t&&"idle"===t.name?this._parent.animations.fadeTo("walk"):this._parent.animations.fadeTo("walk",!0)}exit(){}update(){this._parent.moving||this._parent.running||this._parent.setState("idle"),this._parent.moving&&this._parent.running&&this._parent.setState("run")}}e.WalkState=n},9458:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Attribute=void 0,e.Attribute=class{location;_gl;_name;constructor(t,e,r){this.location=r,this._gl=t,this._name=e}set(t,e=this._gl.ARRAY_BUFFER){const r=this._gl,a=r.createBuffer();if(null===a)throw new Error("Cannot create webgl buffer.");const n=(()=>{switch(!0){case t.data instanceof Int8Array:return r.BYTE;case t.data instanceof Uint8Array:return r.UNSIGNED_BYTE;case t.data instanceof Int16Array:return r.SHORT;case t.data instanceof Uint16Array:return r.UNSIGNED_SHORT;case t.data instanceof Int32Array:return r.INT;case t.data instanceof Uint32Array:return r.UNSIGNED_INT;case t.data instanceof Float32Array:return r.FLOAT;default:throw new Error("Cannot infer data type from array.")}})();r.bindBuffer(e,a),r.bufferData(e,t.data,r.STATIC_DRAW),r.enableVertexAttribArray(this.location),r.vertexAttribPointer(this.location,t.itemSize,n,t.normalized,0,0),r.bindBuffer(e,null)}}},7885:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Attributes=void 0;const a=r(9458);e.Attributes=class{_gl;_attributes;constructor(t){this._gl=t,this._attributes=new Map}static create(t,e){const r=new this(t),n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<n;++i){const n=t.getActiveAttrib(e,i),s=t.getAttribLocation(e,n.name);r._attributes.set(n.name,new a.Attribute(t,n.name,s))}return r}get(t){if(!this.has(t))throw new Error(`Program doesn't have "${t}" attribute.`);return this._attributes.get(t)}has(t){return this._attributes.has(t)}setInterleaved(t,e,r=this._gl.ARRAY_BUFFER,a=this._gl.STATIC_DRAW){const n=this._gl,i=n.createBuffer();if(null===i)throw new Error("Cannot create webgl buffer.");const s=(()=>{switch(!0){case t instanceof Int8Array:return n.BYTE;case t instanceof Uint8Array:return n.UNSIGNED_BYTE;case t instanceof Int16Array:return n.SHORT;case t instanceof Uint16Array:return n.UNSIGNED_SHORT;case t instanceof Int32Array:return n.INT;case t instanceof Uint32Array:return n.UNSIGNED_INT;case t instanceof Float32Array:return n.FLOAT;default:throw new Error("Cannot infer data type from array.")}})();n.bindBuffer(r,i),n.bufferData(r,t,a);let o=0;for(let r=0,a=e.length;r<a;r++)o+=t.BYTES_PER_ELEMENT*e[r].itemSize;let u=0;for(let r=0,a=e.length;r<a;r++){const a=e[r];if(this.has(a.name)){const e=this.get(a.name).location;console.log(e,a.itemSize,s,a.normalized),n.enableVertexAttribArray(e),n.vertexAttribPointer(e,a.itemSize,s,a.normalized,0,0),u+=t.BYTES_PER_ELEMENT*a.itemSize}}return n.bindBuffer(r,null),i}}},149:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Framebuffer=void 0,e.Framebuffer=class{static textureSize=256;depthTexture;depthFramebuffer;constructor(t,e){this.depthTexture=t,this.depthFramebuffer=e}static depth(t){const e=t.createTexture(),r=t.createFramebuffer();if(null===e)throw new Error("Cannot create framebuffer depth texture.");if(null===r)throw new Error("Cannot create framebuffer.");return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,this.textureSize,this.textureSize,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_FUNC,t.LEQUAL),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,e,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),new this(e,r)}static cubeDepth(t){const e=t.createTexture(),r=t.createFramebuffer();if(null===e)throw new Error("Cannot create framebuffer depth texture.");if(null===r)throw new Error("Cannot create framebuffer.");t.bindTexture(t.TEXTURE_CUBE_MAP,e),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_FUNC,t.LEQUAL);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.DEPTH_COMPONENT16,this.textureSize,this.textureSize,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_CUBE_MAP,null),new this(e,r)}passDirection(t,e){return[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z][e]}}},7464:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Program=void 0;const a=r(6058),n=r(7885),i=r(2638);e.Program=class{_gl;_program;_cachedUniforms;_cachedAttributes;constructor(t,e){this._gl=t,this._program=e,this._cachedUniforms=null,this._cachedAttributes=null}static create(t,e,r,a=[]){const n=t.createProgram();if(null===n)throw new Error("Cannot create webgl program.");const s=i.Shader.create(t,t.VERTEX_SHADER,e),o=i.Shader.create(t,t.FRAGMENT_SHADER,r);if(t.attachShader(n,s),t.attachShader(n,o),a.length>0&&t.transformFeedbackVaryings(n,a,t.INTERLEAVED_ATTRIBS),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error("Unexpected error while creating a program. "+t.getProgramInfoLog(n));return new this(t,n)}get attributes(){return null===this._cachedAttributes&&(this._cachedAttributes=n.Attributes.create(this._gl,this._program)),this._cachedAttributes}get uniforms(){return null===this._cachedUniforms&&(this._cachedUniforms=a.Uniforms.create(this._gl,this._program)),this._cachedUniforms}useProgram(){this._gl.useProgram(this._program)}stopProgram(){this._gl.useProgram(null)}}},9294:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Programs=void 0;const a=r(9664),n=r(7464),i=r(1912),s=r(5162),o=r(661),u=r(530);e.Programs=class{_shaderCache;_programs;_depthPrograms;constructor(t){this._shaderCache=t,this._programs=new Map,this._depthPrograms=new Map}fromMaterial(t,e,r,h){if(r instanceof u.ShaderMaterial)return this.fromShader(t,r.vertex,r.fragment);const c=[];c.push(r.image?"#define USE_TEXTURE":""),c.push(r.vertexColors?"#define USE_COLOR_ATTRIBUTE":""),c.push(r.color?"#define USE_STATIC_COLOR_ATTRIBUTE":""),c.push(r.normal?"#define USE_NORMAL_MAPPING":""),c.push(h instanceof s.DirectionalLight?"#define USE_LIGHT_DIRECTIONAL":""),c.push(h instanceof o.PointLight?"#define USE_LIGHT_POINT":""),c.push(h instanceof s.DirectionalLight||h instanceof o.PointLight?"#define USE_LIGHT":""),e instanceof i.SkinnedMesh&&c.push("#define USE_SKINNING");const l=a.Hash.create(c.join(""));if(this._programs.has(l))return this._programs.get(l);const f=n.Program.create(t,this._shaderCache.getVertex(c),this._shaderCache.getFragment(c));return this._programs.set(l,f),f}fromShader(t,e,r){const i=a.Hash.create(e+r);if(this._programs.has(i))return this._programs.get(i);const s=n.Program.create(t,e,r);return this._programs.set(i,s),s}depthPass(t,e){let r=[];e instanceof i.SkinnedMesh&&r.push("#define USE_SKINNING");const s=a.Hash.create(r.join(""));if(this._depthPrograms.has(s))return this._depthPrograms.get(s);const o=n.Program.create(t,this._shaderCache.getDepthVertex(r),this._shaderCache.getDepthFragment(r));return this._depthPrograms.set(s,o),o}}},2638:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Shader=void 0,e.Shader=class{static create(t,e,r){const a=t.createShader(e);if(null===a)throw new Error("Cannot create webgl shader.");if(t.shaderSource(a,r),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))throw new Error(`Unexpected error while compiling ${e===t.VERTEX_SHADER?"vertex":"fragment"} shader: `+t.getShaderInfoLog(a));return a}}},7538:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderCache=void 0;const r="#version 300 es";e.ShaderCache=class{_assets;constructor(t){this._assets=t}getVertex(t){return`${r}\n        \n        ${t.join("\n")}\n        \n        ${this._assets.shader("default_vertex")}\n        `}getFragment(t){return`${r}\n        \n        ${t.join("\n")}\n        \n        ${this._assets.shader("default_fragment")}\n        `}getDepthVertex(t){return`${r}\n            \n        ${t.join("\n")}\n    \n        ${this._assets.shader("depth_vertex")}\n        `}getDepthFragment(t){return`${r}\n                \n        ${t.join("\n")}\n\n        ${this._assets.shader("depth_fragment")}\n        `}}},2564:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Texture=void 0,e.Texture=class{_textures;constructor(){this._textures=new Map}set(t,e,r,a=t.LINEAR,n=t.CLAMP_TO_EDGE){const i=t.createTexture();if(null===i)throw new Error("Cannot create webgl texture.");t.bindTexture(t.TEXTURE_2D,i),null!==r&&(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.generateMipmap(t.TEXTURE_2D)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,n),this._textures.set(e,i),t.bindTexture(t.TEXTURE_2D,null)}has(t){return this._textures.has(t)}get(t){if(!this.has(t))throw new Error(`Texture with name "${t}" doesn't exists.`);return this._textures.get(t)}}},3008:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Uniform=void 0,e.Uniform=class{_gl;_name;_location;_type;_size;constructor(t,e,r,a,n){this._gl=t,this._name=e,this._location=r,this._type=a,this._size=n}set(t){switch(this._type){case 35676:this._gl.uniformMatrix4fv(this._location,!1,t);break;case 35675:this._gl.uniformMatrix3fv(this._location,!1,t);break;case 35665:this._gl.uniform3fv(this._location,t);break;case 35678:case 35680:case 5124:case 35682:case 36293:this._gl.uniform1i(this._location,t);break;case 5126:this._gl.uniform1f(this._location,t);break;case 35666:this._gl.uniform4fv(this._location,t);break;case 35664:this._gl.uniform2fv(this._location,t);break;default:throw new Error(`Cannot set uniform value - unrecognized type "${this._type}".`)}}}},6058:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Uniforms=void 0;const a=r(3008);e.Uniforms=class{_uniforms;constructor(){this._uniforms=new Map}static create(t,e){const r=new this,n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i),s=t.getUniformLocation(e,n.name);let o=n.name;o.endsWith("[0]")&&(o=o.slice(0,-3)),r._uniforms.set(o,new a.Uniform(t,o,s,n.type,n.size))}return r}get(t){if(!this._uniforms.has(t))throw new Error(`Program doesn't have "${t}" uniform.`);return this._uniforms.get(t)}has(t){return this._uniforms.has(t)}}},6562:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VertexArrays=void 0,e.VertexArrays=class{_vaos;constructor(){this._vaos=new Map}bind(t,e){let r=this._vaos.get(e)??null;if(null===r&&(r=t.createVertexArray()),null===r)throw new Error("Cannot create vertex attribute array.");this._vaos.set(e,r),t.bindVertexArray(r)}unbind(t){t.bindVertexArray(null)}}},9071:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WebGL2Renderer=void 0;const a=r(978),n=r(9026),i=r(9294),s=r(2564),o=r(6562),u=r(1912),h=r(7538),c=r(887),l=r(3347),f=r(149),_=r(5162),d=r(661),m=r(2225),p=r(530);e.WebGL2Renderer=class{_canvas;_gl;_debug;_programs;_shaderCache;_vertexArrays=new o.VertexArrays;_textures=new s.Texture;_framebuffer;_query;_queryExt;constructor(t,e,r){this._canvas=t.find("canvas"),this._gl=this._canvas.getContext("webgl2",{powerPreference:"high-performance",antialias:!0}),this._debug=r,this._shaderCache=new h.ShaderCache(e),this._programs=new i.Programs(this._shaderCache),this._framebuffer=null,this._query=null,this._queryExt=null,this._canvas.width=this._canvas.offsetWidth,this._canvas.style.width=`${this._canvas.offsetWidth}px`,this._canvas.height=this._canvas.offsetHeight,this._canvas.style.height=`${this._canvas.offsetHeight}px`,this._gl.enable(this._gl.DEPTH_TEST),this._gl.enable(this._gl.CULL_FACE),null!==this._debug&&(this._queryExt=this._gl.getExtension("EXT_disjoint_timer_query_webgl2"))}render(t,e){const r=this._gl,a=this._canvas.width,n=this._canvas.height;if(t.updateMatrixWorld(),null!==this._queryExt){if(null!==this._query){let t=r.getQueryParameter(this._query,r.QUERY_RESULT_AVAILABLE),e=r.getParameter(this._queryExt.GPU_DISJOINT_EXT);if(t&&!e){const t=r.getQueryParameter(this._query,r.QUERY_RESULT);this._debug.gpuTime=1e-6*t}}else this._query=r.createQuery();r.beginQuery(this._queryExt.TIME_ELAPSED_EXT,this._query)}if(null!==t.light){if(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(1,10),t.light instanceof _.DirectionalLight&&(null===this._framebuffer&&(this._framebuffer=f.Framebuffer.depth(r)),this.renderToFramebuffer(t,t.light.projectionViewMatrix)),t.light instanceof d.PointLight){null===this._framebuffer&&(this._framebuffer=f.Framebuffer.cubeDepth(r));for(let e=0;e<t.light.faces;e++)this.renderToFramebuffer(t,t.light.getFaceProjectionViewMatrix(e),e)}r.disable(r.POLYGON_OFFSET_FILL)}null!==e.screenPosition?(r.enable(r.SCISSOR_TEST),l.CameraPosition.TOP===e.screenPosition&&(r.viewport(0,n/2,a,n/2),r.scissor(0,n/2,a,n/2)),l.CameraPosition.BOTTOM===e.screenPosition&&(r.viewport(0,0,a,n/2),r.scissor(0,0,a,n/2)),l.CameraPosition.LEFT===e.screenPosition&&(r.viewport(0,0,a/2,n),r.scissor(0,0,a/2,n)),l.CameraPosition.RIGHT===e.screenPosition&&(r.viewport(a/2,0,a/2,n),r.scissor(a/2,0,a/2,n))):r.viewport(0,0,a,n);for(let a=0,n=t.drawables.length;a<n;a++)this.renderObject(r,t.drawables[a],e,t.light);null!==e.screenPosition&&r.disable(r.SCISSOR_TEST),null!==this._queryExt&&r.endQuery(this._queryExt.TIME_ELAPSED_EXT)}renderObject(t,e,r,i){const s=e.geometry,o=e.material,h=this._programs.fromMaterial(t,e,o,i);if(h.useProgram(),this._vertexArrays.bind(t,s.id),s.updateBuffers){for(let t=0,e=s.attributes.length;t<e;t++){const e=s.attributes[t];h.attributes.has(e.name)&&h.attributes.get(e.name).set(e)}if(s.indexed){const e=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s.index,t.STATIC_DRAW)}s.updateBuffers=!1}if(h.uniforms.get("u_projectionView").set(r.projectionViewMatrix),h.uniforms.get("u_model").set(e.worldTransform),null!==e.material.image&&(this._textures.has(e.material.image.src)||this._textures.set(t,e.material.image.src,e.material.image,t.LINEAR,e.material.imageRepeat?t.REPEAT:t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._textures.get(e.material.image.src)),h.uniforms.get("u_texture").set(1)),null!==e.material.normal&&h.uniforms.has("u_textureNormal")&&(this._textures.has(e.material.normal.src)||this._textures.set(t,e.material.normal.src,e.material.normal,t.LINEAR,e.material.normalRepeat?t.REPEAT:t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this._textures.get(e.material.normal.src)),h.uniforms.get("u_textureNormal").set(2)),h.uniforms.has("u_depthTexture")&&this._framebuffer?.depthTexture&&(t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,this._framebuffer.depthTexture),h.uniforms.get("u_depthTexture").set(3)),h.uniforms.has("u_depthCubeMapTexture")&&this._framebuffer?.depthTexture&&(t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_CUBE_MAP,this._framebuffer.depthTexture),h.uniforms.get("u_depthCubeMapTexture").set(4)),i&&h.uniforms.has("u_lightPosition")&&h.uniforms.get("u_lightPosition").set(i.worldTranslation),i instanceof d.PointLight&&h.uniforms.has("u_lightIntensity")&&h.uniforms.get("u_lightIntensity").set(i.intensity),i&&h.uniforms.has("u_lightProjectionViewMatrix")&&h.uniforms.get("u_lightProjectionViewMatrix").set(i.projectionViewMatrix),h.uniforms.has("u_cameraPosition")&&h.uniforms.get("u_cameraPosition").set(r._position),h.uniforms.has("u_normalMatrix")){const t=c.mat4.create();c.mat4.invert(t,e.worldTransform),c.mat4.transpose(t,t),h.uniforms.get("u_normalMatrix").set(t)}if(e instanceof u.SkinnedMesh){const r=`skin_${e.geometry.id}`;this._textures.has(r)||this._textures.set(t,r,null,t.NEAREST,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE5),t.bindTexture(t.TEXTURE_2D,this._textures.get(r)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,4,e.skeleton.jointCount,0,t.RGBA,t.FLOAT,e.skeleton.jointMatrix),h.uniforms.get("u_jointTexture").set(5)}null!==e.material.color&&h.uniforms.get("u_color").set(e.material.color),e.material instanceof p.ShaderMaterial&&e.material.uniforms.forEach((function(t,e){h.uniforms.has(e)&&h.uniforms.get(e).set(t)}));let l=null;if(e instanceof a.Line&&(l=t.LINES),e instanceof n.Mesh&&(l=t.TRIANGLES),e instanceof m.Point&&(l=t.POINTS),null===l)throw new Error("Cannot get rendering mode.");e.material.blending&&(t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE)),s.indexed?t.drawElements(l,s.count,t.UNSIGNED_SHORT,0):t.drawArrays(l,0,s.count),e.material.blending&&(t.blendFunc(t.SRC_ALPHA,t.ZERO),t.enable(t.DEPTH_TEST)),this._vertexArrays.unbind(t),h.stopProgram()}renderToFramebuffer(t,e,r=null){if(null===this._framebuffer)throw new Error("Framebuffer should be initialized before rendering to framebuffer.");const i=this._gl;i.bindFramebuffer(i.FRAMEBUFFER,this._framebuffer.depthFramebuffer),null!==r&&i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,this._framebuffer.passDirection(i,r),this._framebuffer.depthTexture,0),i.viewport(0,0,f.Framebuffer.textureSize,f.Framebuffer.textureSize),i.clear(i.DEPTH_BUFFER_BIT);for(let r=0,s=t.drawables.length;r<s;r++){const s=t.drawables[r];if(!s.material.castShadow)continue;const o=s.geometry,h=this._programs.depthPass(i,s);if(h.useProgram(),this._vertexArrays.bind(i,o.id),o.updateBuffers&&o.indexed){const t=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,o.index,i.STATIC_DRAW)}if(s instanceof u.SkinnedMesh){const t=`skin_${s.geometry.id}`;this._textures.has(t)||this._textures.set(i,t,null,i.NEAREST,i.CLAMP_TO_EDGE),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._textures.get(t)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,4,s.skeleton.jointCount,0,i.RGBA,i.FLOAT,s.skeleton.jointMatrix),h.uniforms.get("u_jointTexture").set(0)}h.uniforms.get("u_model").set(s.worldTransform),h.uniforms.get("u_lightSpace").set(e);let c=null;if(s instanceof a.Line&&(c=i.LINES),s instanceof n.Mesh&&(c=i.TRIANGLES),s instanceof m.Point&&(c=i.POINTS),null===c)throw new Error("Cannot get rendering mode.");o.indexed?i.drawElements(c,o.count,i.UNSIGNED_SHORT,0):i.drawArrays(c,0,o.count),this._vertexArrays.unbind(i),h.stopProgram()}i.bindFramebuffer(i.FRAMEBUFFER,null)}get canvas(){return this._canvas}}},7833:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0,e.State=class{}},4032:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StateMachine=void 0,e.StateMachine=class{_states;_currentState;constructor(){this._states={},this._currentState=null}addState(t,e){this._states[t]=e}setState(t){const e=this._currentState;if(e){if(e.name==t)return;e.exit()}const r=this._states[t];this._currentState=r,r.enter(e)}update(t){this._currentState&&this._currentState.update(t)}}}},e={};function r(a){var n=e[a];if(void 0!==n)return n.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=r(4461),e=r(2711),a=r(9287),n=r(9071),i=r(5171),s=new a.WindowDecorator(window),o=s.debug?i.DebugContainer.create(s):null,u=new t.Assets,h=new n.WebGL2Renderer(s,u,o),c=new e.EndlessNight(s,u,h,o);u.importShader("default_vertex","shader/default/vertex.glsl"),u.importShader("default_fragment","shader/default/fragment.glsl"),u.importShader("depth_vertex","shader/depth/vertex.glsl"),u.importShader("depth_fragment","shader/depth/fragment.glsl"),u.importShader("fire_vertex","shader/particle/fire/vertex.glsl"),u.importShader("fire_fragment","shader/particle/fire/fragment.glsl"),u.importImage("ground","image/ground.jpg"),u.importImage("ground_normal","image/ground_normal.jpg"),u.importBinaryModel("akai","model/akai.glb"),u.importBinaryModel("torch","model/torch.glb"),s.addEventListener("DOMContentLoaded",(()=>{u.load((()=>{c.bootstrap(),s.body.classList.add("initialized")}))}))})()})();